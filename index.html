<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#FDFBF7">
  <meta name="format-detection" content="telephone=no">
  <meta name="application-name" content="Â∂ºÊµ∑Á¥ÄË°å">
  <!-- ‰ΩøÁî®ÂÖ¨ÈñãÁöÑ URL ÈÄ£ÁµêÔºåÁ¢∫‰øùÂä†ÂÖ•‰∏ªÁï´Èù¢ÊôÇËÉΩÊ≠£Â∏∏È°ØÁ§∫ÂúñÁ§∫ÔºåÁÑ°ÈúÄÊú¨Âú∞ÂúñÊ™î -->
  <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3125/3125848.png"> 
  
  <title>Â∂ºÊµ∑Á¥ÄË°å</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --milk-tea-primary: #4E342E;
      --milk-tea-secondary: #D8C4B6;
      --milk-tea-accent: #A68A71;
      --milk-tea-bg: #FDFBF7;
    }
    body {
      font-family: 'Noto Sans TC', sans-serif;
      background-color: var(--milk-tea-bg);
      color: var(--milk-tea-primary);
      -webkit-tap-highlight-color: transparent;
      overflow-x: hidden;
      overscroll-behavior-y: none;
    }
    .serif { font-family: 'Noto Serif TC', serif; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    .glass-effect {
      background: rgba(253, 251, 247, 0.85);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    .fade-in { animation: fadeIn 0.4s ease-out forwards; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
    .pt-safe { padding-top: env(safe-area-inset-top); }
    
    .tab-active {
      background-color: var(--milk-tea-secondary);
      color: white;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
    }
    
    input, textarea, select { outline: none; border: 1px solid #F5EBE0; border-radius: 12px; padding: 10px 14px; background: #FDFBF7; width: 100%; font-size: 14px; color: #4E342E; }
    input:focus, textarea:focus, select:focus { border-color: var(--milk-tea-secondary); box-shadow: 0 0 0 2px rgba(216, 196, 182, 0.2); }
    
    .checkbox-custom { width: 22px; height: 22px; border-radius: 6px; border: 2px solid #D8C4B6; display: flex; align-items: center; justify-content: center; transition: all 0.2s; cursor: pointer; }
    .checkbox-custom.checked { background-color: #D8C4B6; }
    .checkbox-custom.checked::after { content: '\f00c'; font-family: 'Font Awesome 6 Free'; font-weight: 900; color: white; font-size: 12px; }

    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(78, 52, 46, 0.4);
      backdrop-filter: blur(4px);
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    /* Âº∑Âà∂Á¢∫‰øùÊåâÈàïÂèØÈªûÊìä */
    .clickable-widget {
      pointer-events: auto !important;
      cursor: pointer !important;
      touch-action: manipulation; 
    }
  </style>

  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.460.0"
  }
}
</script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel" data-type="module">
    import React, { useState, useEffect, useMemo, useRef } from 'react';
    import ReactDOM from 'react-dom/client';
    import { 
      ClipboardCheck, Map as MapIcon, Plane, Bed, Sparkles, Plus,
      Compass, Wallet, X, Trash2, Clock, Star, Waves, Edit2,
      Calendar, MapPin, ExternalLink, Train, ArrowRight, ChevronRight,
      Check, Utensils, Camera, ShoppingBag, Info, Luggage, Save, DollarSign, RefreshCw, Anchor, LifeBuoy, Search, Bus, Paperclip, Bot, Lightbulb, Tag, ArrowUp
    } from 'lucide-react';

    // --- GLOBAL CONSTANTS ---
    const USD_TO_TWD = 32.5;
    const MYR_TO_TWD = 7.5;
    const getGoogleMapsUrl = (name) => `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(name)}`;

    const RESORT_ACTIVITY_GROUPS = [
      {
        id: 'diving',
        category: 'Â∞àÊ•≠ÊΩõÊ∞¥ (Diving)',
        items: [
          { name: '1 Single Boat Dive', price: 65, detail: 'ÂÉÖÂê´Ê∞£Áì∂ËàáÈÖçÈáç (Tanks & Weights ONLY)' },
          { name: '1 Single Boat Dive (Full Set)', price: 89, detail: 'ÂåÖÂê´ BCD„ÄÅÂëºÂê∏Âô®„ÄÅÈõªËÖ¶Èå∂„ÄÅÈò≤ÂØíË°£ÂÖ®Â•óË£ùÂÇô' },
          { name: '3 Dive Package (Full Set)', price: 260, detail: '3 Ê¨°ËàπÊΩõÂÑ™ÊÉ†Â•óË£ùÔºåÂê´ÂÖ®Â•óË£ùÂÇô' },
          { name: '5 Dive Package (Full Set)', price: 419, detail: '5 Ê¨°ËàπÊΩõÂÑ™ÊÉ†Â•óË£ùÔºåÂê´ÂÖ®Â•óË£ùÂÇô' },
          { name: '10 Dive Package (Full Set)', price: 750, detail: '10 Ê¨°ËàπÊΩõÂÑ™ÊÉ†Â•óË£ùÔºåÂê´ÂÖ®Â•óË£ùÂÇô' },
          { name: 'Orientation Dive', price: 0, detail: 'Ê∞£Áì∂Ê™¢È©óÊΩõÊ∞¥ÔºöÊåâÊ≥ïË¶èÂ∞ëÊñº 30 ÊîØÊàñ 3 ÂÄãÊúàÁÑ°Á¥ÄÈåÑËÄÖÂøÖÂÇô' }
        ]
      },
      {
        id: 'courses',
        category: 'Ë≠âÁÖßË™≤Á®ã (PADI Courses)',
        items: [
          { name: 'PADI Scuba Refresh', price: 105, detail: 'Ê∞¥‰∏ãÊäÄÂ∑ßË§áÁøíËàá 1 Ê¨°ÊïôÁ∑¥Èô™ÂêåËàπÊΩõ' },
          { name: 'PADI Discover Scuba (DSD)', price: 140, detail: 'ÂàùÂ≠∏ËÄÖÈ´îÈ©óÊΩõÊ∞¥ÔºàÂê´Ê≥≥Ê±†ÂØ¶ÁøíËàá 1 Ê¨°ËàπÊΩõÔºâ' },
          { name: 'Discover Scuba / Training Dive', price: 85, detail: 'ÂÆåÊàêÈ´îÈ©óÊΩõÊ∞¥ÔºàDSDÔºâÂæå‰πãÂä†Ë≥ºËàπÊΩõË°åÁ®ã' },
          { name: 'PADI Scuba Diver (SD)', price: 390, detail: 'ÂåÖÂê´ 2 Ê¨°ËàπÊΩõËàá PADI Ê∞¥ËÇ∫ÊΩõÊ∞¥Âì°Ë≠âÁÖß' },
          { name: 'PADI Open Water Diver (OWD)', price: 650, detail: 'ÂàùÈöéË≠âÁÖßË™≤Á®ãÔºåÂåÖÂê´ 4 Ê¨°ËàπÊΩõËàáÂúãÈöõË≠âÁÖß' },
          { name: 'PADI Advanced Open Water (AOW)', price: 550, detail: 'ÈÄ≤ÈöéË≠âÁÖßË™≤Á®ãÔºåÂåÖÂê´ 5 Ê¨°ËàπÊΩõËàáÂúãÈöõË≠âÁÖß' }
        ]
      },
      {
        id: 'watersports',
        category: 'Ê∞¥‰∏äÊ¥ªÂãï (Water Sports)',
        items: [
          { name: 'Windsurfing Lesson', price: 70, detail: 'Â∞àÊ•≠È¢®Â∏ÜË°ùÊµ™ÊïôÂ≠∏Ë™≤Á®ãÔºà60 ÂàÜÈêòÔºâ' },
          { name: 'Jetski Rental 15m', price: 65, detail: 'Âô¥Â∞ÑÊ∞¥‰∏äÊë©ÊâòËªäÁßüË≥ÉÔºà15 ÂàÜÈêòÔºâ' },
          { name: 'Jetski Rental 30m', price: 110, detail: 'Âô¥Â∞ÑÊ∞¥‰∏äÊë©ÊâòËªäÁßüË≥ÉÔºà30 ÂàÜÈêòÔºâ' },
          { name: 'Wakeboard Lesson', price: 55, detail: 'ÂØ¨Êùø/Ê∞¥‰∏äÊªëÊùøÊïôÂ≠∏Ë™≤Á®ãÔºà30 ÂàÜÈêòÔºâ' },
          { name: 'Fun Tube Ride', price: 25, detail: 'ÂÖÖÊ∞£ÊãñÊõ≥Âúà/È¶ôËïâËàπÂà∫ÊøÄÈ´îÈ©óÔºà15 ÂàÜÈêò/ÊØè‰∫∫Ôºâ' },
          { name: 'Kayak', price: 0, detail: 'Áç®Êú®ËàüÔºöÊàøÂÆ¢ÂèØ‰∫´ÂÖçË≤ªÁßüÂÄü‰ΩøÁî®' },
          { name: 'SUP Stand up paddle board', price: 0, detail: 'Á´ãÊß≥Ë°ùÊµ™ÊùøÔºöÊàøÂÆ¢ÂèØ‰∫´ÂÖçË≤ªÁßüÂÄü‰ΩøÁî®' }
        ]
      },
      {
        id: 'excursions',
        category: 'Á≤æÈÅ∏Âá∫Êµ∑Ë°åÁ®ã (Excursions)',
        items: [
          { name: 'Snorkeling Lesson', price: 20, detail: 'ÊµÆÊΩõÂü∫Á§éÊïôÂ≠∏ËàáÊäÄÂ∑ßÊåáÂ∞éÔºà30 ÂàÜÈêòÔºâ' },
          { name: 'Snorkeling Trip', price: 60, detail: '90 ÂàÜÈêòÂ∞àÊ•≠ÊµÆÊΩõÂá∫Êµ∑Ë°åÁ®ãÔºàÂê´ÂÆåÊï¥Ë£ùÂÇôÔºâ' },
          { name: 'Dolphin Adventure', price: 60, detail: '90 ÂàÜÈêòÂ∞ãÊâæÈáéÁîüÊµ∑Ë±öËπ§ÂΩ±ÂÜíÈö™‰πãÊóÖ' },
          { name: 'Line Fishing Trip', price: 70, detail: 'ÊâãÁ∑öÊµ∑Èá£Ë°åÁ®ãÔºåÈ´îÈ©óÈ¶¨ÁàæÂú∞Â§´ÂÇ≥Áµ±ÊçïÈ≠ö' },
          { name: 'Sunset Fishing', price: 70, detail: 'Êµ™Êº´ÈªÉÊòèÊµ∑Èá£Ôºå‰∫´ÂèóÂ§ïÈôΩËàáÂÇ≥Áµ±Êµ∑Èá£Ê®ÇË∂£' },
          { name: 'Sand Bank Trip', price: 100, detail: 'Â§¢ÂπªÁÑ°‰∫∫Ê≤ôÊ¥≤ÁôªÂ≥∂Ë°åÁ®ãÔºåÊ•µËá¥Â∫¶ÂÅáÊîùÂΩ±Ôºà180 ÂàÜÈêòÔºâ' }
        ]
      }
    ];

    const INITIAL_PREP = [
      { id: 'p1', category: 'ÈáçË¶ÅÊñá‰ª∂', item: 'Ë≠∑ÁÖßÊ≠£Êú¨ (ÊïàÊúü6ÂÄãÊúà‰ª•‰∏ä)', note: 'Âª∫Ë≠∞ÊãçÁÖßÂ≠òÊâãÊ©üÈõ≤Á´ØÂÇô‰ªΩ', checked: false },
      { id: 'p2', category: 'ÈáçË¶ÅÊñá‰ª∂', item: 'È¶¨ÁàæÂú∞Â§´ IMUGA Áî≥Â†±', note: 'ÊäµÈÅîÂâç96Â∞èÊôÇÂÖßÂ°´ÂØ´', checked: false, link: 'https://www.stan-travel.com/imuga-maldives-immigration/' },
      { id: 'p3', category: 'ÈáçË¶ÅÊñá‰ª∂', item: 'È¶¨‰æÜË•ø‰∫û MDAC ÈõªÂ≠êÂç°', note: 'ÊäµÈÅîÂâç3Â§©ÂÖßÂ°´ÂØ´', checked: false, link: 'https://ianchen.life/mdac-application-malaysia/' },
      { id: 'p4', category: 'ÈáçË¶ÅÊñá‰ª∂', item: 'ÊóÖÈÅäË°åÁ®ãË°®/Ê©üÁ•®/È£ØÂ∫óÊÜëË≠â', note: 'Á¥ôÊú¨ÂÇô‰ªΩ', checked: false },
      { id: 'p5', category: 'ÈáçË¶ÅÊñá‰ª∂', item: 'Êµ∑Â§ñÊóÖÈÅä‰øùÈö™ÂñÆ', note: 'ÂåÖÂê´ÈÜ´ÁôÇËàáÁè≠Ê©ü‰∏ç‰æøÈö™', checked: false },
      { id: 'p6', category: 'ÈáçË¶ÅÊñá‰ª∂', item: 'Â§ñÂπ£ÁèæÈáë (ÁæéÈáë/‰ª§Âêâ)', note: 'ÁæéÈáëÈúÄ2009Âπ¥ÂæåÊñ∞Èàî', checked: false },
      { id: 'p24', category: 'ÈáçË¶ÅÊñá‰ª∂', item: 'ÁµêÂ©öÊõ∏Á¥Ñ(ÈõªÂ≠êÁâà)', note: 'Áî≥Ë´ãËúúÊúàÁ¶ÆÊü•Èñ±', checked: false },
      { id: 'p7', category: 'ÈõªÂ≠êÈõªÂô®', item: 'Ëê¨Áî®ËΩâÊé•È†≠ (Ëã±Âºè‰∏âÂ≠î)', note: 'È¶¨ÁàæÂú∞Â§´ËàáÈ¶¨‰æÜË•ø‰∫ûÈÄöÁî®', checked: false },
      { id: 'p8', category: 'ÈõªÂ≠êÈõªÂô®', item: 'Ë°åÂãïÈõªÊ∫ê (10000mAh+)', note: 'Âá∫Êµ∑Ë°åÁ®ãÈõªÂäõÂÇôÊè¥', checked: false },
      { id: 'p10', category: 'ÈõªÂ≠êÈõªÂô®', item: 'GoPro Êàñ Èò≤Ê∞¥Áõ∏Ê©ü', note: 'Ê∞¥‰∏ãÊîùÂΩ±ÈùàÈ≠Ç', checked: false },
      { id: 'p11', category: 'Ë°£Áâ©Á©øÊê≠', item: 'Ê≥≥Ë£ù/ÊØîÂü∫Â∞º (2-3Â•ó)', note: 'Êñπ‰æøÊèõÊ¥ó', checked: false },
      { id: 'p12', category: 'Ë°£Áâ©Á©øÊê≠', item: 'Ê∞¥ÊØçË°£ (Èï∑Ë¢ñÈò≤Á£®Ë°£)', note: 'ÊµÆÊΩõÈò≤Êõ¨Èò≤ÂàÆÂÇ∑', checked: false },
      { id: 'p13', category: 'Ë°£Áâ©Á©øÊê≠', item: 'ÈÅÆÈôΩÂ∏Ω/Â¢®Èè°', note: 'Êµ∑ÈÇäÂº∑ÂÖâÂøÖÂÇô', checked: false },
      { id: 'p16', category: 'ÂÄã‰∫∫Áî®ÂìÅ', item: 'Êµ∑Ê¥ãÂèãÂñÑÈò≤Êõ¨Ê≤π', note: 'SPF50+Ôºå‰∏çÂÇ∑ÁèäÁëö', checked: false },
      { id: 'p17', category: 'ÂÄã‰∫∫Áî®ÂìÅ', item: 'ËòÜËñà‰øÆË≠∑ÂáùËÜ†', note: 'Êõ¨ÂæåËàíÁ∑©ÂøÖÂÇô', checked: false },
      { id: 'p18', category: 'ÂÄã‰∫∫Áî®ÂìÅ', item: 'ÊµÆÊΩõ‰∏âÂØ∂ (Èù¢Èè°/ÂëºÂê∏ÁÆ°)', note: 'Ë°õÁîüËÄÉÈáèÂª∫Ë≠∞Ëá™ÂÇô', checked: false },
      { id: 'p19', category: 'ÂÄã‰∫∫Áî®ÂìÅ', item: 'Èò≤Ê∞¥Ë¢ã (10-20L)', note: 'Âá∫Êµ∑‰øùË≠∑Èö®Ë∫´Áâ©ÂìÅ', checked: false },
      { id: 'p21', category: 'Â∏∏ÂÇôËó•ÂìÅ', item: 'ÊöàËàπËó• (Âº∑ÂäõÂûã)', note: 'È¶¨‰ª£Âø´Ëâá/Â∞èÈ£õÊ©üÂøÖÂÇô', checked: false },
      { id: 'p23', category: 'Â∏∏ÂÇôËó•ÂìÅ', item: 'ËÖ∏ËÉÉËó•/Ê≠¢ÁÄâËó•', note: 'È†êÈò≤Ê∞¥Âúü‰∏çÊúç', checked: false },
    ];

    const INITIAL_ITINERARY = [
      { date: '1/23', title: 'ÂêâÈöÜÂù°Â≠üÊ≤ô', activities: [{ id: '1', time: '10:25', title: 'È´òÈêµÂ∑¶Ááü -> Ê°ÉÂúí', loc: 'È´òÈêµÊ°ÉÂúíÁ´ô', note: '12:18 ÊäµÈÅîÊ°ÉÂúí' }, { id: '2', time: '15:10', title: 'MH367 Ëµ∑È£õ', loc: 'Ê°ÉÂúíÊ©üÂ†¥ T1', note: '20:05 ÊäµÈÅî KUL' }, { id: '3', time: '21:30', title: 'È£ØÂ∫ó Check-in', loc: 'Holiday Inn Bangsar', note: 'ÂêâÈöÜÂù°Á¨¨‰∏ÄÊôö' }] },
      { 
        date: '1/24', 
        title: 'Á≤æÈÅ∏‰∏ÄÊó•ÈÅä', 
        activities: [
          { id: '401', time: '10:00', title: 'Ë∞∑‰∏≠Âüé MaxMoney', loc: 'MaxMoney Mid Valley', note: 'ÊèõÂåØÈ¶ñÈÅ∏' },
          { id: '402', time: '11:00', title: 'Ë∞∑‰∏≠ÂüéËèØÈôΩËå∂ÂÆ§', loc: 'Mid Valley Oriental Kopi', note: 'ÂøÖÂêÉÊ≥¢ÁæÖÂåÖ' },
          { id: '403', time: '12:30', title: 'Ë∞∑‰∏≠ÂüéÊé°Ë≥º', loc: 'Mid Valley Megamall', note: 'Êé°Ë≤∑‰º¥ÊâãÁ¶Æ' },
          { id: '404', time: '14:00', title: 'Philo headspa', loc: 'Philo Hair & Head Spa', note: 'ÊîæÈ¨ÜÈ´îÈ©ó' },
          { id: '405', time: '16:30', title: 'Village Park Restaurant ÁÇ∏ÈõûÊ§∞ÊºøÈ£Ø', loc: 'Uptown Damansara', note: 'ÁÇ∏ÈõûÂøÖÂêÉ' },
          { id: '406', time: '18:00', title: 'È¨º‰ªîÂ∑∑', loc: 'Kwai Chai Hong', note: 'ÊñáÂåñËóùË°ìÂçÄ' },
          { id: '407', time: '19:00', title: 'REXKLÊõ∏Â±Ä', loc: 'BookXcess at REXKL', note: 'ÁâπËâ≤Êõ∏Â±Ä' },
          { id: '408', time: '20:00', title: 'ÈõôÂ≠êÂ°î', loc: 'Petronas Twin Towers', note: 'Â§úÈñìÊîùÂΩ±' },
          { id: '409', time: '21:00', title: 'Á±†ÁöÑÂÇ≥‰∫∫È§êÂª≥Êàñ‰∏âÁæéËÇâÈ™®Ëå∂', loc: 'Pavilion KL / City', note: 'ÊôöÈ§êÊôÇÂàª' },
          { id: '410', time: '22:00', title: 'ÊüèÂ®ÅÂπ¥Âª£Â†¥ÈÄõË°ó', loc: 'Pavilion Kuala Lumpur', note: 'Â∏Ç‰∏≠ÂøÉÁôæË≤®' },
          { id: '411', time: '23:00', title: 'ÂõûÈ£ØÂ∫ó', loc: 'Holiday Inn Bangsar', note: '‰ºëÊï¥‰ºëÊÅØ' }
        ] 
      },
      { date: '1/25', title: 'È£õÂêëÁæéÂ±ÖÂ∫¶ÂÅáÊùë', isMaldives: true, activities: [{ id: '7', time: '09:40', title: 'MH485 È£õÈ¶¨Á¥Ø', loc: 'KLIA T1', note: '11:00 ÊäµÈÅî' }, { id: '8', time: '16:00', title: 'ÂÖ•‰ΩèÁæéÂ±ÖÂ∫¶ÂÅáÊùë', loc: 'Mercure Maldives Kooddoo', note: 'ÂÖ®ÂåÖÂºèÂ∫¶ÂÅáÈñãÂßã' }] },
      { date: '1/26', title: 'Ê∑±Êµ∑Êé¢Á¥¢', isMaldives: true, activities: [{ id: '261', time: '09:00', title: 'Êô®ÈñìÊΩõÊ∞¥Ë™≤Á®ã', loc: 'Dive Center', note: 'PADI Ë™≤Á®ãÈÄ≤Â∫¶' }] },
      { date: '1/27', title: 'ËàπÊΩõÂÜíÈö™', isMaldives: true, activities: [{ id: '271', time: '08:30', title: 'Áí∞Á§ÅËàπÊΩõ', loc: 'Kooddoo Jetty', note: 'Êé¢Á¥¢Êõ¥ÈÅ†ÁöÑÊΩõÈªû' }] },
      { date: '1/28', title: 'Ê∞¥‰∏ãÊîùÂΩ±', isMaldives: true, activities: [{ id: '281', time: '10:00', title: 'ÁèäÁëöÁ§ÅÊµÆÊΩõ', loc: 'House Reef', note: 'Á¥ÄÈåÑË±êÂØåÁîüÊÖã' }] },
      { date: '1/29', title: 'ÊîæÈ¨ÜÊôÇÂÖâ', isMaldives: true, activities: [{ id: '291', time: '11:00', title: '‰∫´ÂèóÊ∏°ÂÅáÊùëË®≠ÊñΩ', loc: 'Pool Bar', note: 'ÂÖ®ÂåÖÂºèÈ§êÈ£≤ÊúçÂãô' }, { id: '301', time: '14:00', title: 'Êê≠ËàπÂâçÂæÄÂ±ÖÊ∞ëÂ≥∂', loc: 'Hulhumale', note: 'ÂÖ•‰Ωè h78 È£ØÂ∫ó' }] },
      { date: '1/30', title: 'ÂõûÁ®ãÂêâÈöÜÂù°', activities: [{ id: '302', time: '19:45', title: 'È£õÊäµÂêâÈöÜÂù°', loc: 'KLIA T1', note: 'MH484 ÊäµÈÅî' }, { id: '312', time: '21:30', title: 'ÂÖ•‰Ωè Umi Ê∞ëÂÆø', loc: 'Umi SplashMania homestay', note: 'Ê∫´È¶®‰ºëÊÅØÁ©∫Èñì' }] },
      { date: '1/31', title: 'Âπ≥ÂÆâË≥¶Ê≠∏', activities: [{ id: '211', time: '09:20', title: 'MH366 Ëµ∑È£õ', loc: 'KLIA T1', note: '14:10 ÊäµÈÅî TPE' }, { id: '212', time: '16:34', title: 'È´òÈêµÊ°ÉÂúí -> Â∑¶Ááü', loc: 'È´òÈêµÊ°ÉÂúíÁ´ô', note: '18:25 ÊäµÈÅîÂ∑¶Ááü' }] }
    ];

    const INITIAL_TRANSPORTS = [
      { localId: 't1', date: '01/23', id: 'È´òÈêµ 0818 Ê¨°', from: 'Â∑¶Ááü', to: 'Ê°ÉÂúí', depTime: '10:25', arrTime: '12:18', type: 'Train' },
      { localId: 't2', date: '01/23', id: 'MH 367', from: 'TPE', to: 'KUL', depTime: '15:10', arrTime: '20:05', type: 'Plane' },
      { localId: 't3', date: '01/25', id: 'MH 485', from: 'KUL', to: 'MLE', depTime: '09:40', arrTime: '11:00', type: 'Plane' },
      { localId: 't4', date: '01/30', id: 'MH 484', from: 'MLE', to: 'KUL', depTime: '12:00', arrTime: '19:45', type: 'Plane' },
      { localId: 't5', date: '01/31', id: 'MH 366', from: 'KUL', to: 'TPE', depTime: '09:20', arrTime: '14:10', type: 'Plane' },
      { localId: 't6', date: '01/31', id: 'È´òÈêµ 0841 Ê¨°', from: 'Ê°ÉÂúí', to: 'Â∑¶Ááü', depTime: '16:34', arrTime: '18:25', type: 'Train' }
    ];

    const REC_POOLS = [
      [
        { category: 'ÂêâÈöÜÂù°Á≤æÈÅ∏ KL Selection', location: 'KL', items: [
          { name: 'Village Park Restaurant', desc: 'ÂêâÈöÜÂù°ÊúÄÂ•ΩÂêÉÁöÑÊ§∞ÊºøÈ£ØÔºåÁÇ∏ÈõûËàáÈÜ¨Ê±ÅÂÆåÁæéÁµêÂêà„ÄÇ' },
          { name: 'Petronas Twin Towers', desc: 'ÊúÄÂÖ∑‰ª£Ë°®ÊÄßÁöÑÂú∞Ê®ôÂ§úÊôØÔºåÈúáÊíºÂäõÂçÅË∂≥„ÄÇ' },
          { name: 'SplashMania Waterpark', desc: 'ÂêâÈöÜÂù°ËøëÈÉäÊúÄÊñ∞Ê∞¥‰∏äÊ®ÇÂúíÔºåË®≠ÊñΩË±êÂØåÂà∫ÊøÄ„ÄÇ' }
        ]},
        { category: 'Â±ÖÊ∞ëÂ≥∂Êé¢Èö™ Hulhumale', location: 'MV', items: [
          { name: 'Hulhumale Beach', desc: 'Â§ïÈôΩÊ•µÁæéÁöÑÂÖ¨ÂÖ±Ê≤ôÁÅòÔºåÁúãÂú®Âú∞‰∫∫ÁîüÊ¥ªÁØÄÂ•è„ÄÇ' },
          { name: 'h78 Maldives Terrace', desc: 'È£ØÂ∫óÈ†ÇÊ®ìÈ§êÂª≥Ôºå‰øØÁû∞Ê©üÂ†¥Â≥∂Êµ∑ÊôØ„ÄÇ' }
        ]}
      ],
      [
        { category: 'ÂêâÈöÜÂù°ÊñáÂåñ KL Culture', location: 'KL', items: [
          { name: 'Batu Caves', desc: 'ÈªëÈ¢®Ê¥ûÔºåÂ£ØËßÄÁöÑÁü≥ÁÅ∞Â≤©Ê¥ûÁ©¥ËàáÂΩ©Ëâ≤ÈöéÊ¢Ø„ÄÇ' },
          { name: 'Jalan Alor', desc: '‰∫ûÁæÖË°óÂ§úÂ∏ÇÔºåÈ´îÈ©óÂú®Âú∞Â§ßÊéíÊ™îÁæéÈ£üÊñáÂåñ„ÄÇ' },
          { name: 'Thean Hou Temple', desc: 'Â§©ÂêéÂÆÆÔºåËûçÂêàÁèæ‰ª£ËàáÂÇ≥Áµ±ÁöÑËèØ‰∫∫ÂªüÂÆáÔºå‰øØÁû∞Â∏ÇÊôØ„ÄÇ' }
        ]},
        { category: 'È¶¨ÁàæÂú∞Â§´‰ºëÈñí Chill MV', location: 'MV', items: [
          { name: 'Local Market', desc: 'È´îÈ©óÈ¶¨ÁàæÂú∞Â§´Áï∂Âú∞Â∏ÇÈõÜÔºåÊÑüÂèóÁÜ±Â∏∂Ê∞¥ÊûúËàáÈ¶ôÊñô„ÄÇ' },
          { name: 'Central Park', desc: 'Hulhumale ‰∏≠Â§ÆÂÖ¨ÂúíÔºåÁ∂†ÊÑèÁõéÁÑ∂ÁöÑÊîæÈ¨ÜÂéªËôï„ÄÇ' }
        ]}
      ]
    ];

    // Categorized Travel Tips
    const TRAVEL_TIPS_CATEGORIES = [
      { id: 'prepare', icon: ClipboardCheck, name: 'Ë°åÂâçÈ†àÁü•', desc: 'Á∞ΩË≠â„ÄÅÊ∞£ÂÄô„ÄÅÊôÇÂ∑Æ' },
      { id: 'money', icon: Wallet, name: 'ÈáëÈå¢Ê∂àË≤ª', desc: 'ÂåØÁéá„ÄÅÂ∞èË≤ª„ÄÅÂà∑Âç°' },
      { id: 'transport', icon: Bus, name: '‰∫§ÈÄöÁßªÂãï', desc: 'Grab„ÄÅÊ©üÂ†¥„ÄÅÊ∏°Ëº™' },
      { id: 'life', icon: Info, name: 'ÁîüÊ¥ªÂØ¶Áî®', desc: 'ÈõªÂ£ì„ÄÅÁ∂≤Ë∑Ø„ÄÅÁ©øËëó' },
      { id: 'culture', icon: Star, name: 'ÊñáÂåñÁ¶ÅÂøå', desc: 'ÂÆóÊïô„ÄÅÈ£≤È£ü„ÄÅÁ¶ÆÂÑÄ' },
    ];

    const TRAVEL_TIPS_DATA = [
      { text: "È¶¨ÁàæÂú∞Â§´ÂùáÊ∫´30Â∫¶Ôºå5-10ÊúàÈõ®Â≠£ÔºõÂêâÈöÜÂù°ÂçàÂæåÂ∏∏Èõ∑Èõ®„ÄÇ", cat: "prepare" },
      { text: "ÂÖ•Â¢ÉÂ§ßÈ¶¨Ââç3Â§©Â°´MDACÔºõÈ¶¨ÁàæÂú∞Â§´Â°´IMUGAÔºåÂÖçÁ∞Ω„ÄÇ", cat: "prepare" },
      { text: "1È¶¨Âπ£‚âà7.5Âè∞Âπ£ÔºõÈ¶¨ÁàæÂú∞Â§´Áî®ÁæéÈáëÔºå1ÁæéÈáë‚âà32.5Âè∞Âπ£„ÄÇ", cat: "money" },
      { text: "È¶¨‰æÜË•ø‰∫ûÁÑ°ÊôÇÂ∑ÆÔºõÈ¶¨ÁàæÂú∞Â§´ÊÖ¢Âè∞ÁÅ£3Â∞èÊôÇ (GMT+5)„ÄÇ", cat: "prepare" },
      { text: "ÂÖ©Âú∞ÈõªÂ£ì230VÔºåÁöÜÁî®Ëã±Âºè‰∏âÂ≠îÊèíÂ∫ß (Type G)„ÄÇ", cat: "life" },
      { text: "Á∂≤Âç°Âª∫Ë≠∞eSIMÔºõÊ∏°ÂÅáÊùëÂ§öÊúâÂÖçË≤ªWiFiÔºåË®äËôüÁ©©ÂÆö„ÄÇ", cat: "life" },
      { text: "ÁÜ±Â∏∂Ê∞£ÂÄôÁ©øÈÄèÊ∞£Ë°£Áâ©ÔºåÂÆ§ÂÖßÂÜ∑Ê∞£Âº∑Âª∫Ë≠∞Â∏∂ËñÑÂ§ñÂ•ó„ÄÇ", cat: "life" },
      { text: "Ê∏ÖÁúüÂØ∫ÈúÄÁ©øÈï∑Ë¢çÔºõÂ±ÖÊ∞ëÂ≥∂Á¶ÅÈÖíÁ¶ÅË±¨ËÇâÔºåÂ∫¶ÂÅáÊùë‰∏çÈôê„ÄÇ", cat: "culture" },
      { text: "Ëá™‰æÜÊ∞¥‰∏çÂèØÁîüÈ£≤ÔºåÂª∫Ë≠∞Ë≤∑Áì∂Ë£ùÊ∞¥ÔºõÈò≤Êõ¨Ë´ãÁî®Êµ∑Ê¥ãÂèãÂñÑÊ¨æ„ÄÇ", cat: "life" },
      { text: "È¶¨ÁàæÂú∞Â§´Â∞èË≤ªÔºöË°åÊùé/Â∫äÈ†≠Á¥Ñ1-2ÁæéÈáëÔºåÊúçÂãôË≤ªÂè¶Ë®à„ÄÇ", cat: "money" },
      { text: "ÂêâÈöÜÂù°GrabÂè´Ëªä‰æøÂÆúÂèàÊñπ‰æøÔºåÂª∫Ë≠∞Á∂ÅÂÆö‰ø°Áî®Âç°‰ªòÊ¨æ„ÄÇ", cat: "transport" },
      { text: "È¶¨ÁàæÂú∞Â§´ÈÄ±‰∫îÊòØ‰∏ªÈ∫ªÊó•ÔºåÂ±ÖÊ∞ëÂ≥∂Ê∏°Ëº™ÂèØËÉΩÊ∏õÁè≠„ÄÇ", cat: "transport" },
      { text: "ÂêâÈöÜÂù°ÂøÖÂêÉËÇâÈ™®Ëå∂ÔºåÊñ∞Â≥∞ËÇâÈ™®Ëå∂Ëó•ÊùêÂë≥ÊøÉÈÉÅ„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´Âö¥Á¶ÅÊîúÂ∏∂ÈÖíÁ≤æËàáË±¨ËÇâË£ΩÂìÅÂÖ•Â¢ÉÔºåÊü•Áç≤ÊúÉÊ≤íÊî∂„ÄÇ", cat: "culture" },
      { text: "ÈõôÂ≠êÊòüÂ°îÈÄ±‰∏ÄÂÖ¨‰ºëÔºåÂèÉËßÄÁ©∫Ê©ãÂª∫Ë≠∞ÊèêÂâçÁ∂≤Ë∑ØË≥ºÁ•®„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´Ê∞¥‰∏äÈ£õÊ©ü‰∏ãÂçàÂõõÈªûÂæå‰∏çÈ£õÔºåÂÆâÊéíËà™Áè≠ÈúÄÊ≥®ÊÑè„ÄÇ", cat: "transport" },
      { text: "ÂêâÈöÜÂù°ÈÅéÈ¶¨Ë∑ØË¶ÅÂ∞èÂøÉÔºåÊë©ÊâòËªäÊúâÊôÇÊúÉÈ®é‰∏ä‰∫∫Ë°åÈÅì„ÄÇ", cat: "life" },
      { text: "È¶¨ÁàæÂú∞Â§´ÁèäÁëöËÑÜÂº±ÔºåÊΩõÊ∞¥ÊôÇË´ãÂãøËß∏Êë∏ÊàñË∏©Ë∏è„ÄÇ", cat: "culture" },
      { text: "ÈªëÈ¢®Ê¥ûÈöéÊ¢ØÊúâ272ÈöéÔºå‰∏îÈáéÁîüÁå¥Â≠êÂ§öÔºåË´ãÂãøÈ§µÈ£ü„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´ÁæéÈáëÊñ∞ÈàîË¶ÅÊ±ÇÂö¥Ê†ºÔºåÁ†¥ÊêçÊàñÊë∫ÁóïÂ∏∏Ë¢´ÊãíÊî∂„ÄÇ", cat: "money" },
      { text: "ÂêâÈöÜÂù°‰∏≠Â§ÆËªäÁ´ôKL SentralÊòØ‰∫§ÈÄöÊ®ûÁ¥êÔºåËΩâ‰πòÊñπ‰æø„ÄÇ", cat: "transport" },
      { text: "È¶¨ÁàæÂú∞Â§´Â±ÖÊ∞ëÂ≥∂Á©øËëóÈúÄ‰øùÂÆàÔºåÊØîÂü∫Â∞ºÂÉÖÈôêÊØîÂü∫Â∞ºÊ≤ôÁÅò„ÄÇ", cat: "culture" },
      { text: "‰∫ûÁæÖË°óJalan AlorÊòØÂÆµÂ§úÂ•ΩÂéªËôïÔºåÊ≤ôÂó≤ÈõûÁøÖÂøÖÈªû„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´Âá∫Êµ∑ÁúãÊµ∑Ë±öÊ©üÁéáÈ´òÔºå‰ΩÜ‰ªçÂ±¨Ëá™ÁÑ∂ÁîüÊÖã‰∏ç‰øùË≠â„ÄÇ", cat: "culture" },
      { text: "ÂêâÈöÜÂù°Ê≠¶ÂêâÂÖçÁôªÂçÄÁôæË≤®ÊûóÁ´ãÔºåPavilionÈÅ©ÂêàÈÄõË°ó„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´ÈÉ®ÂàÜÂ±ÖÊ∞ëÂ≥∂ÊúâËöäËü≤ÔºåÂª∫Ë≠∞ÊîúÂ∏∂Èò≤ËöäÊ∂≤„ÄÇ", cat: "life" },
      { text: "ÂêâÈöÜÂù°Ëå®Âª†Ë°óÊòØÂîê‰∫∫Ë°óÔºåË≤∑Êù±Ë•øË®òÂæóË¶ÅÊÆ∫ÂÉπ„ÄÇ", cat: "money" },
      { text: "È¶¨ÁàæÂú∞Â§´Ê∏°ÂÅáÊùëÊ∂àË≤ªÈ´òÔºåÂÖ®ÂåÖÂºèÊñπÊ°àËºÉÁúÅÂøÉ„ÄÇ", cat: "money" },
      { text: "È¶¨‰æÜË•ø‰∫û‰∫∫ÁøíÊÖ£Áî®Âè≥ÊâãÂêÉÈ£ØËàáÊè°ÊâãÔºåÂ∑¶ÊâãË¶ñÁÇ∫‰∏çÊΩî„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´ÊèíÂ∫ßËã•ÁÑ°ÈñãÈóúÔºåÈúÄÁïôÊÑèÊòØÂê¶ÈÄöÈõª„ÄÇ", cat: "life" },
      { text: "ÂêâÈöÜÂù°Ê©üÂ†¥KLIAËàáKLIA2Ëà™Âªà‰∏çÂêåÔºåËΩâÊ©üÈúÄÊê≠Âø´Èêµ„ÄÇ", cat: "transport" },
      { text: "È¶¨ÁàæÂú∞Â§´Êµ∑Èæú‰øùËÇ≤Âö¥Ê†ºÔºåËß∏Êë∏Êµ∑ÈæúÊòØÈÅïÊ≥ïË°åÁÇ∫„ÄÇ", cat: "culture" },
      { text: "ÂêâÈöÜÂù°Âú∞ÈêµMRTÂÜ∑Ê∞£Ê•µÂº∑ÔºåÊê≠‰πòÊôÇÂª∫Ë≠∞ÂÇôËñÑÂ§ñÂ•ó„ÄÇ", cat: "life" },
      { text: "È¶¨ÁàæÂú∞Â§´Ê≤ôÊ¥≤ÈáéÈ§êÊòØÁÜ±ÈñÄË°åÁ®ãÔºåË®òÂæóÂ∏∂Â¢®Èè°Èò≤Áú©ÂÖâ„ÄÇ", cat: "life" },
      { text: "È¶¨‰æÜË•ø‰∫ûÂ§öÂÖÉÁ®ÆÊóèÔºåÂ∏∏Ë¶ãÈ¶¨‰æÜË™û„ÄÅËã±Ë™û„ÄÅËèØË™û‰∫§Èõú„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´ÊµÆÊΩõ‰∏âÂØ∂Âª∫Ë≠∞Ëá™ÂÇôÔºåË°õÁîüÂèàÂêàËáâÂûã„ÄÇ", cat: "life" },
      { text: "ÂêâÈöÜÂù°Á≤âÁ¥ÖÊ∏ÖÁúüÂØ∫Âú®Â∏ÉÂüéÔºåË∑ùÈõ¢Â∏ÇÂçÄÁ¥Ñ30ÂàÜÈêòËªäÁ®ã„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´Èõ®Â≠£Êµ™Â§ßÔºåÊòìÊöàËàπËÄÖÂãôÂøÖÊ∫ñÂÇôÊöàËàπËó•„ÄÇ", cat: "life" },
      { text: "ÂêâÈöÜÂù°‰∏ªË¶Å‰ΩøÁî®Touch 'n GoÂç°ÔºåÈ°û‰ººÂè∞ÁÅ£ÊÇ†ÈÅäÂç°„ÄÇ", cat: "transport" },
      { text: "È¶¨ÁàæÂú∞Â§´‰∏çÂèØÂ∏∂Ëµ∞Ë≤ùÊÆºÊàñÊ≤ôÂ≠êÔºåÂá∫Â¢ÉÊúÉË¢´Êµ∑ÈóúÊü•Êâ£„ÄÇ", cat: "culture" },
      { text: "ÂêâÈöÜÂù°ËàäË°óÂ†¥ÁôΩÂíñÂï°ÊòØÁ∂ìÂÖ∏‰º¥ÊâãÁ¶ÆÔºåË∂ÖÂ∏ÇË≤∑ËºÉ‰æøÂÆú„ÄÇ", cat: "money" },
      { text: "È¶¨ÁàæÂú∞Â§´Â±ÖÊ∞ëÂ≥∂ÈÄ±‰∫îÂïÜÂ∫óÂèØËÉΩÈÖçÂêàÁ•àÁ¶±ÊôÇÈñìÊö´ÂÅúÁáüÊ•≠„ÄÇ", cat: "life" },
      { text: "È¶¨‰æÜË•ø‰∫ûËå∂ÂÆ§ÈªûÈ£≤ÊñôË™™„ÄåÈõ™Ëå∂„ÄçÊåáÁöÑÊòØÂÜ∞Ëå∂ÔºàÁÑ°Á≥ñÔºâ„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´Â§úÈá£Ë°åÁ®ãËã•Èá£Âà∞È≠öÔºåÈ§êÂª≥ÈÄöÂ∏∏ÂèØÂπ´ÂøôÊñôÁêÜ„ÄÇ", cat: "culture" },
      { text: "ÂêâÈöÜÂù°KLCCÂÖ¨ÂúíÊôö‰∏äÊúâÈü≥Ê®ÇÂô¥Ê≥âÁßÄÔºåÂÖçË≤ªÊ¨£Ë≥û„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´Ê∏°ÂÅáÊùëÈÄöÂ∏∏Êèê‰æõÈ£≤Áî®Ê∞¥Ôºå‰∏çÈúÄÂæûÊú¨Â≥∂ÊâõÊ∞¥„ÄÇ", cat: "life" },
      { text: "È¶¨‰æÜË•ø‰∫ûÂç∞Â∫¶ÁÖéÈ§ÖRoti CanaiÊòØÊó©È§êÁÜ±ÈñÄÈÅ∏Êìá„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´Â§™ÈôΩËºªÂ∞ÑÂº∑ÔºåÊµÆÊΩõÂãôÂøÖÁ©øÊ∞¥ÊØçË°£Èò≤Êõ¨ÂÇ∑„ÄÇ", cat: "life" },
      { text: "ÂêâÈöÜÂù°GrabÂ∞ñÂ≥∞ÊôÇÊÆµÊòìÂ°ûËªäÔºåË∂ïÈ£õÊ©üË´ãÈ†êÁïôÊôÇÈñì„ÄÇ", cat: "transport" },
      { text: "È¶¨ÁàæÂú∞Â§´È£ØÂ∫ó‰∏çÊèê‰æõÁâôÂà∑ÁâôËÜèÔºåÈúÄËá™ÂÇôÁõ•Ê¥óÁî®ÂÖ∑„ÄÇ", cat: "life" },
      { text: "È¶¨‰æÜË•ø‰∫ûÂªÅÊâÄÂ§öÊúâÊ¥óÂ±ÅËÇ°ÁÆ°Á∑öÔºåÂú∞ÊùøÂ∏∏ÊòØÊøïÁöÑ„ÄÇ", cat: "life" },
      { text: "È¶¨ÁàæÂú∞Â§´Ê©üÂ†¥Â≥∂HulhumaleÊúâÂÖ¨ËªäÈÄöÂæÄÊ©üÂ†¥Ôºå‰æøÂÆú‰æøÂà©„ÄÇ", cat: "transport" },
      { text: "ÂêâÈöÜÂù°Áç®Á´ãÂª£Â†¥Âë®ÈÇäÊúâË®±Â§öÊÆñÊ∞ëÈ¢®Ê†ºÂª∫ÁØâÔºåÈÅ©ÂêàÊãçÁÖß„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´ÈØ®ÈØäÂá∫Ê≤íÈªûÂ§öÂú®ÂçóÈòøÈáåÁí∞Á§ÅÔºåÂèØÂèÉÂä†‰∏ÄÊó•ÈÅä„ÄÇ", cat: "culture" },
      { text: "È¶¨‰æÜË•ø‰∫ûÊ¶¥Êß§Â≠£ÁØÄÁ¥ÑÂú®6-8ÊúàÔºåË≤ìÂ±±ÁéãÊúÄÂèóÊ≠°Ëøé„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´Â∞èË≤ª‰∏çÂèØÁµ¶Á°¨Âπ£ÔºåÁï∂Âú∞‰∫∫ÁÑ°Ê≥ïÂÖåÊèõ„ÄÇ", cat: "money" },
      { text: "ÂêâÈöÜÂù°NU SentralÁôæË≤®Ëàá‰∏≠Â§ÆËªäÁ´ôÂÖ±ÊßãÔºåÈÄõË°óÊñπ‰æø„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´ÁÑ°‰∫∫Ê©üÁ©∫ÊãçÈúÄ‰∫ãÂÖàÂêëÊ∏°ÂÅáÊùëÁî≥Ë´ãË®±ÂèØ„ÄÇ", cat: "culture" },
      { text: "È¶¨‰æÜË•ø‰∫ûKayaÂíñÊ§∞ÈÜ¨ÈÖçÂêêÂè∏ÊòØÈÅìÂú∞ÂçóÊ¥ãÈ¢®Âë≥„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´Â±ÖÊ∞ëÂ≥∂È§êÂª≥‰∏äËèúÈÄüÂ∫¶ÊÖ¢ÔºåË¶ÅÊúâÂøÉÁêÜÊ∫ñÂÇô„ÄÇ", cat: "life" },
      { text: "ÂêâÈöÜÂù°Â°îKL TowerÊôØËßÄÂè∞Ë¶ñÈáéÊØîÈõôÂ≠êÊòüÂ°îÊõ¥ÈñãÈóä„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´ÊΩõÊ∞¥ÈúÄÂá∫Á§∫Ë≠âÁÖßÔºåÈ´îÈ©óÊΩõÊ∞¥Ê∑±Â∫¶ÊúâÈôêÂà∂„ÄÇ", cat: "culture" },
      { text: "È¶¨‰æÜË•ø‰∫ûÈÉ®ÂàÜÈ§êÂª≥Êî∂10%ÊúçÂãôË≤ªËàá6%ÊîøÂ∫úÁ®Ö„ÄÇ", cat: "money" },
      { text: "È¶¨ÁàæÂú∞Â§´Êó∫Â≠£ÁÇ∫11-4ÊúàÔºåÊàøÂÉπËºÉÈ´ò‰ΩÜÂ§©Ê∞£Á©©ÂÆö„ÄÇ", cat: "prepare" },
      { text: "ÂêâÈöÜÂù°È¨º‰ªîÂ∑∑ÊúâÂ£ÅÁï´ËàáÁâπËâ≤ÂíñÂï°Âª≥ÔºåÊñáÈùíÂøÖË®™„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´Â±ÖÊ∞ëÂ≥∂ÊèõÂåØÂåØÁéáÈÄöÂ∏∏ÊØîÊ©üÂ†¥Â•Ω‰∏ÄÈªû„ÄÇ", cat: "money" },
      { text: "È¶¨‰æÜË•ø‰∫û‰∫∫ÈÅéÈ¶¨Ë∑ØÊúÉËàâÊâãÁ§∫ÊÑèÔºåËªäËºõÈÄöÂ∏∏ÊúÉÁ¶ÆËÆì„ÄÇ", cat: "transport" },
      { text: "È¶¨ÁàæÂú∞Â§´ÈÉ®ÂàÜÊ∏°ÂÅáÊùëÊôÇÂçÄÊúÉÂø´È¶¨Á¥Ø1Â∞èÊôÇÔºå‰∫´Êõ¥Â§öÈôΩÂÖâ„ÄÇ", cat: "prepare" },
      { text: "ÂêâÈöÜÂù°Saloma LinkË°å‰∫∫Â§©Ê©ãÂ§úÈñìÈªûÁáàÂæàÁæé„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´Âá∫Êµ∑Ë°åÁ®ãÁõ°ÈáèÁ©øÈÆÆË±îÊ≥≥Ë°£ÔºåÊãçÁÖßÊõ¥Âá∫Ëâ≤„ÄÇ", cat: "life" },
      { text: "È¶¨‰æÜË•ø‰∫ûMamakÊ™îÊòØ24Â∞èÊôÇÁáüÊ•≠ÔºåÂçäÂ§ú‰∏çÊÄïÈ§ì„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´Â∫¶ÂÅáÊùëÊ∞¥‰∏äÂ±ãÂª∫Ë≠∞‰ΩèÂÖ©ÊôöÈ´îÈ©óÂç≥ÂèØ„ÄÇ", cat: "prepare" },
      { text: "ÂêâÈöÜÂù°PavilionÈñÄÂè£ÁöÑÂ§ßÁ¢óÂÖ¨Âô¥Ê≥âÊòØÁÜ±ÈñÄÊúÉÈù¢Èªû„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´ÈÉ®ÂàÜÁèäÁëöÁ§ÅÊúâÂº∑ÊµÅÔºåÊµÆÊΩõÂãôÂøÖÁ©øÊïëÁîüË°£„ÄÇ", cat: "life" },
      { text: "È¶¨‰æÜË•ø‰∫ûËÇØÂæ∑Âü∫KFCÊúâÁç®ÁâπÂè£Âë≥ÔºåÂÉπÊ†º‰πüË¶™Ê∞ë„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´Â±ÖÊ∞ëÂ≥∂ÈÄ±‰∫îÊ∏°Ëº™ÂÅúÈßõÔºåÈúÄÊîπÊê≠Âø´Ëâá„ÄÇ", cat: "transport" },
      { text: "ÂêâÈöÜÂù°‰∏≠Â§ÆËóùË°ìÂùäCentral MarketÂèØË≤∑ÊâãÂ∑•ËóùÂìÅ„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´ÂøÖË≤∑ÈÆ™È≠öÁΩêÈ†≠ÔºåÊòØÁï∂Âú∞ÁâπÁî¢‰∏î‰æøÂÆú„ÄÇ", cat: "money" },
      { text: "È¶¨‰æÜË•ø‰∫ûBataÈûãÂ≠ê‰æøÂÆúÂ•ΩÁ©øÔºåÊòØÂúãÊ∞ëÂìÅÁâå„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´ÈÄÄÊàøÂæåËã•ÊôöÁè≠Ê©üÔºåÂèØÂØÑÊîæË°åÊùéÈÄõÈ¶¨Á¥Ø„ÄÇ", cat: "transport" },
      { text: "ÂêâÈöÜÂù°Thean Hou TempleÂ§©ÂêéÂÆÆËûçÂêàÂ§öÁ®ÆÂª∫ÁØâÈ¢®Ê†º„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´Ê∏°ÂÅáÊùëÂÖßËá™Ë≤ªÈ§êÈ£≤ÊòÇË≤¥ÔºåÊ∞¥‰∏ÄÁì∂Á¥Ñ5-10ÁæéÈáë„ÄÇ", cat: "money" },
      { text: "È¶¨‰æÜË•ø‰∫û‰æøÂà©ÂïÜÂ∫óÈô§‰∫Ü7-11ÈÇÑÊúâKK MartËàáFamilyMart„ÄÇ", cat: "life" },
      { text: "È¶¨ÁàæÂú∞Â§´Êúâ‰∫õÂ≥∂Â∂ºÊúâÁôºÂÖâÊµÆÊ∏∏ÁîüÁâ©Ôºå‰øóÁ®±ËóçÁúºÊ∑ö„ÄÇ", cat: "culture" },
      { text: "ÂêâÈöÜÂù°Â∫∑Ê®ÇÂ§úÂ∏ÇÈÄ±‰∏âÈôêÂÆöÔºåÂÖ®Èï∑2ÂÖ¨ÈáåË∂ÖÂ•ΩÈÄõ„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´Â±ÖÊ∞ëÂ≥∂Ë∂ÖÂ∏ÇÂèØË≤∑Èõ∂È£üÔºåÂÉπÊ†ºÊØîÊ∏°ÂÅáÊùëË¶™Ê∞ë„ÄÇ", cat: "money" },
      { text: "È¶¨‰æÜË•ø‰∫ûTeh TarikÊãâËå∂ÁîúÂ∫¶È´òÔºåÊÄïÁîúÂèØÂñäÂ∞ëÁ≥ñ„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´Êê≠‰πòÂø´ËâáÂÆπÊòìÈ°õÁ∞∏ÔºåÁõ°ÈáèÂùêËàπÂ∞æËºÉÁ©©„ÄÇ", cat: "transport" },
      { text: "ÂêâÈöÜÂù°Âüé‰∏≠ÂüéÂÖ¨ÂúíKLCC ParkÊúâÂÖíÁ´•Êà≤Ê∞¥ÂçÄ„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´ÈÉ®ÂàÜÊ∏°ÂÅáÊùëÁ¶ÅÊ≠¢ÊîúÂ∏∂Á©∫ÊãçÊ©üÔºåË´ãÂÖàÁ¢∫Ë™ç„ÄÇ", cat: "culture" },
      { text: "È¶¨‰æÜË•ø‰∫ûË∑ØÈÇäÊî§Ë°õÁîü‰∏ç‰∏ÄÔºåËÖ∏ËÉÉÊïèÊÑüËÄÖË´ãÊÖéÈÅ∏„ÄÇ", cat: "life" },
      { text: "È¶¨ÁàæÂú∞Â§´Ê∑°Â≠£5-10ÊúàÊàøÂÉπ‰æøÂÆúÔºå‰ΩÜÈÅáÂà∞‰∏ãÈõ®Ê©üÁéáÈ´ò„ÄÇ", cat: "prepare" },
      { text: "ÂêâÈöÜÂù°ÊåâÊë©CPÂÄºÈ´òÔºåÊ≠¶ÂêâÂÖçÁôªÂçÄÊúâÂæàÂ§öÈÅ∏Êìá„ÄÇ", cat: "life" },
      { text: "È¶¨ÁàæÂú∞Â§´Ê≤ôÁÅòÂ±ãÈÄöÂ∏∏Èõ¢Êµ∑ËøëÔºåÈÅ©ÂêàÊúâÂ∞èÂ≠©ÂÆ∂Â∫≠„ÄÇ", cat: "prepare" },
      { text: "È¶¨‰æÜË•ø‰∫ûÈÅéÂπ¥ÊúüÈñìÂêâÈöÜÂù°ÂÉèÁ©∫ÂüéÔºåÂæàÂ§öÂ∫ó‰ºë„ÄÇ", cat: "life" },
      { text: "È¶¨ÁàæÂú∞Â§´Áï∂Âú∞Ë∂ÖÂ∏ÇÈÄ±‰∫î‰∏≠Âçà11-14ÈªûÈÄöÂ∏∏‰ºëÊÅØÁ•àÁ¶±„ÄÇ", cat: "life" },
      { text: "ÂêâÈöÜÂù°Âà∞È¶¨ÂÖ≠Áî≤ËªäÁ®ãÁ¥Ñ2Â∞èÊôÇÔºåÈÅ©ÂêàÂÆâÊéí‰∏ÄÊó•ÈÅä„ÄÇ", cat: "transport" },
      { text: "È¶¨ÁàæÂú∞Â§´Â∫¶ÂÅáÊùëÊàøÂÖßÊèíÈ†≠Â§öÊòØËê¨Áî®Â≠îÔºåÂÖçËΩâÊé•È†≠„ÄÇ", cat: "life" },
      { text: "È¶¨‰æÜË•ø‰∫ûÈõ≤È†ÇÈ´òÂéüÊòØÈÅøÊöëÂãùÂú∞ÔºåÊúâË≥≠Â†¥ËàáÊ®ÇÂúí„ÄÇ", cat: "culture" },
      { text: "È¶¨ÁàæÂú∞Â§´Ëã•‰ΩèÂ±ÖÊ∞ëÂ≥∂ÔºåË®òÂæóÂ∞äÈáçÁï∂Âú∞‰ºäÊñØËò≠Áøí‰øó„ÄÇ", cat: "culture" }
    ];

    function TravelTipsWidget() {
      const [showSearch, setShowSearch] = useState(false);
      const [query, setQuery] = useState('');
      const [tipIdx, setTipIdx] = useState(0);
      const [selectedCat, setSelectedCat] = useState(null);
      const [showScrollTop, setShowScrollTop] = useState(false);
      // New state to control the visibility of the minimized tip bubble
      const [showMinimizedTip, setShowMinimizedTip] = useState(true);

      useEffect(() => {
        if (showSearch) return;
        const interval = setInterval(() => {
          setTipIdx(prev => (prev + 1) % TRAVEL_TIPS_DATA.length);
        }, 8000);
        return () => clearInterval(interval);
      }, [showSearch]);

      useEffect(() => {
        const handleScroll = () => {
          if (window.scrollY > 300) {
            setShowScrollTop(true);
          } else {
            setShowScrollTop(false);
          }
        };
        window.addEventListener('scroll', handleScroll);
        return () => window.removeEventListener('scroll', handleScroll);
      }, []);

      const scrollToTop = () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      };

      const keywordMap = {
        'Èå¢': ['ÂåØÁéá', 'ÁæéÈáë', 'È¶¨Âπ£', 'Â∞èË≤ª', 'Âà∑Âç°', 'ÁèæÈáë', 'Ëä±Ë≤ª'],
        '‰∫§ÈÄö': ['Grab', 'Ë®àÁ®ãËªä', 'Êç∑ÈÅã', 'Âú∞Èêµ', 'Ê©üÂ†¥', 'È£õÊ©ü', 'Ëàπ'],
        'ÂêÉ': ['ÁæéÈ£ü', 'È§êÂª≥', 'ËÇâÈ™®Ëå∂', 'Ê¶¥Êß§', 'Âè£Âë≥', 'Êó©È§ê'],
        'Â§©Ê∞£': ['Èõ®Â≠£', 'Ê∞£Ê∫´', 'ÁÜ±', 'Èõ∑Èõ®'],
        'Èõª': ['ÊèíÂ∫ß', 'ÈõªÂ£ì', 'ÂÖÖÈõª'],
        'Á∂≤': ['WiFi', 'SIM', 'Á∂≤Âç°']
      };

      const filteredTips = useMemo(() => {
        let results = TRAVEL_TIPS_DATA;
        
        if (selectedCat) {
          results = results.filter(t => t.cat === selectedCat);
        }

        if (query.trim()) {
          const q = query.trim().toLowerCase();
          let searchTerms = [q];
          Object.entries(keywordMap).forEach(([key, values]) => {
            if (q.includes(key)) searchTerms = [...searchTerms, ...values];
          });

          results = results.filter(t => 
             searchTerms.some(term => t.text.toLowerCase().includes(term))
          );
        }

        return results;
      }, [query, selectedCat]);

      return (
        <div className="fixed bottom-24 right-4 z-[9999] flex flex-col items-end gap-2">
          
          {/* 1. Search Panel */}
          <div 
            className={`bg-white/80 backdrop-blur-xl border border-white/50 p-4 rounded-2xl rounded-br-none shadow-2xl mb-1 w-72 pointer-events-auto transition-all duration-300 origin-bottom-right ${showSearch ? 'scale-100 opacity-100 translate-y-0' : 'scale-95 opacity-0 translate-y-4 pointer-events-none absolute invisible'}`}
            style={{ display: showSearch ? 'block' : 'none' }}
          >
            <div className="space-y-3">
              <div className="flex justify-between items-center pb-2 border-b border-[#F5EBE0]/50">
                <h3 className="text-xs font-black text-[#A68A71] uppercase tracking-widest">Travel Tips</h3>
                <button onClick={() => setShowSearch(false)} className="clickable-widget p-1"><X size={16} className="text-[#A68A71]" /></button>
              </div>
              
              <div className="flex items-center gap-2 bg-white/50 rounded-xl px-2 py-1 border border-white/60">
                <Search size={14} className="text-[#A68A71]" />
                <input 
                  type="text" 
                  value={query}
                  onChange={(e) => setQuery(e.target.value)}
                  placeholder="ÊêúÂ∞ãÈå¢„ÄÅ‰∫§ÈÄö„ÄÅÂ§©Ê∞£..."
                  className="clickable-widget text-xs w-full outline-none bg-transparent text-[#4E342E] placeholder:text-[#D8C4B6] py-1"
                />
                {query && <button onClick={() => setQuery('')} className="clickable-widget"><X size={12} className="text-[#A68A71]" /></button>}
              </div>

              <div className="flex gap-2 overflow-x-auto no-scrollbar pb-1">
                <button 
                  onClick={() => setSelectedCat(null)}
                  className={`clickable-widget flex-shrink-0 px-3 py-1.5 rounded-full text-[10px] font-bold transition-all ${!selectedCat ? 'bg-[#4E342E] text-white' : 'bg-white/60 text-[#A68A71] border border-white/60'}`}
                >
                  ÂÖ®ÈÉ®
                </button>
                {TRAVEL_TIPS_CATEGORIES.map(cat => (
                  <button 
                    key={cat.id}
                    onClick={() => setSelectedCat(selectedCat === cat.id ? null : cat.id)}
                    className={`clickable-widget flex-shrink-0 px-3 py-1.5 rounded-full text-[10px] font-bold transition-all flex items-center gap-1 ${selectedCat === cat.id ? 'bg-[#D8C4B6] text-white' : 'bg-white/60 text-[#A68A71] border border-white/60'}`}
                  >
                    <cat.icon size={10} /> {cat.name}
                  </button>
                ))}
              </div>

              <div className="min-h-[100px] max-h-60 overflow-y-auto no-scrollbar space-y-2 pr-1">
                {filteredTips.length > 0 ? (
                  filteredTips.map((tip, i) => (
                    <div key={i} className="flex gap-3 py-2 border-b border-[#F5EBE0]/50 last:border-0 group">
                      <div className="mt-0.5 text-[#D8C4B6]"><Tag size={12} /></div>
                      <p className="text-xs text-[#4E342E] leading-relaxed">{tip.text}</p>
                    </div>
                  ))
                ) : (
                  <div className="text-center py-6 text-[#A68A71] text-xs">
                    <p>Êâæ‰∏çÂà∞Áõ∏ÈóúË≥áË®ä üê¢</p>
                    <p className="text-[9px] mt-1 opacity-60">Ë©¶Ë©¶„ÄåÈå¢„ÄçÊàñ„Äå‰∫§ÈÄö„ÄçÁ≠âÈóúÈçµÂ≠ó</p>
                  </div>
                )}
              </div>
            </div>
          </div>

          {/* 2. Minimized Bubble with X Button */}
          {!showSearch && showMinimizedTip && (
             <div className="bg-white/80 backdrop-blur-xl border border-white/50 px-4 py-2 rounded-2xl rounded-br-none shadow-lg mb-2 max-w-[200px] transition-all duration-500 animate-in fade-in slide-in-from-bottom-2 pointer-events-auto relative group">
                <button 
                  onClick={(e) => { e.stopPropagation(); setShowMinimizedTip(false); }}
                  className="clickable-widget absolute -top-2 -right-2 bg-[#A68A71] text-white rounded-full p-0.5 shadow-sm opacity-0 group-hover:opacity-100 transition-opacity"
                  aria-label="Close Tip"
                >
                  <X size={10} />
                </button>
                <p className="text-[10px] font-bold text-[#4E342E] line-clamp-2 leading-relaxed">
                  {TRAVEL_TIPS_DATA[tipIdx].text}
                </p>
             </div>
          )}

          {/* 3. Control Buttons - Stacked Vertically */}
          <div className="flex flex-col items-center gap-3 pointer-events-auto mt-2">
            <button 
              onClick={(e) => { 
                e.stopPropagation(); 
                if (!showMinimizedTip) {
                  setShowMinimizedTip(true); 
                } else {
                  setTipIdx(prev => (prev + 1) % TRAVEL_TIPS_DATA.length); 
                }
              }}
              className="clickable-widget w-12 h-12 bg-[#4E342E] rounded-full shadow-xl flex items-center justify-center text-white hover:scale-110 active:scale-95 transition-all border-2 border-[#D8C4B6] cursor-pointer z-[110]"
              aria-label={showMinimizedTip ? "Next Tip" : "Show Tip"}
            >
              <Bot size={24} />
            </button>

            <button 
              onClick={(e) => { e.stopPropagation(); setShowSearch(!showSearch); }}
              className={`clickable-widget w-12 h-12 bg-white text-[#4E342E] rounded-full shadow-lg flex items-center justify-center border-2 border-[#F5EBE0] transition-all hover:scale-110 active:scale-95 cursor-pointer z-[110] ${showSearch ? 'ring-2 ring-[#D8C4B6] bg-white' : ''}`}
              aria-label="Search Tips"
            >
              {showSearch ? <X size={20} /> : <Lightbulb size={20} />}
            </button>

             {/* Scroll To Top Button */}
            {showScrollTop && (
              <button 
                onClick={scrollToTop}
                className="clickable-widget w-12 h-12 bg-[#D8C4B6] rounded-full shadow-xl flex items-center justify-center text-white hover:scale-110 active:scale-95 transition-all animate-in fade-in slide-in-from-bottom-4 z-[110]"
                aria-label="Scroll to top"
              >
                <ArrowUp size={24} />
              </button>
            )}
          </div>
        </div>
      );
    }
    
    function PreparationView({ prepList, setPrepList }) {
      const categories = ['ÈáçË¶ÅÊñá‰ª∂', 'ÈõªÂ≠êÈõªÂô®', 'Ë°£Áâ©Á©øÊê≠', 'ÂÄã‰∫∫Áî®ÂìÅ', 'Â∏∏ÂÇôËó•ÂìÅ'];
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [newItem, setNewItem] = useState({ item: '', category: 'ÈáçË¶ÅÊñá‰ª∂', note: '' });
      const [editingId, setEditingId] = useState(null);

      const handleSaveItem = () => {
        if (!newItem.item.trim()) return;
        if (editingId) {
          setPrepList(prepList.map(p => p.id === editingId ? { ...p, ...newItem } : p));
        } else {
          setPrepList([...prepList, { ...newItem, id: 'custom-' + Date.now(), checked: false }]);
        }
        setIsModalOpen(false);
        setNewItem({ item: '', category: 'ÈáçË¶ÅÊñá‰ª∂', note: '' });
        setEditingId(null);
      };

      const handleEdit = (item) => {
        setNewItem({ item: item.item, category: item.category, note: item.note });
        setEditingId(item.id);
        setIsModalOpen(true);
      };

      const handleDelete = (id) => {
        if (confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§È†ÖÁõÆÂóéÔºü')) {
          setPrepList(prepList.filter(p => p.id !== id));
        }
      };

      return (
        <div className="fade-in space-y-6">
          <div className="flex justify-between items-center px-2">
            <h2 className="text-3xl font-bold serif text-[#4E342E]">Ê∫ñÂÇôÊ∏ÖÂñÆ</h2>
            <button onClick={() => { setEditingId(null); setNewItem({ item: '', category: 'ÈáçË¶ÅÊñá‰ª∂', note: '' }); setIsModalOpen(true); }} className="w-10 h-10 bg-[#4E342E] text-white rounded-xl flex items-center justify-center shadow-lg active:scale-95 transition-all"><Plus size={20} /></button>
          </div>
          <div className="space-y-8 pb-10">
            {categories.map(cat => (
              <div key={cat} className="space-y-3">
                <h3 className="text-[10px] font-black text-[#A68A71] uppercase tracking-[0.2em] px-2">{cat}</h3>
                <div className="grid gap-2">
                  {prepList.filter(p => p.category === cat).map(p => (
                    <div key={p.id} className="bg-white p-4 rounded-2xl border border-[#F5EBE0] flex items-center gap-4 shadow-sm hover:border-[#D8C4B6] transition-all group">
                      <div className={`checkbox-custom flex-shrink-0 ${p.checked ? 'checked' : ''}`} onClick={() => setPrepList(prepList.map(item => item.id === p.id ? {...item, checked: !item.checked} : item))} />
                      <div className={`flex-1 ${p.checked ? 'opacity-40' : ''}`}>
                        <div className={`font-bold text-sm ${p.checked ? 'line-through' : ''} flex items-center gap-2`}>
                          {p.item}
                          {p.link && (
                            <a href={p.link} target="_blank" rel="noopener noreferrer" className="text-[#A68A71] hover:text-[#4E342E]" onClick={(e) => e.stopPropagation()}>
                              <Paperclip size={14} />
                            </a>
                          )}
                        </div>
                        <div className="text-[10px] text-[#A68A71] italic">{p.note}</div>
                      </div>
                      <div className="flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                        <button onClick={(e) => { e.stopPropagation(); handleEdit(p); }} className="text-[#A68A71] hover:text-[#4E342E]"><Edit2 size={16} /></button>
                        <button onClick={(e) => { e.stopPropagation(); handleDelete(p.id); }} className="text-[#A68A71] hover:text-red-500"><Trash2 size={16} /></button>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            ))}
          </div>
          {isModalOpen && (
            <div className="modal-overlay" onClick={() => setIsModalOpen(false)}>
              <div className="bg-white w-full max-w-sm rounded-[2.5rem] p-8 space-y-4 shadow-2xl" onClick={e => e.stopPropagation()}>
                <h3 className="text-xl font-bold serif text-[#4E342E]">{editingId ? 'Á∑®ËºØÊ∫ñÂÇôÈ†ÖÁõÆ' : 'Êñ∞Â¢ûÊ∫ñÂÇôÈ†ÖÁõÆ'}</h3>
                <div className="space-y-3">
                  <div>
                    <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">È†ÖÁõÆÂêçÁ®±</label>
                    <input type="text" value={newItem.item} onChange={e => setNewItem({...newItem, item: e.target.value})} placeholder="‰æãÂ¶ÇÔºöÁõ∏Ê©üÈõªÊ±†" />
                  </div>
                  <div>
                    <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">ÂàÜÈ°û</label>
                    <select value={newItem.category} onChange={e => setNewItem({...newItem, category: e.target.value})}>{categories.map(c => <option key={c} value={c}>{c}</option>)}</select>
                  </div>
                  <div>
                    <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">ÂÇôË®ª</label>
                    <input type="text" value={newItem.note} onChange={e => setNewItem({...newItem, note: e.target.value})} placeholder="ÈÅ∏Â°´ÂÇôË®ª" />
                  </div>
                </div>
                <div className="flex gap-3 pt-4">
                  <button onClick={() => setIsModalOpen(false)} className="flex-1 py-3 font-bold text-[#A68A71] rounded-2xl border border-[#F5EBE0]">ÂèñÊ∂à</button>
                  <button onClick={handleSaveItem} className="flex-1 py-3 font-bold bg-[#D8C4B6] text-white rounded-2xl shadow-md">{editingId ? 'Êõ¥Êñ∞È†ÖÁõÆ' : 'ÂÑ≤Â≠òÈ†ÖÁõÆ'}</button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    function ItineraryView({ itinerary, setItinerary }) {
      const [dayIdx, setDayIdx] = useState(0);
      const [searchTerm, setSearchTerm] = useState('');
      const [showSearch, setShowSearch] = useState(false);
      const [isRefreshing, setIsRefreshing] = useState(false);
      const [showOthers, setShowOthers] = useState(false);
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [newAct, setNewAct] = useState({ time: '09:00', title: '', loc: '', note: '' });
      const [editingActId, setEditingActId] = useState(null);
      const day = itinerary[dayIdx];

      const timeOptions = useMemo(() => {
        const options = [];
        for (let h = 0; h < 24; h++) {
          for (let m = 0; m < 60; m += 30) {
            options.push(`${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`);
          }
        }
        return options;
      }, []);

      const handleSaveActivity = () => {
        if (!newAct.title.trim()) return;
        const updatedItinerary = [...itinerary];
        if (editingActId) {
          updatedItinerary[dayIdx].activities = updatedItinerary[dayIdx].activities.map(a => a.id === editingActId ? { ...a, ...newAct } : a);
        } else {
          updatedItinerary[dayIdx].activities.push({ ...newAct, id: 'act-' + Date.now() });
        }
        updatedItinerary[dayIdx].activities.sort((a, b) => a.time.localeCompare(b.time));
        setItinerary(updatedItinerary);
        setIsModalOpen(false);
        setNewAct({ time: '09:00', title: '', loc: '', note: '' });
        setEditingActId(null);
      };

      const handleEditActivity = (act) => {
        setNewAct({ time: act.time, title: act.title, loc: act.loc, note: act.note });
        setEditingActId(act.id);
        setIsModalOpen(true);
      };

      const handleDeleteActivity = (id) => {
        if (confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§Ë°åÁ®ãÂóéÔºü')) {
          const updatedItinerary = [...itinerary];
          updatedItinerary[dayIdx].activities = updatedItinerary[dayIdx].activities.filter(a => a.id !== id);
          setItinerary(updatedItinerary);
        }
      };

      const handleDeleteCurrent = () => {
         if (confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§Ë°åÁ®ãÂóéÔºü')) {
          const updatedItinerary = [...itinerary];
          updatedItinerary[dayIdx].activities = updatedItinerary[dayIdx].activities.filter(a => a.id !== editingActId);
          setItinerary(updatedItinerary);
          setIsModalOpen(false);
          setEditingActId(null);
        }
      };

      const handleRefresh = () => {
        setIsRefreshing(true);
        setShowOthers(true); 
        setTimeout(() => setIsRefreshing(false), 800);
      };

      const displayGroups = useMemo(() => {
        const groupsToProcess = (showOthers || searchTerm) ? RESORT_ACTIVITY_GROUPS : [RESORT_ACTIVITY_GROUPS[0]];
        return groupsToProcess.map(group => {
          let items = group.items;
          if (searchTerm) {
            items = items.filter(item => item.name.toLowerCase().includes(searchTerm.toLowerCase()) || item.detail.toLowerCase().includes(searchTerm.toLowerCase()));
          } else {
            items = items.slice(0, 6);
          }
          return { ...group, items };
        }).filter(group => group.items.length > 0);
      }, [searchTerm, showOthers]);

      return (
        <div className="fade-in space-y-6">
          <div className="flex overflow-x-auto gap-3 pb-2 no-scrollbar snap-x">
            {itinerary.map((d, i) => (
              <button key={i} onClick={() => setDayIdx(i)} className={`flex-shrink-0 w-12 h-16 rounded-2xl flex flex-col items-center justify-center border transition-all ${dayIdx === i ? 'bg-[#4E342E] text-white shadow-lg' : 'bg-white text-[#A68A71] border-[#F5EBE0]'}`}>
                <span className="text-[8px] font-black uppercase opacity-60">{d.date.includes('/') ? 'Jan' : 'Feb'}</span><span className="text-lg font-black mt-1">{d.date.includes('/') ? d.date.split('/')[1] : d.date.split('.')[1]}</span>
              </button>
            ))}
          </div>
          <div className="bg-white p-7 rounded-[2.5rem] border border-[#F5EBE0] shadow-sm mb-6 relative">
            <div className="flex justify-between items-start mb-6">
              <h2 className="text-2xl font-bold text-[#4E342E] serif leading-tight">Day 0{dayIdx+1} {day.title}</h2>
              <button onClick={() => { setEditingActId(null); setNewAct({ time: '09:00', title: '', loc: '', note: '' }); setIsModalOpen(true); }} className="w-9 h-9 bg-[#FDFBF7] border border-[#F5EBE0] text-[#A68A71] rounded-xl flex items-center justify-center active:scale-95 transition-all shadow-sm"><Plus size={18} /></button>
            </div>
            <div className="space-y-8 relative ml-1">
              <div className="absolute left-[17px] top-3 bottom-3 w-[1px] bg-[#F5EBE0]" />
              {day.activities.map(act => (
                <div key={act.id} className="flex gap-5 relative z-10 group">
                  <div className="w-9 h-9 rounded-xl border-2 border-[#F5EBE0] bg-white flex items-center justify-center text-[#4E342E] shrink-0"><Clock size={16} /></div>
                  <div className="flex-1 cursor-pointer" onClick={() => window.open(getGoogleMapsUrl(act.loc || act.title), '_blank')}>
                    <span className="text-[10px] font-black text-[#D8C4B6]">{act.time}</span>
                    <h4 className="font-bold text-base text-[#4E342E]">{act.title}</h4>
                    {act.loc && <div className="text-[10px] text-[#A68A71] flex items-center gap-1 mt-1 font-bold"><MapPin size={10} /> {act.loc}</div>}
                    {act.note && <p className="text-[10px] text-[#A68A71] italic mt-1">{act.note}</p>}
                  </div>
                  <div className="flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition-opacity justify-center">
                    <button onClick={(e) => { e.stopPropagation(); handleEditActivity(act); }} className="text-[#A68A71] hover:text-[#4E342E]"><Edit2 size={16} /></button>
                    <button onClick={(e) => { e.stopPropagation(); handleDeleteActivity(act.id); }} className="text-[#A68A71] hover:text-red-500"><Trash2 size={16} /></button>
                  </div>
                </div>
              ))}
            </div>
          </div>
          {day.isMaldives && (
            <div className="bg-[#4E342E] p-8 rounded-[2.5rem] text-white shadow-xl mb-6 fade-in">
              <div className="flex justify-between items-center mb-6">
                <h3 className="text-xl font-bold serif flex items-center gap-3"><Waves className="text-[#D8C4B6]" /> Ëá™Ë≤ªË°® (Activity Pricing)</h3>
                <div className="flex gap-2">
                  <button onClick={() => setShowSearch(!showSearch)} className="w-9 h-9 bg-white/10 rounded-xl flex items-center justify-center text-[#D8C4B6] hover:bg-white/20 transition-all"><Search size={18} /></button>
                  <button onClick={handleRefresh} className={`w-9 h-9 bg-white/10 rounded-xl flex items-center justify-center text-[#D8C4B6] hover:bg-white/20 transition-all ${isRefreshing ? 'animate-spin' : ''}`}><RefreshCw size={18} /></button>
                </div>
              </div>
              {showSearch && <div className="mb-6 fade-in"><input type="text" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} placeholder="ÊêúÂ∞ãÊΩõÊ∞¥„ÄÅË™≤Á®ã„ÄÅÊ∞¥‰∏äÊ¥ªÂãï..." className="w-full bg-white/10 border-white/10 text-white placeholder:text-white/30 focus:border-[#D8C4B6] focus:bg-white/20" autoFocus /></div>}
              <div className="space-y-10">
                {displayGroups.map((group) => (
                  <div key={group.id} className="space-y-4">
                    <h4 className="text-[10px] font-black text-[#D8C4B6] uppercase tracking-[0.2em] opacity-60 px-1">{group.category}</h4>
                    <div className="grid gap-4">
                      {group.items.map((item, i) => (
                        <div key={i} className="bg-white/5 p-4 rounded-2xl flex justify-between items-center border border-white/5 hover:border-white/20 transition-all">
                          <div className="flex-1 pr-4"><h4 className="font-bold text-sm text-[#D8C4B6]">{item.name}</h4><p className="text-[9px] text-white/40 mt-0.5">{item.detail}</p></div>
                          <div className="text-right">{item.price > 0 ? <><div className="text-lg font-black text-white">${item.price}</div><div className="text-[9px] font-black text-[#D8C4B6]">‚âà NT$ {Math.round(item.price * USD_TO_TWD).toLocaleString()}</div></> : <div className="text-lg font-black text-white">FREE</div>}</div>
                        </div>
                      ))}
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}
          {isModalOpen && (
            <div className="modal-overlay" onClick={() => setIsModalOpen(false)}>
              <div className="bg-white w-full max-w-sm rounded-[2.5rem] p-8 space-y-4 shadow-2xl" onClick={e => e.stopPropagation()}>
                <h3 className="text-xl font-bold serif text-[#4E342E]">{editingActId ? 'Á∑®ËºØÁï∂Êó•Ë°åÁ®ã' : 'Êñ∞Â¢ûÁï∂Êó•Ë°åÁ®ã'}</h3>
                <div className="space-y-3">
                  <div><label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">ÊôÇÈñì</label><select value={newAct.time} onChange={e => setNewAct({...newAct, time: e.target.value})}>{timeOptions.map(t => <option key={t} value={t}>{t}</option>)}</select></div>
                  <div><label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">Ê®ôÈ°å</label><input type="text" value={newAct.title} onChange={e => setNewAct({...newAct, title: e.target.value})} placeholder="‰æãÂ¶ÇÔºöÊôØÈªûÂèÉËßÄ" /></div>
                  <div><label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">Âú∞Èªû</label><input type="text" value={newAct.loc} onChange={e => setNewAct({...newAct, loc: e.target.value})} placeholder="‰æãÂ¶ÇÔºöÈõôÂ≠êÂ°î" /></div>
                  <div><label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">ÂÇôË®ª</label><input type="text" value={newAct.note} onChange={e => setNewAct({...newAct, note: e.target.value})} placeholder="ÈÅ∏Â°´ÂÇôË®ª" /></div>
                </div>
                <div className="space-y-3 pt-2">
                  <div className="flex gap-3">
                    <button onClick={() => setIsModalOpen(false)} className="flex-1 py-3 font-bold text-[#A68A71] rounded-2xl border border-[#F5EBE0]">ÂèñÊ∂à</button>
                    <button onClick={handleSaveActivity} className="flex-1 py-3 font-bold bg-[#D8C4B6] text-white rounded-2xl shadow-md">{editingActId ? 'Êõ¥Êñ∞Ë°åÁ®ã' : 'ÂÑ≤Â≠òË°åÁ®ã'}</button>
                  </div>
                  {editingActId && (
                    <button 
                      onClick={handleDeleteCurrent}
                      className="w-full py-3 font-bold text-[#ef4444] bg-red-50 rounded-2xl border border-red-100 flex items-center justify-center gap-2 active:scale-95 transition-all"
                    >
                      <Trash2 size={16} />
                      Âà™Èô§Ê≠§Ë°åÁ®ã
                    </button>
                  )}
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    function TransportView({ transports, setTransports }) {
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [newTransport, setNewTransport] = useState({ id: '', type: 'Plane', date: '01/23', from: '', to: '', depTime: '', arrTime: '' });
      const [editingId, setEditingId] = useState(null);

      const handleSaveTransport = () => {
        if (!newTransport.id.trim() || !newTransport.from.trim() || !newTransport.to.trim()) return;
        
        if (editingId) {
          setTransports(transports.map(t => (t.localId || t.id) === editingId ? { ...newTransport, localId: editingId } : t));
        } else {
          setTransports([...transports, { ...newTransport, localId: 'trans-' + Date.now() }]);
        }
        
        setIsModalOpen(false);
        setNewTransport({ id: '', type: 'Plane', date: '01/23', from: '', to: '', depTime: '', arrTime: '' });
        setEditingId(null);
      };

      const handleEdit = (t) => {
        setNewTransport({ 
          id: t.id, 
          type: t.type, 
          date: t.date, 
          from: t.from, 
          to: t.to, 
          depTime: t.depTime, 
          arrTime: t.arrTime 
        });
        setEditingId(t.localId || t.id);
        setIsModalOpen(true);
      };

      const handleDeleteTransport = (id) => {
        if (confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§‰∫§ÈÄöË°åÁ®ãÂóéÔºü')) {
          setTransports(transports.filter(t => (t.localId || t.id) !== id));
        }
      };
      
      const handleDeleteCurrent = () => {
         if (confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§‰∫§ÈÄöË°åÁ®ãÂóéÔºü')) {
          setTransports(transports.filter(t => (t.localId || t.id) !== editingId));
          setIsModalOpen(false);
          setEditingId(null);
        }
      };

      const getIcon = (type) => {
        switch (type) {
          case 'Train': return <Train size={18} />;
          case 'Bus': return <Bus size={18} />;
          default: return <Plane size={18} />;
        }
      };

      return (
        <div className="fade-in space-y-6">
          <div className="flex justify-between items-center px-2">
            <h2 className="text-3xl font-bold serif text-[#4E342E]">‰∫§ÈÄöË≥áË®ä</h2>
            <button onClick={() => { setEditingId(null); setNewTransport({ id: '', type: 'Plane', date: '01/23', from: '', to: '', depTime: '', arrTime: '' }); setIsModalOpen(true); }} className="w-10 h-10 bg-[#4E342E] text-white rounded-xl flex items-center justify-center shadow-lg active:scale-95 transition-all"><Plus size={20} /></button>
          </div>

          {transports.map((t, i) => (
            <div key={t.localId || i} className="bg-white rounded-[2.5rem] border border-[#F5EBE0] p-7 flex flex-col shadow-sm cursor-pointer hover:border-[#D8C4B6] transition-all group relative" onClick={() => window.open(getGoogleMapsUrl(t.to), '_blank')}>
              <div className="absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-all">
                <button 
                  onClick={(e) => { e.stopPropagation(); handleEdit(t); }} 
                  className="p-2 text-[#A68A71] hover:text-[#4E342E] transition-all"
                >
                  <Edit2 size={18} />
                </button>
                <button 
                  onClick={(e) => { e.stopPropagation(); handleDeleteTransport(t.localId || t.id); }} 
                  className="p-2 text-[#A68A71] hover:text-red-500 transition-all"
                >
                  <Trash2 size={18} />
                </button>
              </div>
              <div className="flex justify-between items-center mb-6">
                 <div><div className="font-black text-lg text-[#4E342E]">{t.id}</div><div className="text-[10px] text-[#A68A71] font-bold uppercase tracking-widest">{t.date}</div></div>
                 <div className="w-10 h-10 bg-[#D8C4B6] rounded-xl flex items-center justify-center text-white">{getIcon(t.type)}</div>
              </div>
              <div className="flex items-center justify-between gap-2 px-2">
                <div className="flex flex-col flex-1 items-start">
                  <div className="font-bold text-base text-[#4E342E] truncate w-full">{t.from}</div>
                  <div className="text-3xl font-black text-[#4E342E] tracking-tighter mt-1">{t.depTime}</div>
                </div>
                <div className="opacity-20 shrink-0 pt-6"><ArrowRight size={24} /></div>
                <div className="flex flex-col flex-1 items-end text-right">
                  <div className="font-bold text-base text-[#4E342E] truncate w-full">{t.to}</div>
                  <div className="text-3xl font-black text-[#4E342E] tracking-tighter mt-1">{t.arrTime}</div>
                </div>
              </div>
            </div>
          ))}

          {isModalOpen && (
            <div className="modal-overlay" onClick={() => setIsModalOpen(false)}>
              <div className="bg-white w-full max-w-sm rounded-[2.5rem] p-8 space-y-4 shadow-2xl" onClick={e => e.stopPropagation()}>
                <h3 className="text-xl font-bold serif text-[#4E342E]">{editingId ? 'Á∑®ËºØ‰∫§ÈÄöË≥áË®ä' : 'Êñ∞Â¢û‰∫§ÈÄöË≥áË®ä'}</h3>
                <div className="space-y-3">
                  <div className="grid grid-cols-2 gap-3">
                    <div>
                      <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">ËªäÊ¨° / Áè≠Ê©ü</label>
                      <input type="text" value={newTransport.id} onChange={e => setNewTransport({...newTransport, id: e.target.value})} placeholder="‰æãÂ¶ÇÔºöMH367" />
                    </div>
                    <div>
                      <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">È°ûÂûã</label>
                      <select value={newTransport.type} onChange={e => setNewTransport({...newTransport, type: e.target.value})}>
                        <option value="Plane">È£õÊ©ü</option>
                        <option value="Train">È´òÈêµ / ÁÅ´Ëªä</option>
                        <option value="Bus">Â§ßÁúæÈÅãËº∏ / Â∑¥Â£´</option>
                      </select>
                    </div>
                  </div>
                  <div>
                    <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">Êó•Êúü</label>
                    <input type="text" value={newTransport.date} onChange={e => setNewTransport({...newTransport, date: e.target.value})} placeholder="‰æãÂ¶ÇÔºö01/23" />
                  </div>
                  <div className="grid grid-cols-2 gap-3">
                    <div>
                      <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">Âá∫ÁôºÊôÇÈñì</label>
                      <input type="text" value={newTransport.depTime} onChange={e => setNewTransport({...newTransport, depTime: e.target.value})} placeholder="15:10" />
                    </div>
                    <div>
                      <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">ÊäµÈÅîÊôÇÈñì</label>
                      <input type="text" value={newTransport.arrTime} onChange={e => setNewTransport({...newTransport, arrTime: e.target.value})} placeholder="20:05" />
                    </div>
                  </div>
                  <div className="grid grid-cols-2 gap-3">
                    <div>
                      <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">Âá∫ÁôºÂú∞</label>
                      <input type="text" value={newTransport.from} onChange={e => setNewTransport({...newTransport, from: e.target.value})} placeholder="TPE" />
                    </div>
                    <div>
                      <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">ÁõÆÁöÑÂú∞</label>
                      <input type="text" value={newTransport.to} onChange={e => setNewTransport({...newTransport, to: e.target.value})} placeholder="KUL" />
                    </div>
                  </div>
                </div>
                <div className="space-y-3 pt-2">
                  <div className="flex gap-3">
                    <button onClick={() => setIsModalOpen(false)} className="flex-1 py-3 font-bold text-[#A68A71] rounded-2xl border border-[#F5EBE0]">ÂèñÊ∂à</button>
                    <button onClick={handleSaveTransport} className="flex-1 py-3 font-bold bg-[#D8C4B6] text-white rounded-2xl shadow-md">{editingId ? 'Êõ¥Êñ∞‰∫§ÈÄö' : 'ÂÑ≤Â≠ò‰∫§ÈÄö'}</button>
                  </div>
                   {editingId && (
                    <button 
                      onClick={handleDeleteCurrent}
                      className="w-full py-3 font-bold text-[#ef4444] bg-red-50 rounded-2xl border border-red-100 flex items-center justify-center gap-2 active:scale-95 transition-all"
                    >
                      <Trash2 size={16} />
                      Âà™Èô§Ê≠§Ë°åÁ®ã
                    </button>
                  )}
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    function AccommodationView() {
      const hotels = [
        { nameZh: 'ÂêâÈöÜÂù°Â≠üÊ≤ôÂÅáÊó•ÈÖíÂ∫ó', nameEn: 'Holiday Inn Kuala Lumpur Bangsar', date: '1/23-1/25', image: 'https://images.unsplash.com/photo-1520250497591-112f2f40a3f4?auto=format&fit=crop&q=80&w=800', note: 'ÊôÇÂ∞öÂ≠üÊ≤ôÂçÄÔºå‰∫§ÈÄöÈùûÂ∏∏‰æøÂà©„ÄÇ' },
        { nameZh: 'ÁæéÂ±ÖÈ¶¨ÁàæÂú∞Â§´Â∫¶ÂÅáÊùë', nameEn: 'Mercure Maldives Kooddoo Resort', date: '1/25-1/29', image: 'https://images.unsplash.com/photo-1514282401047-d79a71a590e8?auto=format&fit=crop&q=80&w=800', note: 'ÂÖ®ÂåÖÂºèÊ∞¥‰∏äÂà•Â¢ÖÔºåÊΩõÊ∞¥ËÄÖÂ§©Â†Ç„ÄÇ' },
        { nameZh: 'È¶¨ÁàæÂú∞Â§´Â±ÖÊ∞ëÂ≥∂ h78 È£ØÂ∫ó', nameEn: 'h78 Maldives', date: '1/29-1/30', image: 'https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?auto=format&fit=crop&q=80&w=800', note: 'Êµ∑Êø±È¶ñÈÅ∏ÔºåÈäúÊé•Ê©üÂ†¥Ê•µÂ∫¶‰æøÂà©„ÄÇ' },
        { nameZh: 'Umi SplashMania Ê∞ëÂÆø', nameEn: 'Umi SplashMania homestay', date: '1/30-1/31', image: 'https://images.unsplash.com/photo-1493809842364-78817add7ffb?auto=format&fit=crop&q=80&w=800', note: 'ÈÑ∞Ëøë SplashMania Ê∞¥‰∏äÊ®ÇÂúíÔºåÁí∞Â¢ÉÊ∫´È¶®ËàíÈÅ©ÔºåËøîÂè∞ÂâçÁöÑÁµï‰Ω≥‰ºëÊÜ©Á´ô„ÄÇ' }
      ];
      return (
        <div className="fade-in space-y-8">
          <h2 className="text-3xl font-bold serif text-[#4E342E] px-2">‰ΩèÂÆøÂÆâÊéí</h2>
          {hotels.map((h, i) => (
            <div key={i} className="bg-white rounded-[3rem] overflow-hidden shadow-sm border border-[#F5EBE0]">
              <div className="h-48 overflow-hidden"><img src={h.image} className="w-full h-full object-cover" /></div>
              <div className="p-8">
                <div className="flex justify-between items-start mb-1">
                   <div className="flex-1 pr-4"><h3 className="text-xl font-bold text-[#4E342E] serif leading-tight">{h.nameZh}</h3><p className="text-[10px] text-[#A68A71] font-bold uppercase mt-1 opacity-60">{h.nameEn}</p></div>
                   <button onClick={() => window.open(getGoogleMapsUrl(h.nameEn), '_blank')} className="w-10 h-10 bg-[#4E342E] text-white rounded-xl flex items-center justify-center shadow-lg transition-all"><Compass size={20} /></button>
                </div>
                <div className="text-xs text-[#A68A71] flex items-center gap-2 my-4"><Calendar size={14} /> {h.date}</div>
                <p className="bg-[#FDFBF7] p-4 rounded-2xl border border-[#F5EBE0] text-xs italic text-[#4E342E] leading-relaxed">{h.note}</p>
              </div>
            </div>
          ))}
        </div>
      );
    }

    function RecommendationView() {
      const [filter, setFilter] = useState('ALL');
      const [poolIdx, setPoolIdx] = useState(0);
      const [isRefreshing, setIsRefreshing] = useState(false);

      const currentRecs = REC_POOLS[poolIdx];

      const filteredRecs = useMemo(() => {
        if (filter === 'ALL') return currentRecs;
        return currentRecs.filter(cat => cat.location === filter);
      }, [filter, poolIdx]);

      const handleUpdateRecs = () => {
        setIsRefreshing(true);
        setTimeout(() => {
          setPoolIdx((prev) => (prev + 1) % REC_POOLS.length);
          setIsRefreshing(false);
        }, 500);
      };

      return (
        <div className="fade-in space-y-8">
          <div className="space-y-4 px-2">
             <div className="flex justify-between items-center">
                <h2 className="text-3xl font-bold serif text-[#4E342E]">Âú®Âú∞Êé®Ëñ¶</h2>
                <button onClick={handleUpdateRecs} className={`flex items-center gap-2 px-4 py-2 bg-[#D8C4B6] text-white rounded-xl shadow-md active:scale-95 transition-all ${isRefreshing ? 'opacity-80' : ''}`}>
                  <RefreshCw size={16} className={isRefreshing ? 'animate-spin' : ''} />
                  <span className="text-xs font-bold">Êõ¥ÊèõË°åÁ®ã</span>
                </button>
             </div>
             <p className="text-xs text-[#A68A71] font-bold uppercase tracking-widest">ÊôØÈªûËàáË°åÁ®ãÊé®Ëñ¶ Attractions & Plans</p>
          </div>

          <div className="bg-white/50 p-1 rounded-xl border border-[#F5EBE0] flex mx-2">
            <button onClick={() => setFilter('KL')} className={`flex-1 py-2 rounded-lg text-[10px] font-black transition-all ${filter === 'KL' ? 'bg-[#4E342E] text-white shadow-md' : 'text-[#A68A71]'}`}>ÂêâÈöÜÂù°</button>
            <button onClick={() => setFilter('MV')} className={`flex-1 py-2 rounded-lg text-[10px] font-black transition-all ${filter === 'MV' ? 'bg-[#4E342E] text-white shadow-md' : 'text-[#A68A71]'}`}>Â±ÖÊ∞ëÂ≥∂</button>
            <button onClick={() => setFilter('ALL')} className={`flex-1 py-2 rounded-lg text-[10px] font-black transition-all ${filter === 'ALL' ? 'bg-[#4E342E] text-white shadow-md' : 'text-[#A68A71]'}`}>ÂÖ®ÈÉ®</button>
          </div>

          <div className="space-y-10">
            {filteredRecs.map((cat, idx) => (
              <section key={idx} className="space-y-4 fade-in">
                <h3 className="font-bold text-lg text-[#4E342E] serif flex items-center gap-2 px-2"><Utensils size={18} className="text-[#A68A71]" /> {cat.category}</h3>
                <div className="grid gap-4">
                  {cat.items.map((item, i) => (
                    <div key={i} className="bg-white p-6 rounded-[2.5rem] border border-[#F5EBE0] shadow-sm cursor-pointer hover:border-[#D8C4B6] transition-all" onClick={() => window.open(getGoogleMapsUrl(item.name), '_blank')}>
                      <h4 className="font-bold text-[#4E342E] text-base mb-2">{item.name}</h4><p className="text-xs text-[#A68A71] leading-relaxed italic">{item.desc}</p>
                    </div>
                  ))}
                </div>
              </section>
            ))}
          </div>
        </div>
      );
    }

    function ExpenseView({ expenses, setExpenses }) {
      const [convVal, setConvVal] = useState('');
      const [convMode, setConvMode] = useState('USD');
      
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [newExpense, setNewExpense] = useState({ title: '', currency: 'TWD', amount: '', date: new Date().toISOString().split('T')[0] });
      const [editingId, setEditingId] = useState(null);

      const totalTwd = expenses.reduce((sum, e) => sum + (e.twd || 0), 0);
      const rate = convMode === 'USD' ? USD_TO_TWD : MYR_TO_TWD;
      const result = Math.round((parseFloat(convVal) || 0) * rate);

      const handleSaveExpense = () => {
        if (!newExpense.title.trim()) return;
        
        let twdAmount = 0;
        const amount = parseFloat(newExpense.amount);
        if (newExpense.currency === 'USD') twdAmount = amount * USD_TO_TWD;
        else if (newExpense.currency === 'MYR') twdAmount = amount * MYR_TO_TWD;
        else twdAmount = amount; 

        const expenseData = {
            ...newExpense,
            amount: amount,
            twd: Math.round(twdAmount)
        };

        if (editingId) {
            setExpenses(expenses.map(e => e.id === editingId ? { ...expenseData, id: editingId } : e).sort((a, b) => new Date(b.date) - new Date(a.date)));
        } else {
            setExpenses([...expenses, { ...expenseData, id: 'exp-' + Date.now() }].sort((a, b) => new Date(b.date) - new Date(a.date)));
        }
        
        setIsModalOpen(false);
        setNewExpense({ title: '', currency: 'TWD', amount: '', date: new Date().toISOString().split('T')[0] });
        setEditingId(null);
      };

      const handleDeleteExpense = (id) => {
          if (confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§Á≠ÜÊîØÂá∫ÂóéÔºü')) {
              setExpenses(expenses.filter(e => e.id !== id));
          }
      };

      const handleEdit = (exp) => {
          setNewExpense({ title: exp.title, currency: exp.currency, amount: exp.amount, date: exp.date || new Date().toISOString().split('T')[0] });
          setEditingId(exp.id);
          setIsModalOpen(true);
      };

      return (
        <div className="fade-in space-y-6 pb-20">
          <div className="bg-white p-8 rounded-[2.5rem] border border-[#F5EBE0] shadow-sm space-y-3 w-full">
            <h3 className="font-bold text-sm text-[#4E342E] flex items-center justify-center gap-2"><DollarSign size={16} className="text-[#D8C4B6]" /> ÂåØÁéáÂø´ÈÄüÊèõÁÆó</h3>
            <div className="flex bg-[#FDFBF7] p-1.5 rounded-2xl border border-[#F5EBE0]">
              <button onClick={() => setConvMode('USD')} className={`flex-1 py-2.5 rounded-xl text-xs font-black transition-all ${convMode === 'USD' ? 'bg-[#4E342E] text-white shadow-md' : 'text-[#A68A71]'}`}>ÁæéÈáë USD</button>
              <button onClick={() => setConvMode('MYR')} className={`flex-1 py-2.5 rounded-xl text-xs font-black transition-all ${convMode === 'MYR' ? 'bg-[#4E342E] text-white shadow-md' : 'text-[#A68A71]'}`}>‰ª§Âêâ MYR</button>
            </div>
            <div className="text-center space-y-3 pt-1 pb-4">
              <div className="text-[10px] font-black text-[#A68A71] uppercase tracking-[0.2em]">1 {convMode} : {rate} TWD</div>
              <input type="number" value={convVal} onChange={e => setConvVal(e.target.value)} placeholder={`Ëº∏ÂÖ• ${convMode} ÈáëÈ°ç`} className="text-center font-black text-3xl py-2 bg-transparent border-b-2 border-[#F5EBE0] focus:border-[#D8C4B6] w-full" />
              <div className="text-xl font-black text-[#4E342E] mt-4">‚âà NT$ {result.toLocaleString()}</div>
            </div>
          </div>
          <div className="bg-[#4E342E] p-8 rounded-[3rem] text-white shadow-2xl flex justify-between items-center">
            <div><p className="text-[10px] font-black opacity-50 uppercase tracking-widest">Á∏ΩÊîØÂá∫È†ê‰º∞</p><h2 className="text-3xl font-black mt-1">NT$ {totalTwd.toLocaleString()}</h2></div>
            <Wallet size={40} className="opacity-10" />
          </div>
          <div className="flex justify-between items-center px-2">
            <h2 className="text-xl font-bold serif text-[#4E342E]">ÊîØÂá∫ÊòéÁ¥∞</h2>
            <button onClick={() => { setEditingId(null); setNewExpense({ title: '', currency: 'TWD', amount: '', date: new Date().toISOString().split('T')[0] }); setIsModalOpen(true); }} className="w-10 h-10 bg-[#4E342E] text-white rounded-xl flex items-center justify-center shadow-lg transition-all"><Plus size={20} /></button>
          </div>
          <div className="space-y-3">
            {expenses.map(e => (
              <div key={e.id} className="bg-white p-5 rounded-2xl border border-[#F5EBE0] flex justify-between items-center shadow-sm cursor-pointer hover:border-[#D8C4B6] transition-all group relative">
                <div className="absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-all bg-white pl-2">
                    <button onClick={(ev) => { ev.stopPropagation(); handleEdit(e); }} className="p-2 text-[#A68A71] hover:text-[#4E342E] transition-all"><Edit2 size={16} /></button>
                    <button onClick={(ev) => { ev.stopPropagation(); handleDeleteExpense(e.id); }} className="p-2 text-[#A68A71] hover:text-red-500 transition-all"><Trash2 size={16} /></button>
                </div>
                <div><div className="text-[9px] text-[#A68A71] font-bold opacity-60 mb-1">{e.date}</div><div className="font-bold text-[#4E342E] text-sm">{e.title}</div><div className="text-[10px] text-[#A68A71] font-bold uppercase">{e.currency} {e.amount}</div></div>
                <div className="text-right font-black text-[#4E342E]">NT$ {e.twd.toLocaleString()}</div>
              </div>
            ))}
          </div>

          {isModalOpen && (
            <div className="modal-overlay" onClick={() => setIsModalOpen(false)}>
              <div className="bg-white w-full max-sm rounded-[2.5rem] p-8 space-y-4 shadow-2xl" onClick={e => e.stopPropagation()}>
                <h3 className="text-xl font-bold serif text-[#4E342E]">{editingId ? 'Á∑®ËºØÊîØÂá∫' : 'Êñ∞Â¢ûÊîØÂá∫'}</h3>
                <div className="space-y-3">
                  <div>
                    <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">Êó•Êúü</label>
                    <input type="date" value={newExpense.date} onChange={e => setNewExpense({...newExpense, date: e.target.value})} />
                  </div>
                  <div>
                    <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">È†ÖÁõÆÂêçÁ®±</label>
                    <input type="text" value={newExpense.title} onChange={e => setNewExpense({...newExpense, title: e.target.value})} placeholder="‰æãÂ¶ÇÔºöÊôöÈ§ê" />
                  </div>
                  <div className="grid grid-cols-3 gap-3">
                    <div className="col-span-1">
                      <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">Âπ£Âà•</label>
                      <select value={newExpense.currency} onChange={e => setNewExpense({...newExpense, currency: e.target.value})}>
                        <option value="TWD">TWD</option>
                        <option value="USD">USD</option>
                        <option value="MYR">MYR</option>
                      </select>
                    </div>
                    <div className="col-span-2">
                        <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">ÈáëÈ°ç</label>
                        <input type="number" value={newExpense.amount} onChange={e => setNewExpense({...newExpense, amount: e.target.value})} placeholder="Ëº∏ÂÖ•ÈáëÈ°ç" />
                    </div>
                  </div>
                </div>
                <div className="flex gap-3 pt-4">
                  <button onClick={() => setIsModalOpen(false)} className="flex-1 py-3 font-bold text-[#A68A71] rounded-2xl border border-[#F5EBE0]">ÂèñÊ∂à</button>
                  <button onClick={handleSaveExpense} className="flex-1 py-3 font-bold bg-[#D8C4B6] text-white rounded-2xl shadow-md">{editingId ? 'Êõ¥Êñ∞' : 'ÂÑ≤Â≠ò'}</button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    const App = () => {
      const [activeTab, setActiveTab] = useState('ITINERARY');
      const [itinerary, setItinerary] = useState(() => JSON.parse(localStorage.getItem('trip_itinerary_v53')) || INITIAL_ITINERARY);
      const [prepList, setPrepList] = useState(() => JSON.parse(localStorage.getItem('trip_prep_v53')) || INITIAL_PREP);
      const [transports, setTransports] = useState(() => JSON.parse(localStorage.getItem('trip_transport_v53')) || INITIAL_TRANSPORTS);
      const [expenses, setExpenses] = useState(() => JSON.parse(localStorage.getItem('trip_expenses_v53')) || []);

      useEffect(() => localStorage.setItem('trip_itinerary_v53', JSON.stringify(itinerary)), [itinerary]);
      useEffect(() => localStorage.setItem('trip_prep_v53', JSON.stringify(prepList)), [prepList]);
      useEffect(() => localStorage.setItem('trip_transport_v53', JSON.stringify(transports)), [transports]);
      useEffect(() => localStorage.setItem('trip_expenses_v53', JSON.stringify(expenses)), [expenses]);

      const renderContent = () => {
        switch (activeTab) {
          case 'PREPARATION': return <PreparationView prepList={prepList} setPrepList={setPrepList} />;
          case 'ITINERARY': return <ItineraryView itinerary={itinerary} setItinerary={setItinerary} />;
          case 'TRANSPORT': return <TransportView transports={transports} setTransports={setTransports} />;
          case 'ACCOMMODATION': return <AccommodationView />;
          case 'RECOMMENDATION': return <RecommendationView />;
          case 'EXPENSE': return <ExpenseView expenses={expenses} setExpenses={setExpenses} />;
          default: return <ItineraryView itinerary={itinerary} setItinerary={setItinerary} />;
        }
      };

      return (
        <div className="min-h-screen flex flex-col pb-safe">
          <header className="fixed top-0 left-0 right-0 z-40 glass-effect border-b border-[#F5EBE0] py-4 pt-safe">
            <div className="max-w-xl mx-auto px-4 flex justify-between items-center">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 bg-[#D8C4B6] rounded-2xl flex items-center justify-center text-white shadow-md"><Compass size={20} /></div>
                <div>
                  <h1 className="font-bold text-lg serif text-[#4E342E]">Â∂ºÊµ∑Á¥ÄË°å</h1>
                  <p className="text-[9px] font-black text-[#A68A71] uppercase tracking-[0.3em]">Azure Reverie</p>
                </div>
              </div>
            </div>
          </header>
          <main className="flex-grow pt-24 pb-32 max-w-xl mx-auto w-full px-4">{renderContent()}</main>
          
          <TravelTipsWidget />

          <nav className="fixed bottom-6 left-1/2 -translate-x-1/2 w-[94%] max-w-lg z-50">
            <div className="glass-effect rounded-[2.5rem] shadow-2xl border border-[#F5EBE0]/60 p-1.5 flex justify-between items-center">
              {[
                { id: 'PREPARATION', icon: ClipboardCheck, label: 'Ê∫ñÂÇô' },
                { id: 'ITINERARY', icon: MapIcon, label: 'Ë°åÁ®ã' },
                { id: 'TRANSPORT', icon: Plane, label: '‰∫§ÈÄö' },
                { id: 'ACCOMMODATION', icon: Bed, label: '‰ΩèÂÆø' },
                { id: 'RECOMMENDATION', icon: Sparkles, label: 'Êé®Ëñ¶' },
                { id: 'EXPENSE', icon: Wallet, label: 'ÊèõÁÆó' }
              ].map(item => (
                <button key={item.id} onClick={() => setActiveTab(item.id)} className={`flex flex-col items-center justify-center py-3 rounded-[1.8rem] transition-all flex-1 ${activeTab === item.id ? 'tab-active scale-105' : 'text-[#A68A71]'}`}>
                  <item.icon size={20} /><span className={`text-[10px] mt-1 font-bold ${activeTab === item.id ? 'block' : 'hidden'}`}>{item.label}</span>
                </button>
              ))}
            </div>
          </nav>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>