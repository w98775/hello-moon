<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>嶼海紀行</title>
  
  <!-- Libraries -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --milk-tea-primary: #4E342E;
      --milk-tea-secondary: #D8C4B6;
      --milk-tea-accent: #A68A71;
      --milk-tea-bg: #FDFBF7;
    }
    body {
      font-family: 'Noto Sans TC', sans-serif;
      background-color: var(--milk-tea-bg);
      color: var(--milk-tea-primary);
      -webkit-tap-highlight-color: transparent;
      overflow-x: hidden;
    }
    .serif { font-family: 'Noto Serif TC', serif; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    .glass-effect {
      background: rgba(253, 251, 247, 0.85);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    .fade-in { animation: fadeIn 0.4s ease-out forwards; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
    .pt-safe { padding-top: env(safe-area-inset-top); }
    
    .tab-active {
      background-color: var(--milk-tea-secondary);
      color: white;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
    }
    
    input, textarea, select { outline: none; border: 1px solid #F5EBE0; border-radius: 12px; padding: 10px 14px; background: #FDFBF7; width: 100%; font-size: 14px; color: #4E342E; }
    input:focus, textarea:focus, select:focus { border-color: var(--milk-tea-secondary); box-shadow: 0 0 0 2px rgba(216, 196, 182, 0.2); }
    
    .checkbox-custom { width: 22px; height: 22px; border-radius: 6px; border: 2px solid #D8C4B6; display: flex; align-items: center; justify-content: center; transition: all 0.2s; cursor: pointer; }
    .checkbox-custom.checked { background-color: #D8C4B6; }
    .checkbox-custom.checked::after { content: '\f00c'; font-family: 'Font Awesome 6 Free'; font-weight: 900; color: white; font-size: 12px; }

    .floating-action-button {
      position: fixed;
      right: 24px;
      top: 100px;
      z-index: 55;
      width: 56px;
      height: 56px;
      border-radius: 28px;
      background-color: #D8C4B6;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(78, 52, 46, 0.2);
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .floating-action-button:active {
      transform: scale(0.9) rotate(45deg);
      box-shadow: 0 2px 6px rgba(78, 52, 46, 0.1);
    }
  </style>

  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.460.0",
    "react/": "https://esm.sh/react@^19.2.3/",
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0"
  }
}
</script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel" data-type="module">
    import React, { useState, useEffect, useMemo, useRef } from 'react';
    import ReactDOM from 'react-dom/client';
    import { 
      ClipboardCheck, Map as MapIcon, Plane, Bed, Sparkles, Plus,
      Compass, Wallet, X, Trash2, Clock, Star, Waves, Edit2,
      Calendar, MapPin, ExternalLink, Train, ArrowRight, ChevronRight,
      Check, Utensils, Camera, ShoppingBag, Info, Luggage, Save, DollarSign, RefreshCw, Anchor, LifeBuoy, Search
    } from 'lucide-react';

    const USD_TO_TWD = 32.5;
    const MYR_TO_TWD = 7.5;
    
    const getGoogleMapsUrl = (name) => `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(name)}`;

    const RESORT_ACTIVITY_GROUPS = [
      {
        id: 'diving',
        category: '專業潛水與課程 (Diving & Courses)',
        items: [
          { name: 'Single Boat Dive (Full Set)', price: 89, detail: '包含全套裝備單次船潛' },
          { name: '3 Dive Package (Full Set)', price: 260, detail: '3次船潛套裝，含裝備' },
          { name: '5 Dive Package (Full Set)', price: 419, detail: '5次船潛套裝，含裝備' },
          { name: '10 Dive Package (Full Set)', price: 750, detail: '10次船潛套裝，含裝備' },
          { name: 'PADI Discover Scuba (DSD)', price: 140, detail: '初學者體驗潛水 (泳池+1次船潛)' },
          { name: 'PADI Open Water Course', price: 650, detail: '初階開放水域證照課程' },
          { name: 'PADI Advanced Open Water', price: 550, detail: '進階開放水域證照課程' },
          { name: 'Night Boat Dive', price: 100, detail: '夜潛單次費用' }
        ]
      }
    ];

    const INITIAL_PREP = [
      { id: 'p1', category: '重要文件', item: '護照正本 (效期6個月以上)', note: '建議拍照存手機雲端備份', checked: false },
      { id: 'p2', category: '重要文件', item: '馬爾地夫 IMUGA 申報', note: '抵達前96小時內填寫', checked: false },
      { id: 'p3', category: '重要文件', item: '馬來西亞 MDAC 電子卡', note: '抵達前3天內填寫', checked: false },
      { id: 'p4', category: '重要文件', item: '旅遊行程表/機票/飯店憑證', note: '紙本備份', checked: false },
      { id: 'p5', category: '重要文件', item: '海外旅遊保險單', note: '包含醫療與班機不便險', checked: false },
      { id: 'p6', category: '重要文件', item: '外幣現金 (美金/令吉)', note: '美金需2009年後新鈔', checked: false },
      
      { id: 'p7', category: '電子電器', item: '萬用轉接頭 (英式三孔)', note: '馬爾地夫與馬來西亞通用', checked: false },
      { id: 'p8', category: '電子電器', item: '行動電源 (10000mAh+)', note: '出海行程電力備援', checked: false },
      { id: 'p10', category: '電子電器', item: 'GoPro 或 防水相機', note: '水下攝影靈魂', checked: false },
      
      { id: 'p11', category: '衣物穿搭', item: '泳裝/比基尼 (2-3套)', note: '方便換洗', checked: false },
      { id: 'p12', category: '衣物穿搭', item: '水母衣 (長袖防磨衣)', note: '浮潛防曬防刮傷', checked: false },
      { id: 'p13', category: '衣物穿搭', item: '遮陽帽/墨鏡', note: '海邊強光必備', checked: false },
      
      { id: 'p16', category: '個人用品', item: '海洋友善防曬油', note: 'SPF50+，不傷珊瑚', checked: false },
      { id: 'p17', category: '個人用品', item: '蘆薈修護凝膠', note: '曬後舒緩必備', checked: false },
      { id: 'p18', category: '個人用品', item: '浮潛三寶 (面鏡/呼吸管)', note: '衛生考量建議自備', checked: false },
      { id: 'p19', category: '個人用品', item: '防水袋 (10-20L)', note: '出海保護隨身物品', checked: false },
      
      { id: 'p21', category: '常備藥品', item: '暈船藥 (強力型)', note: '馬代快艇/小飛機必備', checked: false },
      { id: 'p23', category: '常備藥品', item: '腸胃藥/止瀉藥', note: '預防水土不服', checked: false },
    ];

    const INITIAL_ITINERARY = [
      { date: '1/23', title: '啟程：吉隆坡孟沙', activities: [{ id: '1', time: '10:25', title: '高鐵左營 -> 桃園', loc: '高鐵桃園站', note: '12:18 抵達桃園' }, { id: '2', time: '15:10', title: 'MH367 起飛', loc: '桃園機場 T1', note: '20:05 抵達 KUL' }, { id: '3', time: '21:30', title: '飯店 Check-in', loc: 'Holiday Inn Bangsar', note: '吉隆坡第一晚' }] },
      { date: '1/24', title: '吉隆坡：精選一日遊', activities: [{ id: '41', time: '10:00', title: '谷中城 MaxMoney', loc: 'Mid Valley Megamall', note: '換匯' }, { id: '45', time: '16:30', title: 'Village Park Restaurant 炸雞椰漿飯', loc: 'Uptown Damansara', note: '必吃大馬美食' }, { id: '48', time: '20:00', title: '雙子塔', loc: 'Petronas Twin Towers', note: '地標夜景' }] },
      { date: '1/25', title: '飛向美居度假村', isMaldives: true, activities: [{ id: '7', time: '09:40', title: 'MH485 飛馬累', loc: 'KLIA T1', note: '11:00 抵達' }, { id: '8', time: '16:00', title: '入住美居度假村', loc: 'Mercure Maldives Kooddoo', note: '全包式度假開始' }] },
      { date: '1/26', title: '美居度假村：深海探索', isMaldives: true, activities: [{ id: '261', time: '09:00', title: '晨間潛水課程', loc: 'Dive Center', note: 'PADI 課程進度' }] },
      { date: '1/27', title: '美居度假村：船潛冒險', isMaldives: true, activities: [{ id: '271', time: '08:30', title: '環礁船潛', loc: 'Kooddoo Jetty', note: '探索更遠的潛點' }] },
      { date: '1/28', title: '美居度假村：水下攝影', isMaldives: true, activities: [{ id: '281', time: '10:00', title: '珊瑚礁浮潛', loc: 'House Reef', note: '紀錄豐富生態' }] },
      { date: '1/29', title: '美居度假村：放鬆時光', isMaldives: true, activities: [{ id: '291', time: '11:00', title: '享受渡假村設施', loc: 'Pool Bar', note: '全包式餐飲服務' }] },
      { date: '1/30', title: '馬爾地夫居民島：h78 飯店', activities: [{ id: '301', time: '12:00', title: '搭船前往居民島', loc: 'Hulhumale', note: '入住 h78 飯店' }] },
      { date: '1/31', title: '平安賦歸', activities: [{ id: '18', time: '09:20', title: 'MH366 返台', loc: 'KLIA T1', note: '14:10 抵台' }] },
    ];

    const INITIAL_REC = [
      { category: '吉隆坡精選 KL Selection', location: 'KL', items: [
        { name: 'Village Park Restaurant', desc: '吉隆坡最好吃的椰漿飯，炸雞與醬汁完美結合。' },
        { name: 'Petronas Twin Towers', desc: '最具代表性的地標夜景，震撼力十足。' }
      ]},
      { category: '居民島探險 Hulhumale', location: 'MV', items: [
        { name: 'Hulhumale Beach', desc: '夕陽極美的公共沙灘，看在地人生活節奏。' },
        { name: 'h78 Maldives Terrace', desc: '飯店頂樓餐廳，俯瞰機場島海景。' }
      ]}
    ];

    const App = () => {
      const [activeTab, setActiveTab] = useState('ITINERARY');
      const [itinerary, setItinerary] = useState(() => JSON.parse(localStorage.getItem('trip_itinerary_v36')) || INITIAL_ITINERARY);
      const [prepList, setPrepList] = useState(() => JSON.parse(localStorage.getItem('trip_prep_v36')) || INITIAL_PREP);
      const [expenses, setExpenses] = useState(() => JSON.parse(localStorage.getItem('trip_expenses_v36')) || []);

      useEffect(() => localStorage.setItem('trip_itinerary_v36', JSON.stringify(itinerary)), [itinerary]);
      useEffect(() => localStorage.setItem('trip_prep_v36', JSON.stringify(prepList)), [prepList]);
      useEffect(() => localStorage.setItem('trip_expenses_v36', JSON.stringify(expenses)), [expenses]);

      const renderContent = () => {
        switch (activeTab) {
          case 'PREPARATION': return <PreparationView prepList={prepList} setPrepList={setPrepList} />;
          case 'ITINERARY': return <ItineraryView itinerary={itinerary} />;
          case 'TRANSPORT': return <TransportView />;
          case 'ACCOMMODATION': return <AccommodationView />;
          case 'RECOMMENDATION': return <RecommendationView />;
          case 'EXPENSE': return <ExpenseView expenses={expenses} setExpenses={setExpenses} />;
          default: return <ItineraryView itinerary={itinerary} />;
        }
      };

      return (
        <div className="min-h-screen flex flex-col pb-safe">
          <header className="fixed top-0 left-0 right-0 z-40 glass-effect border-b border-[#F5EBE0] py-4 pt-safe">
            <div className="max-w-xl mx-auto px-4 flex justify-between items-center">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 bg-[#D8C4B6] rounded-2xl flex items-center justify-center text-white shadow-md"><Compass size={20} /></div>
                <div><h1 className="font-bold text-lg serif text-[#4E342E]">嶼海紀行</h1><p className="text-[9px] font-black text-[#A68A71] uppercase tracking-[0.2em]">Travel Hub v36</p></div>
              </div>
            </div>
          </header>
          <main className="flex-grow pt-24 pb-32 max-w-xl mx-auto w-full px-4">{renderContent()}</main>
          <nav className="fixed bottom-6 left-1/2 -translate-x-1/2 w-[94%] max-w-lg z-50">
            <div className="glass-effect rounded-[2.5rem] shadow-2xl border border-[#F5EBE0]/60 p-1.5 flex justify-between items-center">
              {[
                { id: 'PREPARATION', icon: ClipboardCheck, label: '準備' },
                { id: 'ITINERARY', icon: MapIcon, label: '行程' },
                { id: 'TRANSPORT', icon: Plane, label: '交通' },
                { id: 'ACCOMMODATION', icon: Bed, label: '住宿' },
                { id: 'RECOMMENDATION', icon: Sparkles, label: '推薦' },
                { id: 'EXPENSE', icon: Wallet, label: '換算' }
              ].map(item => (
                <button key={item.id} onClick={() => setActiveTab(item.id)} className={`flex flex-col items-center justify-center py-3 rounded-[1.8rem] transition-all flex-1 ${activeTab === item.id ? 'tab-active scale-105' : 'text-[#A68A71]'}`}>
                  <item.icon size={20} /><span className={`text-[10px] mt-1 font-bold ${activeTab === item.id ? 'block' : 'hidden'}`}>{item.label}</span>
                </button>
              ))}
            </div>
          </nav>
        </div>
      );
    };

    function PreparationView({ prepList, setPrepList }) {
      const categories = ['重要文件', '電子電器', '衣物穿搭', '個人用品', '常備藥品'];
      return (
        <div className="fade-in space-y-6">
          <h2 className="text-3xl font-bold serif text-[#4E342E] px-2">準備清單</h2>
          <div className="space-y-8 pb-10">
            {categories.map(cat => (
              <div key={cat} className="space-y-3">
                <h3 className="text-[10px] font-black text-[#A68A71] uppercase tracking-[0.2em] px-2">{cat}</h3>
                <div className="grid gap-2">
                  {prepList.filter(p => p.category === cat).map(p => (
                    <div key={p.id} className="bg-white p-4 rounded-2xl border border-[#F5EBE0] flex items-center gap-4 shadow-sm hover:border-[#D8C4B6] transition-all">
                      <div className={`checkbox-custom flex-shrink-0 ${p.checked ? 'checked' : ''}`} onClick={() => setPrepList(prepList.map(item => item.id === p.id ? {...item, checked: !item.checked} : item))} />
                      <div className={p.checked ? 'opacity-40' : ''}>
                        <div className={`font-bold text-sm ${p.checked ? 'line-through' : ''}`}>{p.item}</div>
                        <div className="text-[10px] text-[#A68A71] italic">{p.note}</div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    }

    function ItineraryView({ itinerary }) {
      const [dayIdx, setDayIdx] = useState(0);
      const [searchTerm, setSearchTerm] = useState('');
      const [showSearch, setShowSearch] = useState(false);
      const [isRefreshing, setIsRefreshing] = useState(false);
      
      const day = itinerary[dayIdx];

      const handleRefresh = () => {
        setIsRefreshing(true);
        setTimeout(() => setIsRefreshing(false), 800);
      };

      const filteredActivities = useMemo(() => {
        const group = RESORT_ACTIVITY_GROUPS[0];
        if (!searchTerm) return group.items;
        return group.items.filter(item => 
          item.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
          item.detail.toLowerCase().includes(searchTerm.toLowerCase())
        );
      }, [searchTerm]);

      return (
        <div className="fade-in space-y-6">
          <div className="flex overflow-x-auto gap-3 pb-2 no-scrollbar snap-x">
            {itinerary.map((d, i) => (
              <button key={i} onClick={() => setDayIdx(i)} className={`flex-shrink-0 w-12 h-16 rounded-2xl flex flex-col items-center justify-center border transition-all ${dayIdx === i ? 'bg-[#4E342E] text-white shadow-lg' : 'bg-white text-[#A68A71] border-[#F5EBE0]'}`}>
                <span className="text-[8px] font-black uppercase opacity-60">Jan</span><span className="text-lg font-black mt-1">{d.date.split('/')[1]}</span>
              </button>
            ))}
          </div>
          <div className="bg-white p-7 rounded-[2.5rem] border border-[#F5EBE0] shadow-sm mb-6">
            <h2 className="text-2xl font-bold text-[#4E342E] serif leading-tight mb-6">Day 0{dayIdx+1} {day.title}</h2>
            <div className="space-y-8 relative ml-1">
              <div className="absolute left-[17px] top-3 bottom-3 w-[1px] bg-[#F5EBE0]" />
              {day.activities.map(act => (
                <div key={act.id} className="flex gap-5 relative z-10">
                  <div className="w-9 h-9 rounded-xl border-2 border-[#F5EBE0] bg-white flex items-center justify-center text-[#4E342E] shrink-0"><Clock size={16} /></div>
                  <div className="flex-1 cursor-pointer" onClick={() => window.open(getGoogleMapsUrl(act.loc || act.title), '_blank')}>
                    <span className="text-[10px] font-black text-[#D8C4B6]">{act.time}</span>
                    <h4 className="font-bold text-base text-[#4E342E]">{act.title}</h4>
                    {act.loc && <div className="text-[10px] text-[#A68A71] flex items-center gap-1 mt-1 font-bold"><MapPin size={10} /> {act.loc}</div>}
                    {act.note && <p className="text-[10px] text-[#A68A71] italic mt-1">{act.note}</p>}
                  </div>
                </div>
              ))}
            </div>
          </div>
          
          {day.isMaldives && (
            <div className="bg-[#4E342E] p-8 rounded-[2.5rem] text-white shadow-xl mb-6 fade-in">
              <div className="flex justify-between items-center mb-6">
                <h3 className="text-xl font-bold serif flex items-center gap-3">
                  <Waves className="text-[#D8C4B6]" /> 專業潛水與課程
                </h3>
                <div className="flex gap-2">
                  <button onClick={() => setShowSearch(!showSearch)} className="w-9 h-9 bg-white/10 rounded-xl flex items-center justify-center text-[#D8C4B6] hover:bg-white/20 transition-all"><Search size={18} /></button>
                  <button onClick={handleRefresh} className={`w-9 h-9 bg-white/10 rounded-xl flex items-center justify-center text-[#D8C4B6] hover:bg-white/20 transition-all ${isRefreshing ? 'animate-spin' : ''}`}><RefreshCw size={18} /></button>
                </div>
              </div>

              {showSearch && (
                <div className="mb-6 fade-in">
                  <input 
                    type="text" 
                    value={searchTerm} 
                    onChange={(e) => setSearchTerm(e.target.value)} 
                    placeholder="搜尋船潛或課程名稱..." 
                    className="w-full bg-white/10 border-white/10 text-white placeholder:text-white/30 focus:border-[#D8C4B6] focus:bg-white/20"
                    autoFocus
                  />
                </div>
              )}

              <div className="grid gap-4">
                {filteredActivities.map((item, i) => (
                  <div key={i} className="bg-white/5 p-4 rounded-2xl flex justify-between items-center border border-white/5 hover:border-white/20 transition-all">
                    <div className="flex-1 pr-4">
                      <h4 className="font-bold text-sm text-[#D8C4B6]">{item.name}</h4>
                      <p className="text-[9px] text-white/40 mt-0.5">{item.detail}</p>
                    </div>
                    <div className="text-right">
                      <div className="text-lg font-black text-white">${item.price}</div>
                      <div className="text-[8px] opacity-40 font-bold uppercase">USD</div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      );
    }

    function TransportView() {
      const transports = [
        { date: '01/23', id: '高鐵 0818 次', from: '左營', to: '桃園', depTime: '10:25', arrTime: '12:18' },
        { date: '01/23', id: 'MH 367', from: 'TPE', to: 'KUL', depTime: '15:10', arrTime: '20:05' },
        { date: '01/25', id: 'MH 485', from: 'KUL', to: 'MLE', depTime: '09:40', arrTime: '11:00' },
        { date: '01/30', id: 'MH 484', from: 'MLE', to: 'KUL', depTime: '12:00', arrTime: '19:45' },
        { date: '01/31', id: 'MH 366', from: 'KUL', to: 'TPE', depTime: '09:20', arrTime: '14:10' },
      ];
      return (
        <div className="fade-in space-y-6">
          <h2 className="text-3xl font-bold serif text-[#4E342E] px-2">交通資訊</h2>
          {transports.map((t, i) => (
            <div key={i} className="bg-white rounded-[2.5rem] border border-[#F5EBE0] p-7 flex flex-col shadow-sm cursor-pointer hover:border-[#D8C4B6] transition-all" onClick={() => window.open(getGoogleMapsUrl(t.to), '_blank')}>
              <div className="flex justify-between items-center mb-6">
                 <div><div className="font-black text-lg text-[#4E342E]">{t.id}</div><div className="text-[10px] text-[#A68A71] font-bold uppercase tracking-widest">{t.date}</div></div>
                 <div className="w-10 h-10 bg-[#D8C4B6] rounded-xl flex items-center justify-center text-white">{t.id.includes('高鐵') ? <Train size={18} /> : <Plane size={18} />}</div>
              </div>
              <div className="flex items-center justify-between gap-2 px-2">
                <div className="flex flex-col flex-1 items-start">
                  <div className="font-bold text-base text-[#4E342E]">{t.from}</div>
                  <div className="text-3xl font-black text-[#4E342E] tracking-tighter mt-1">{t.depTime}</div>
                </div>
                <div className="opacity-20 flex-shrink-0 pt-6"><ArrowRight size={24} /></div>
                <div className="flex flex-col flex-1 items-end text-right">
                  <div className="font-bold text-base text-[#4E342E]">{t.to}</div>
                  <div className="text-3xl font-black text-[#4E342E] tracking-tighter mt-1">{t.arrTime}</div>
                </div>
              </div>
            </div>
          ))}
        </div>
      );
    }

    function AccommodationView() {
      const hotels = [
        { nameZh: '吉隆坡孟沙假日酒店', nameEn: 'Holiday Inn Kuala Lumpur Bangsar', date: '1/23-1/25', image: 'https://images.unsplash.com/photo-1520250497591-112f2f40a3f4?auto=format&fit=crop&q=80&w=800', note: '時尚孟沙區，下樓即商場，交通非常便利。' },
        { nameZh: '美居馬爾地夫度假村', nameEn: 'Mercure Maldives Kooddoo Resort', date: '1/25-1/29', image: 'https://images.unsplash.com/photo-1514282401047-d79a71a590e8?auto=format&fit=crop&q=80&w=800', note: '全包式水上別墅，環礁生態極佳，潛水者天堂。' },
        { nameZh: '馬爾地夫居民島 h78 飯店', nameEn: 'h78 Maldives', date: '1/30', image: 'https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?auto=format&fit=crop&q=80&w=800', note: '居民島海濱首選，交通銜接機場極度便利。' }
      ];
      return (
        <div className="fade-in space-y-8">
          <h2 className="text-3xl font-bold serif text-[#4E342E] px-2">住宿安排</h2>
          {hotels.map((h, i) => (
            <div key={i} className="bg-white rounded-[3rem] overflow-hidden shadow-sm border border-[#F5EBE0]">
              <div className="h-48 overflow-hidden"><img src={h.image} className="w-full h-full object-cover" /></div>
              <div className="p-8">
                <div className="flex justify-between items-start mb-1">
                   <div className="flex-1 pr-4">
                     <h3 className="text-xl font-bold text-[#4E342E] serif leading-tight">{h.nameZh}</h3>
                     <p className="text-[10px] text-[#A68A71] font-bold uppercase tracking-tight mt-1 opacity-60">{h.nameEn}</p>
                   </div>
                   <button onClick={() => window.open(getGoogleMapsUrl(h.nameEn), '_blank')} className="w-10 h-10 bg-[#4E342E] text-white rounded-xl flex items-center justify-center shadow-lg active:scale-95 transition-all"><Compass size={20} /></button>
                </div>
                <div className="text-xs text-[#A68A71] flex items-center gap-2 my-4"><Calendar size={14} /> {h.date}</div>
                <p className="bg-[#FDFBF7] p-4 rounded-2xl border border-[#F5EBE0] text-xs italic text-[#4E342E] leading-relaxed">{h.note}</p>
              </div>
            </div>
          ))}
        </div>
      );
    }

    function RecommendationView() {
      const [filter, setFilter] = useState('ALL');
      const [isRefreshing, setIsRefreshing] = useState(false);

      const handleRefresh = () => {
        setIsRefreshing(true);
        setTimeout(() => setIsRefreshing(false), 800);
      };

      const filteredRecs = useMemo(() => {
        if (filter === 'ALL') return INITIAL_REC;
        return INITIAL_REC.filter(cat => cat.location === filter);
      }, [filter]);

      return (
        <div className="fade-in space-y-8">
          <div className="flex justify-between items-center px-2">
            <h2 className="text-3xl font-bold serif text-[#4E342E]">在地推薦</h2>
            <div className="flex gap-2">
              <div className="bg-white/50 p-1 rounded-xl border border-[#F5EBE0] flex">
                <button onClick={() => setFilter('KL')} className={`px-3 py-1.5 rounded-lg text-[10px] font-black transition-all ${filter === 'KL' ? 'bg-[#4E342E] text-white shadow-md' : 'text-[#A68A71]'}`}>吉隆坡</button>
                <button onClick={() => setFilter('MV')} className={`px-3 py-1.5 rounded-lg text-[10px] font-black transition-all ${filter === 'MV' ? 'bg-[#4E342E] text-white shadow-md' : 'text-[#A68A71]'}`}>居民島</button>
                <button onClick={() => setFilter('ALL')} className={`px-3 py-1.5 rounded-lg text-[10px] font-black transition-all ${filter === 'ALL' ? 'bg-[#4E342E] text-white shadow-md' : 'text-[#A68A71]'}`}>全部</button>
              </div>
              <button onClick={handleRefresh} className={`w-10 h-10 bg-[#D8C4B6] text-white rounded-xl flex items-center justify-center shadow-md active:scale-95 transition-all ${isRefreshing ? 'animate-spin' : ''}`}><RefreshCw size={20} /></button>
            </div>
          </div>

          <div className="space-y-10">
            {filteredRecs.map((cat, idx) => (
              <section key={idx} className="space-y-4">
                <h3 className="font-bold text-lg text-[#4E342E] serif flex items-center gap-2 px-2">
                  <Utensils size={18} className="text-[#A68A71]" /> {cat.category}
                </h3>
                <div className="grid gap-4">
                  {cat.items.map((item, i) => (
                    <div key={i} className="bg-white p-6 rounded-[2.5rem] border border-[#F5EBE0] shadow-sm cursor-pointer hover:border-[#D8C4B6] transition-all" onClick={() => window.open(getGoogleMapsUrl(item.name), '_blank')}>
                      <h4 className="font-bold text-[#4E342E] text-base mb-2">{item.name}</h4>
                      <p className="text-xs text-[#A68A71] leading-relaxed italic">{item.desc}</p>
                    </div>
                  ))}
                </div>
              </section>
            ))}
          </div>
        </div>
      );
    }

    function ExpenseView({ expenses, setExpenses }) {
      const [convVal, setConvVal] = useState('');
      const [convMode, setConvMode] = useState('USD');
      const totalTwd = expenses.reduce((sum, e) => sum + e.twd, 0);

      return (
        <div className="fade-in space-y-6 pb-20">
          <div className="bg-white p-8 rounded-[2.5rem] border border-[#F5EBE0] shadow-sm space-y-6">
            <h3 className="font-bold text-sm text-[#4E342E] flex items-center gap-2"><DollarSign size={16} className="text-[#D8C4B6]" /> 匯率換算</h3>
            
            <div className="space-y-4">
              <div className="bg-[#FDFBF7] p-5 rounded-3xl border border-[#F5EBE0]">
                <div className="flex justify-between items-center mb-3">
                  <span className="text-[10px] font-black text-[#A68A71] uppercase tracking-widest">美金 (USD) 1 : {USD_TO_TWD}</span>
                  <div className={`px-2 py-0.5 rounded-md text-[8px] font-black ${convMode === 'USD' ? 'bg-[#4E342E] text-white' : 'bg-transparent text-[#D8C4B6]'}`}>SELECTED</div>
                </div>
                <div className="flex items-center gap-3">
                  <input type="number" value={convMode === 'USD' ? convVal : ''} onChange={e => {setConvVal(e.target.value); setConvMode('USD');}} placeholder="輸入美金金額" className="flex-1 text-xl font-black bg-transparent py-1 border-b border-transparent focus:border-[#D8C4B6] transition-all" />
                  <span className="text-xs font-bold text-[#A68A71]">≈ NT$ {convMode === 'USD' ? Math.round((parseFloat(convVal) || 0) * USD_TO_TWD).toLocaleString() : '0'}</span>
                </div>
              </div>

              <div className="bg-[#FDFBF7] p-5 rounded-3xl border border-[#F5EBE0]">
                <div className="flex justify-between items-center mb-3">
                  <span className="text-[10px] font-black text-[#A68A71] uppercase tracking-widest">令吉 (MYR) 1 : {MYR_TO_TWD}</span>
                  <div className={`px-2 py-0.5 rounded-md text-[8px] font-black ${convMode === 'MYR' ? 'bg-[#4E342E] text-white' : 'bg-transparent text-[#D8C4B6]'}`}>SELECTED</div>
                </div>
                <div className="flex items-center gap-3">
                  <input type="number" value={convMode === 'MYR' ? convVal : ''} onChange={e => {setConvVal(e.target.value); setConvMode('MYR');}} placeholder="輸入令吉金額" className="flex-1 text-xl font-black bg-transparent py-1 border-b border-transparent focus:border-[#D8C4B6] transition-all" />
                  <span className="text-xs font-bold text-[#A68A71]">≈ NT$ {convMode === 'MYR' ? Math.round((parseFloat(convVal) || 0) * MYR_TO_TWD).toLocaleString() : '0'}</span>
                </div>
              </div>
            </div>
          </div>

          <div className="bg-[#4E342E] p-8 rounded-[3rem] text-white shadow-2xl flex justify-between items-center">
            <div><p className="text-[10px] font-black opacity-50 uppercase tracking-widest">總支出預估</p><h2 className="text-3xl font-black mt-1">NT$ {totalTwd.toLocaleString()}</h2></div>
            <Wallet size={40} className="opacity-10" />
          </div>

          <div className="flex justify-between items-center px-2">
            <h2 className="text-xl font-bold serif text-[#4E342E]">支出明細</h2>
            <button className="w-10 h-10 bg-[#4E342E] text-white rounded-xl flex items-center justify-center shadow-lg active:scale-95 transition-all"><Plus size={20} /></button>
          </div>

          <div className="space-y-3">
            {expenses.map(e => (
              <div key={e.id} className="bg-white p-5 rounded-2xl border border-[#F5EBE0] flex justify-between items-center shadow-sm">
                <div><div className="font-bold text-[#4E342E] text-sm">{e.title}</div><div className="text-[10px] text-[#A68A71] font-bold uppercase">{e.currency} {e.amount}</div></div>
                <div className="text-right font-black text-[#4E342E]">NT$ {e.twd.toLocaleString()}</div>
              </div>
            ))}
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>