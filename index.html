<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  
  <!-- iOS & Android Web App Capable Settings -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#FDFBF7">
  <meta name="format-detection" content="telephone=no">
  <meta name="application-name" content="å¶¼æµ·ç´€è¡Œ">
  <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3125/3125848.png"> 
  
  <title>å¶¼æµ·ç´€è¡Œ</title>
  
  <!-- Libraries -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --milk-tea-primary: #4E342E;
      --milk-tea-secondary: #D8C4B6;
      --milk-tea-accent: #A68A71;
      --milk-tea-bg: #FDFBF7;
    }
    body {
      font-family: 'Noto Sans TC', sans-serif;
      background-color: var(--milk-tea-bg);
      color: var(--milk-tea-primary);
      -webkit-tap-highlight-color: transparent;
      overflow-x: hidden;
      overscroll-behavior-y: none;
    }
    .serif { font-family: 'Noto Serif TC', serif; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    .glass-effect {
      background: rgba(253, 251, 247, 0.85);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    .fade-in { animation: fadeIn 0.4s ease-out forwards; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
    .pt-safe { padding-top: env(safe-area-inset-top); }
    
    .tab-active {
      background-color: var(--milk-tea-secondary);
      color: white;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
    }
    
    input, textarea, select { outline: none; border: 1px solid #F5EBE0; border-radius: 12px; padding: 10px 14px; background: #FDFBF7; width: 100%; font-size: 14px; color: #4E342E; }
    input:focus, textarea:focus, select:focus { border-color: var(--milk-tea-secondary); box-shadow: 0 0 0 2px rgba(216, 196, 182, 0.2); }
    
    .checkbox-custom { width: 22px; height: 22px; border-radius: 6px; border: 2px solid #D8C4B6; display: flex; align-items: center; justify-content: center; transition: all 0.2s; cursor: pointer; }
    .checkbox-custom.checked { background-color: #D8C4B6; }
    .checkbox-custom.checked::after { content: '\f00c'; font-family: 'Font Awesome 6 Free'; font-weight: 900; color: white; font-size: 12px; }

    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(78, 52, 46, 0.4);
      backdrop-filter: blur(4px);
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
  </style>

  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.460.0",
    "react/": "https://esm.sh/react@^19.2.3/",
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0"
  }
}
</script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel" data-type="module">
    import React, { useState, useEffect, useMemo, useRef } from 'react';
    import ReactDOM from 'react-dom/client';
    import { 
      ClipboardCheck, Map as MapIcon, Plane, Bed, Sparkles, Plus,
      Compass, Wallet, X, Trash2, Clock, Star, Waves, Edit2,
      Calendar, MapPin, ExternalLink, Train, ArrowRight, ChevronRight,
      Check, Utensils, Camera, ShoppingBag, Info, Luggage, Save, DollarSign, RefreshCw, Anchor, LifeBuoy, Search, Bus, Paperclip, Bot, Lightbulb, Settings, Send, Tag
    } from 'lucide-react';

    // Global Constants
    const USD_TO_TWD = 32.5;
    const MYR_TO_TWD = 7.5;
    const getGoogleMapsUrl = (name) => `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(name)}`;

    const RESORT_ACTIVITY_GROUPS = [
      {
        id: 'diving',
        category: 'å°ˆæ¥­æ½›æ°´ (Diving)',
        items: [
          { name: '1 Single Boat Dive', price: 65, detail: 'åƒ…å«æ°£ç“¶èˆ‡é…é‡ (Tanks & Weights ONLY)' },
          { name: '1 Single Boat Dive (Full Set)', price: 89, detail: 'åŒ…å« BCDã€å‘¼å¸å™¨ã€é›»è…¦éŒ¶ã€é˜²å¯’è¡£å…¨å¥—è£å‚™' },
          { name: '3 Dive Package (Full Set)', price: 260, detail: '3 æ¬¡èˆ¹æ½›å„ªæƒ å¥—è£ï¼Œå«å…¨å¥—è£å‚™' },
          { name: '5 Dive Package (Full Set)', price: 419, detail: '5 æ¬¡èˆ¹æ½›å„ªæƒ å¥—è£ï¼Œå«å…¨å¥—è£å‚™' },
          { name: '10 Dive Package (Full Set)', price: 750, detail: '10 æ¬¡èˆ¹æ½›å„ªæƒ å¥—è£ï¼Œå«å…¨å¥—è£å‚™' },
          { name: 'Orientation Dive', price: 0, detail: 'æ°£ç“¶æª¢é©—æ½›æ°´ï¼šæŒ‰æ³•è¦å°‘æ–¼ 30 æ”¯æˆ– 3 å€‹æœˆç„¡ç´€éŒ„è€…å¿…å‚™' }
        ]
      },
      {
        id: 'courses',
        category: 'è­‰ç…§èª²ç¨‹ (PADI Courses)',
        items: [
          { name: 'PADI Scuba Refresh', price: 105, detail: 'æ°´ä¸‹æŠ€å·§è¤‡ç¿’èˆ‡ 1 æ¬¡æ•™ç·´é™ªåŒèˆ¹æ½›' },
          { name: 'PADI Discover Scuba (DSD)', price: 140, detail: 'åˆå­¸è€…é«”é©—æ½›æ°´ï¼ˆå«æ³³æ± å¯¦ç¿’èˆ‡ 1 æ¬¡èˆ¹æ½›ï¼‰' },
          { name: 'Discover Scuba / Training Dive', price: 85, detail: 'å®Œæˆé«”é©—æ½›æ°´ï¼ˆDSDï¼‰å¾Œä¹‹åŠ è³¼èˆ¹æ½›è¡Œç¨‹' },
          { name: 'PADI Scuba Diver (SD)', price: 390, detail: 'åŒ…å« 2 æ¬¡èˆ¹æ½›èˆ‡ PADI æ°´è‚ºæ½›æ°´å“¡è­‰ç…§' },
          { name: 'PADI Open Water Diver (OWD)', price: 650, detail: 'åˆéšè­‰ç…§èª²ç¨‹ï¼ŒåŒ…å« 4 æ¬¡èˆ¹æ½›èˆ‡åœ‹éš›è­‰ç…§' },
          { name: 'PADI Advanced Open Water (AOW)', price: 550, detail: 'é€²éšè­‰ç…§èª²ç¨‹ï¼ŒåŒ…å« 5 æ¬¡èˆ¹æ½›èˆ‡åœ‹éš›è­‰ç…§' }
        ]
      },
      {
        id: 'watersports',
        category: 'æ°´ä¸Šæ´»å‹• (Water Sports)',
        items: [
          { name: 'Windsurfing Lesson', price: 70, detail: 'å°ˆæ¥­é¢¨å¸†è¡æµªæ•™å­¸èª²ç¨‹ï¼ˆ60 åˆ†é˜ï¼‰' },
          { name: 'Jetski Rental 15m', price: 65, detail: 'å™´å°„æ°´ä¸Šæ‘©æ‰˜è»Šç§Ÿè³ƒï¼ˆ15 åˆ†é˜ï¼‰' },
          { name: 'Jetski Rental 30m', price: 110, detail: 'å™´å°„æ°´ä¸Šæ‘©æ‰˜è»Šç§Ÿè³ƒï¼ˆ30 åˆ†é˜ï¼‰' },
          { name: 'Wakeboard Lesson', price: 55, detail: 'å¯¬æ¿/æ°´ä¸Šæ»‘æ¿æ•™å­¸èª²ç¨‹ï¼ˆ30 åˆ†é˜ï¼‰' },
          { name: 'Fun Tube Ride', price: 25, detail: 'å……æ°£æ‹–æ›³åœˆ/é¦™è•‰èˆ¹åˆºæ¿€é«”é©—ï¼ˆ15 åˆ†é˜/æ¯äººï¼‰' },
          { name: 'Kayak', price: 0, detail: 'ç¨æœ¨èˆŸï¼šæˆ¿å®¢å¯äº«å…è²»ç§Ÿå€Ÿä½¿ç”¨' },
          { name: 'SUP Stand up paddle board', price: 0, detail: 'ç«‹æ§³è¡æµªæ¿ï¼šæˆ¿å®¢å¯äº«å…è²»ç§Ÿå€Ÿä½¿ç”¨' }
        ]
      },
      {
        id: 'excursions',
        category: 'ç²¾é¸å‡ºæµ·è¡Œç¨‹ (Excursions)',
        items: [
          { name: 'Snorkeling Lesson', price: 20, detail: 'æµ®æ½›åŸºç¤æ•™å­¸èˆ‡æŠ€å·§æŒ‡å°ï¼ˆ30 åˆ†é˜ï¼‰' },
          { name: 'Snorkeling Trip', price: 60, detail: '90 åˆ†é˜å°ˆæ¥­æµ®æ½›å‡ºæµ·è¡Œç¨‹ï¼ˆå«å®Œæ•´è£å‚™ï¼‰' },
          { name: 'Dolphin Adventure', price: 60, detail: '90 åˆ†é˜å°‹æ‰¾é‡ç”Ÿæµ·è±šè¹¤å½±å†’éšªä¹‹æ—…' },
          { name: 'Line Fishing Trip', price: 70, detail: 'æ‰‹ç·šæµ·é‡£è¡Œç¨‹ï¼Œé«”é©—é¦¬çˆ¾åœ°å¤«å‚³çµ±æ•é­š' },
          { name: 'Sunset Fishing', price: 70, detail: 'æµªæ¼«é»ƒæ˜æµ·é‡£ï¼Œäº«å—å¤•é™½èˆ‡å‚³çµ±æµ·é‡£æ¨‚è¶£' },
          { name: 'Sand Bank Trip', price: 100, detail: 'å¤¢å¹»ç„¡äººæ²™æ´²ç™»å³¶è¡Œç¨‹ï¼Œæ¥µè‡´åº¦å‡æ”å½±ï¼ˆ180 åˆ†é˜ï¼‰' }
        ]
      }
    ];

    const INITIAL_PREP = [
      { id: 'p1', category: 'é‡è¦æ–‡ä»¶', item: 'è­·ç…§æ­£æœ¬ (æ•ˆæœŸ6å€‹æœˆä»¥ä¸Š)', note: 'å»ºè­°æ‹ç…§å­˜æ‰‹æ©Ÿé›²ç«¯å‚™ä»½', checked: false },
      { id: 'p2', category: 'é‡è¦æ–‡ä»¶', item: 'é¦¬çˆ¾åœ°å¤« IMUGA ç”³å ±', note: 'æŠµé”å‰96å°æ™‚å…§å¡«å¯«', checked: false, link: 'https://www.stan-travel.com/imuga-maldives-immigration/' },
      { id: 'p3', category: 'é‡è¦æ–‡ä»¶', item: 'é¦¬ä¾†è¥¿äº MDAC é›»å­å¡', note: 'æŠµé”å‰3å¤©å…§å¡«å¯«', checked: false, link: 'https://ianchen.life/mdac-application-malaysia/' },
      { id: 'p4', category: 'é‡è¦æ–‡ä»¶', item: 'æ—…éŠè¡Œç¨‹è¡¨/æ©Ÿç¥¨/é£¯åº—æ†‘è­‰', note: 'ç´™æœ¬å‚™ä»½', checked: false },
      { id: 'p5', category: 'é‡è¦æ–‡ä»¶', item: 'æµ·å¤–æ—…éŠä¿éšªå–®', note: 'åŒ…å«é†«ç™‚èˆ‡ç­æ©Ÿä¸ä¾¿éšª', checked: false },
      { id: 'p6', category: 'é‡è¦æ–‡ä»¶', item: 'å¤–å¹£ç¾é‡‘ (ç¾é‡‘/ä»¤å‰)', note: 'ç¾é‡‘éœ€2009å¹´å¾Œæ–°éˆ”', checked: false },
      { id: 'p24', category: 'é‡è¦æ–‡ä»¶', item: 'çµå©šæ›¸ç´„(é›»å­ç‰ˆ)', note: 'ç”³è«‹èœœæœˆç¦®æŸ¥é–±', checked: false },
      { id: 'p7', category: 'é›»å­é›»å™¨', item: 'è¬ç”¨è½‰æ¥é ­ (è‹±å¼ä¸‰å­”)', note: 'é¦¬çˆ¾åœ°å¤«èˆ‡é¦¬ä¾†è¥¿äºé€šç”¨', checked: false },
      { id: 'p8', category: 'é›»å­é›»å™¨', item: 'è¡Œå‹•é›»æº (10000mAh+)', note: 'å‡ºæµ·è¡Œç¨‹é›»åŠ›å‚™æ´', checked: false },
      { id: 'p10', category: 'é›»å­é›»å™¨', item: 'GoPro æˆ– é˜²æ°´ç›¸æ©Ÿ', note: 'æ°´ä¸‹æ”å½±éˆé­‚', checked: false },
      { id: 'p11', category: 'è¡£ç‰©ç©¿æ­', item: 'æ³³è£/æ¯”åŸºå°¼ (2-3å¥—)', note: 'æ–¹ä¾¿æ›æ´—', checked: false },
      { id: 'p12', category: 'è¡£ç‰©ç©¿æ­', item: 'æ°´æ¯è¡£ (é•·è¢–é˜²ç£¨è¡£)', note: 'æµ®æ½›é˜²æ›¬é˜²åˆ®å‚·', checked: false },
      { id: 'p13', category: 'è¡£ç‰©ç©¿æ­', item: 'é®é™½å¸½/å¢¨é¡', note: 'æµ·é‚Šå¼·å…‰å¿…å‚™', checked: false },
      { id: 'p16', category: 'å€‹äººç”¨å“', item: 'æµ·æ´‹å‹å–„é˜²æ›¬æ²¹', note: 'SPF50+ï¼Œä¸å‚·çŠç‘š', checked: false },
      { id: 'p17', category: 'å€‹äººç”¨å“', item: 'è˜†è–ˆä¿®è­·å‡è† ', note: 'æ›¬å¾Œèˆ’ç·©å¿…å‚™', checked: false },
      { id: 'p18', category: 'å€‹äººç”¨å“', item: 'æµ®æ½›ä¸‰å¯¶ (é¢é¡/å‘¼å¸ç®¡)', note: 'è¡›ç”Ÿè€ƒé‡å»ºè­°è‡ªå‚™', checked: false },
      { id: 'p19', category: 'å€‹äººç”¨å“', item: 'é˜²æ°´è¢‹ (10-20L)', note: 'å‡ºæµ·ä¿è­·éš¨èº«ç‰©å“', checked: false },
      { id: 'p21', category: 'å¸¸å‚™è—¥å“', item: 'æšˆèˆ¹è—¥ (å¼·åŠ›å‹)', note: 'é¦¬ä»£å¿«è‰‡/å°é£›æ©Ÿå¿…å‚™', checked: false },
      { id: 'p23', category: 'å¸¸å‚™è—¥å“', item: 'è…¸èƒƒè—¥/æ­¢ç€‰è—¥', note: 'é é˜²æ°´åœŸä¸æœ', checked: false },
    ];

    const INITIAL_ITINERARY = [
      { date: '1/23', title: 'å‰éš†å¡å­Ÿæ²™', activities: [{ id: '1', time: '10:25', title: 'é«˜éµå·¦ç‡Ÿ -> æ¡ƒåœ’', loc: 'é«˜éµæ¡ƒåœ’ç«™', note: '12:18 æŠµé”æ¡ƒåœ’' }, { id: '2', time: '15:10', title: 'MH367 èµ·é£›', loc: 'æ¡ƒåœ’æ©Ÿå ´ T1', note: '20:05 æŠµé” KUL' }, { id: '3', time: '21:30', title: 'é£¯åº— Check-in', loc: 'Holiday Inn Bangsar', note: 'å‰éš†å¡ç¬¬ä¸€æ™š' }] },
      { 
        date: '1/24', 
        title: 'ç²¾é¸ä¸€æ—¥éŠ', 
        activities: [
          { id: '401', time: '10:00', title: 'è°·ä¸­åŸ MaxMoney', loc: 'MaxMoney Mid Valley', note: 'æ›åŒ¯é¦–é¸' },
          { id: '402', time: '11:00', title: 'è°·ä¸­åŸè¯é™½èŒ¶å®¤', loc: 'Mid Valley Oriental Kopi', note: 'å¿…åƒæ³¢ç¾…åŒ…' },
          { id: '403', time: '12:30', title: 'è°·ä¸­åŸæ¡è³¼', loc: 'Mid Valley Megamall', note: 'æ¡è²·ä¼´æ‰‹ç¦®' },
          { id: '404', time: '14:00', title: 'Philo headspa', loc: 'Philo Hair & Head Spa', note: 'æ”¾é¬†é«”é©—' },
          { id: '405', time: '16:30', title: 'Village Park Restaurant ç‚¸é›æ¤°æ¼¿é£¯', loc: 'Uptown Damansara', note: 'ç‚¸é›å¿…åƒ' },
          { id: '406', time: '18:00', title: 'é¬¼ä»”å··', loc: 'Kwai Chai Hong', note: 'æ–‡åŒ–è—è¡“å€' },
          { id: '407', time: '19:00', title: 'REXKLæ›¸å±€', loc: 'BookXcess at REXKL', note: 'ç‰¹è‰²æ›¸å±€' },
          { id: '408', time: '20:00', title: 'é›™å­å¡”', loc: 'Petronas Twin Towers', note: 'å¤œé–“æ”å½±' },
          { id: '409', time: '21:00', title: 'ç± çš„å‚³äººé¤å»³æˆ–ä¸‰ç¾è‚‰éª¨èŒ¶', loc: 'Pavilion KL / City', note: 'æ™šé¤æ™‚åˆ»' },
          { id: '410', time: '22:00', title: 'æŸå¨å¹´å»£å ´é€›è¡—', loc: 'Pavilion Kuala Lumpur', note: 'å¸‚ä¸­å¿ƒç™¾è²¨' },
          { id: '411', time: '23:00', title: 'å›é£¯åº—', loc: 'Holiday Inn Bangsar', note: 'ä¼‘æ•´ä¼‘æ¯' }
        ] 
      },
      { date: '1/25', title: 'é£›å‘ç¾å±…åº¦å‡æ‘', isMaldives: true, activities: [{ id: '7', time: '09:40', title: 'MH485 é£›é¦¬ç´¯', loc: 'KLIA T1', note: '11:00 æŠµé”' }, { id: '8', time: '16:00', title: 'å…¥ä½ç¾å±…åº¦å‡æ‘', loc: 'Mercure Maldives Kooddoo', note: 'å…¨åŒ…å¼åº¦å‡é–‹å§‹' }] },
      { date: '1/26', title: 'æ·±æµ·æ¢ç´¢', isMaldives: true, activities: [{ id: '261', time: '09:00', title: 'æ™¨é–“æ½›æ°´èª²ç¨‹', loc: 'Dive Center', note: 'PADI èª²ç¨‹é€²åº¦' }] },
      { date: '1/27', title: 'èˆ¹æ½›å†’éšª', isMaldives: true, activities: [{ id: '271', time: '08:30', title: 'ç’°ç¤èˆ¹æ½›', loc: 'Kooddoo Jetty', note: 'æ¢ç´¢æ›´é çš„æ½›é»' }] },
      { date: '1/28', title: 'æ°´ä¸‹æ”å½±', isMaldives: true, activities: [{ id: '281', time: '10:00', title: 'çŠç‘šç¤æµ®æ½›', loc: 'House Reef', note: 'ç´€éŒ„è±å¯Œç”Ÿæ…‹' }] },
      { date: '1/29', title: 'æ”¾é¬†æ™‚å…‰', isMaldives: true, activities: [{ id: '291', time: '11:00', title: 'äº«å—æ¸¡å‡æ‘è¨­æ–½', loc: 'Pool Bar', note: 'å…¨åŒ…å¼é¤é£²æœå‹™' }, { id: '301', time: '14:00', title: 'æ­èˆ¹å‰å¾€å±…æ°‘å³¶', loc: 'Hulhumale', note: 'å…¥ä½ h78 é£¯åº—' }] },
      { date: '1/30', title: 'å›ç¨‹å‰éš†å¡', activities: [{ id: '302', time: '19:45', title: 'é£›æŠµå‰éš†å¡', loc: 'KLIA T1', note: 'MH484 æŠµé”' }, { id: '312', time: '21:30', title: 'å…¥ä½ Umi æ°‘å®¿', loc: 'Umi SplashMania homestay', note: 'æº«é¦¨ä¼‘æ¯ç©ºé–“' }] },
      { date: '1/31', title: 'å¹³å®‰è³¦æ­¸', activities: [{ id: '211', time: '09:20', title: 'MH366 èµ·é£›', loc: 'KLIA T1', note: '14:10 æŠµé” TPE' }, { id: '212', time: '16:34', title: 'é«˜éµæ¡ƒåœ’ -> å·¦ç‡Ÿ', loc: 'é«˜éµæ¡ƒåœ’ç«™', note: '18:25 æŠµé”å·¦ç‡Ÿ' }] }
    ];

    const INITIAL_TRANSPORTS = [
      { localId: 't1', date: '01/23', id: 'é«˜éµ 0818 æ¬¡', from: 'å·¦ç‡Ÿ', to: 'æ¡ƒåœ’', depTime: '10:25', arrTime: '12:18', type: 'Train' },
      { localId: 't2', date: '01/23', id: 'MH 367', from: 'TPE', to: 'KUL', depTime: '15:10', arrTime: '20:05', type: 'Plane' },
      { localId: 't3', date: '01/25', id: 'MH 485', from: 'KUL', to: 'MLE', depTime: '09:40', arrTime: '11:00', type: 'Plane' },
      { localId: 't4', date: '01/30', id: 'MH 484', from: 'MLE', to: 'KUL', depTime: '12:00', arrTime: '19:45', type: 'Plane' },
      { localId: 't5', date: '01/31', id: 'MH 366', from: 'KUL', to: 'TPE', depTime: '09:20', arrTime: '14:10', type: 'Plane' },
      { localId: 't6', date: '01/31', id: 'é«˜éµ 0841 æ¬¡', from: 'æ¡ƒåœ’', to: 'å·¦ç‡Ÿ', depTime: '16:34', arrTime: '18:25', type: 'Train' }
    ];

    const REC_POOLS = [
      [
        { category: 'å‰éš†å¡ç²¾é¸ KL Selection', location: 'KL', items: [
          { name: 'Village Park Restaurant', desc: 'å‰éš†å¡æœ€å¥½åƒçš„æ¤°æ¼¿é£¯ï¼Œç‚¸é›èˆ‡é†¬æ±å®Œç¾çµåˆã€‚' },
          { name: 'Petronas Twin Towers', desc: 'æœ€å…·ä»£è¡¨æ€§çš„åœ°æ¨™å¤œæ™¯ï¼Œéœ‡æ’¼åŠ›åè¶³ã€‚' },
          { name: 'SplashMania Waterpark', desc: 'å‰éš†å¡è¿‘éƒŠæœ€æ–°æ°´ä¸Šæ¨‚åœ’ï¼Œè¨­æ–½è±å¯Œåˆºæ¿€ã€‚' }
        ]},
        { category: 'å±…æ°‘å³¶æ¢éšª Hulhumale', location: 'MV', items: [
          { name: 'Hulhumale Beach', desc: 'å¤•é™½æ¥µç¾çš„å…¬å…±æ²™ç˜ï¼Œçœ‹åœ¨åœ°äººç”Ÿæ´»ç¯€å¥ã€‚' },
          { name: 'h78 Maldives Terrace', desc: 'é£¯åº—é ‚æ¨“é¤å»³ï¼Œä¿¯ç°æ©Ÿå ´å³¶æµ·æ™¯ã€‚' }
        ]}
      ],
      [
        { category: 'å‰éš†å¡æ–‡åŒ– KL Culture', location: 'KL', items: [
          { name: 'Batu Caves', desc: 'é»‘é¢¨æ´ï¼Œå£¯è§€çš„çŸ³ç°å²©æ´ç©´èˆ‡å½©è‰²éšæ¢¯ã€‚' },
          { name: 'Jalan Alor', desc: 'äºç¾…è¡—å¤œå¸‚ï¼Œé«”é©—åœ¨åœ°å¤§æ’æª”ç¾é£Ÿæ–‡åŒ–ã€‚' },
          { name: 'Thean Hou Temple', desc: 'å¤©åå®®ï¼Œèåˆç¾ä»£èˆ‡å‚³çµ±çš„è¯äººå»Ÿå®‡ï¼Œä¿¯ç°å¸‚æ™¯ã€‚' }
        ]},
        { category: 'é¦¬çˆ¾åœ°å¤«ä¼‘é–’ Chill MV', location: 'MV', items: [
          { name: 'Local Market', desc: 'é«”é©—é¦¬çˆ¾åœ°å¤«ç•¶åœ°å¸‚é›†ï¼Œæ„Ÿå—ç†±å¸¶æ°´æœèˆ‡é¦™æ–™ã€‚' },
          { name: 'Central Park', desc: 'Hulhumale ä¸­å¤®å…¬åœ’ï¼Œç¶ æ„ç›ç„¶çš„æ”¾é¬†å»è™•ã€‚' }
        ]}
      ]
    ];

    // Categorized Travel Tips
    const TRAVEL_TIPS_CATEGORIES = [
      { id: 'prepare', icon: ClipboardCheck, name: 'è¡Œå‰é ˆçŸ¥', desc: 'ç°½è­‰ã€æ°£å€™ã€æ™‚å·®' },
      { id: 'money', icon: Wallet, name: 'é‡‘éŒ¢æ¶ˆè²»', desc: 'åŒ¯ç‡ã€å°è²»ã€åˆ·å¡' },
      { id: 'transport', icon: Bus, name: 'äº¤é€šç§»å‹•', desc: 'Grabã€æ©Ÿå ´ã€æ¸¡è¼ª' },
      { id: 'life', icon: Info, name: 'ç”Ÿæ´»å¯¦ç”¨', desc: 'é›»å£“ã€ç¶²è·¯ã€ç©¿è‘—' },
      { id: 'culture', icon: Star, name: 'æ–‡åŒ–ç¦å¿Œ', desc: 'å®—æ•™ã€é£²é£Ÿã€ç¦®å„€' },
    ];

    // Raw tips with inferred categories (in a real app these would be tagged in the data)
    const RAW_TRAVEL_TIPS = [
      { text: "é¦¬çˆ¾åœ°å¤«å‡æº«30åº¦ï¼Œ5-10æœˆé›¨å­£ï¼›å‰éš†å¡åˆå¾Œå¸¸é›·é›¨ã€‚", cat: "prepare" },
      { text: "å…¥å¢ƒå¤§é¦¬å‰3å¤©å¡«MDACï¼›é¦¬çˆ¾åœ°å¤«å¡«IMUGAï¼Œå…ç°½ã€‚", cat: "prepare" },
      { text: "1é¦¬å¹£â‰ˆ7.5å°å¹£ï¼›é¦¬çˆ¾åœ°å¤«ç”¨ç¾é‡‘ï¼Œ1ç¾é‡‘â‰ˆ32.5å°å¹£ã€‚", cat: "money" },
      { text: "é¦¬ä¾†è¥¿äºç„¡æ™‚å·®ï¼›é¦¬çˆ¾åœ°å¤«æ…¢å°ç£3å°æ™‚ (GMT+5)ã€‚", cat: "prepare" },
      { text: "å…©åœ°é›»å£“230Vï¼Œçš†ç”¨è‹±å¼ä¸‰å­”æ’åº§ (Type G)ã€‚", cat: "life" },
      { text: "ç¶²å¡å»ºè­°eSIMï¼›æ¸¡å‡æ‘å¤šæœ‰å…è²»WiFiï¼Œè¨Šè™Ÿç©©å®šã€‚", cat: "life" },
      { text: "ç†±å¸¶æ°£å€™ç©¿é€æ°£è¡£ç‰©ï¼Œå®¤å…§å†·æ°£å¼·å»ºè­°å¸¶è–„å¤–å¥—ã€‚", cat: "life" },
      { text: "æ¸…çœŸå¯ºéœ€ç©¿é•·è¢ï¼›å±…æ°‘å³¶ç¦é…’ç¦è±¬è‚‰ï¼Œåº¦å‡æ‘ä¸é™ã€‚", cat: "culture" },
      { text: "è‡ªä¾†æ°´ä¸å¯ç”Ÿé£²ï¼Œå»ºè­°è²·ç“¶è£æ°´ï¼›é˜²æ›¬è«‹ç”¨æµ·æ´‹å‹å–„æ¬¾ã€‚", cat: "life" },
      { text: "é¦¬çˆ¾åœ°å¤«å°è²»ï¼šè¡Œæ/åºŠé ­ç´„1-2ç¾é‡‘ï¼Œæœå‹™è²»å¦è¨ˆã€‚", cat: "money" },
      { text: "å‰éš†å¡Grabå«è»Šä¾¿å®œåˆæ–¹ä¾¿ï¼Œå»ºè­°ç¶å®šä¿¡ç”¨å¡ä»˜æ¬¾ã€‚", cat: "transport" },
      { text: "é¦¬çˆ¾åœ°å¤«é€±äº”æ˜¯ä¸»éº»æ—¥ï¼Œå±…æ°‘å³¶æ¸¡è¼ªå¯èƒ½æ¸›ç­ã€‚", cat: "transport" },
      { text: "å‰éš†å¡å¿…åƒè‚‰éª¨èŒ¶ï¼Œæ–°å³°è‚‰éª¨èŒ¶è—¥æå‘³æ¿ƒéƒã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«åš´ç¦æ”œå¸¶é…’ç²¾èˆ‡è±¬è‚‰è£½å“å…¥å¢ƒï¼ŒæŸ¥ç²æœƒæ²’æ”¶ã€‚", cat: "culture" },
      { text: "é›™å­æ˜Ÿå¡”é€±ä¸€å…¬ä¼‘ï¼Œåƒè§€ç©ºæ©‹å»ºè­°æå‰ç¶²è·¯è³¼ç¥¨ã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«æ°´ä¸Šé£›æ©Ÿä¸‹åˆå››é»å¾Œä¸é£›ï¼Œå®‰æ’èˆªç­éœ€æ³¨æ„ã€‚", cat: "transport" },
      { text: "å‰éš†å¡éé¦¬è·¯è¦å°å¿ƒï¼Œæ‘©æ‰˜è»Šæœ‰æ™‚æœƒé¨ä¸Šäººè¡Œé“ã€‚", cat: "life" },
      { text: "é¦¬çˆ¾åœ°å¤«çŠç‘šè„†å¼±ï¼Œæ½›æ°´æ™‚è«‹å‹¿è§¸æ‘¸æˆ–è¸©è¸ã€‚", cat: "culture" },
      { text: "é»‘é¢¨æ´éšæ¢¯æœ‰272éšï¼Œä¸”é‡ç”ŸçŒ´å­å¤šï¼Œè«‹å‹¿é¤µé£Ÿã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«ç¾é‡‘æ–°éˆ”è¦æ±‚åš´æ ¼ï¼Œç ´ææˆ–æ‘ºç—•å¸¸è¢«æ‹’æ”¶ã€‚", cat: "money" },
      { text: "å‰éš†å¡ä¸­å¤®è»Šç«™KL Sentralæ˜¯äº¤é€šæ¨ç´ï¼Œè½‰ä¹˜æ–¹ä¾¿ã€‚", cat: "transport" },
      { text: "é¦¬çˆ¾åœ°å¤«å±…æ°‘å³¶ç©¿è‘—éœ€ä¿å®ˆï¼Œæ¯”åŸºå°¼åƒ…é™æ¯”åŸºå°¼æ²™ç˜ã€‚", cat: "culture" },
      { text: "äºç¾…è¡—Jalan Aloræ˜¯å®µå¤œå¥½å»è™•ï¼Œæ²™å—²é›ç¿…å¿…é»ã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«å‡ºæµ·çœ‹æµ·è±šæ©Ÿç‡é«˜ï¼Œä½†ä»å±¬è‡ªç„¶ç”Ÿæ…‹ä¸ä¿è­‰ã€‚", cat: "culture" },
      { text: "å‰éš†å¡æ­¦å‰å…ç™»å€ç™¾è²¨æ—ç«‹ï¼ŒPavilioné©åˆé€›è¡—ã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«éƒ¨åˆ†å±…æ°‘å³¶æœ‰èšŠèŸ²ï¼Œå»ºè­°æ”œå¸¶é˜²èšŠæ¶²ã€‚", cat: "life" },
      { text: "å‰éš†å¡èŒ¨å» è¡—æ˜¯å”äººè¡—ï¼Œè²·æ±è¥¿è¨˜å¾—è¦æ®ºåƒ¹ã€‚", cat: "money" },
      { text: "é¦¬çˆ¾åœ°å¤«æ¸¡å‡æ‘æ¶ˆè²»é«˜ï¼Œå…¨åŒ…å¼æ–¹æ¡ˆè¼ƒçœå¿ƒã€‚", cat: "money" },
      { text: "é¦¬ä¾†è¥¿äºäººç¿’æ…£ç”¨å³æ‰‹åƒé£¯èˆ‡æ¡æ‰‹ï¼Œå·¦æ‰‹è¦–ç‚ºä¸æ½”ã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«æ’åº§è‹¥ç„¡é–‹é—œï¼Œéœ€ç•™æ„æ˜¯å¦é€šé›»ã€‚", cat: "life" },
      { text: "å‰éš†å¡æ©Ÿå ´KLIAèˆ‡KLIA2èˆªå»ˆä¸åŒï¼Œè½‰æ©Ÿéœ€æ­å¿«éµã€‚", cat: "transport" },
      { text: "é¦¬çˆ¾åœ°å¤«æµ·é¾œä¿è‚²åš´æ ¼ï¼Œè§¸æ‘¸æµ·é¾œæ˜¯é•æ³•è¡Œç‚ºã€‚", cat: "culture" },
      { text: "å‰éš†å¡åœ°éµMRTå†·æ°£æ¥µå¼·ï¼Œæ­ä¹˜æ™‚å»ºè­°å‚™è–„å¤–å¥—ã€‚", cat: "life" },
      { text: "é¦¬çˆ¾åœ°å¤«æ²™æ´²é‡é¤æ˜¯ç†±é–€è¡Œç¨‹ï¼Œè¨˜å¾—å¸¶å¢¨é¡é˜²çœ©å…‰ã€‚", cat: "life" },
      { text: "é¦¬ä¾†è¥¿äºå¤šå…ƒç¨®æ—ï¼Œå¸¸è¦‹é¦¬ä¾†èªã€è‹±èªã€è¯èªäº¤é›œã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«æµ®æ½›ä¸‰å¯¶å»ºè­°è‡ªå‚™ï¼Œè¡›ç”Ÿåˆåˆè‡‰å‹ã€‚", cat: "life" },
      { text: "å‰éš†å¡ç²‰ç´…æ¸…çœŸå¯ºåœ¨å¸ƒåŸï¼Œè·é›¢å¸‚å€ç´„30åˆ†é˜è»Šç¨‹ã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«é›¨å­£æµªå¤§ï¼Œæ˜“æšˆèˆ¹è€…å‹™å¿…æº–å‚™æšˆèˆ¹è—¥ã€‚", cat: "life" },
      { text: "å‰éš†å¡ä¸»è¦ä½¿ç”¨Touch 'n Goå¡ï¼Œé¡ä¼¼å°ç£æ‚ éŠå¡ã€‚", cat: "transport" },
      { text: "é¦¬çˆ¾åœ°å¤«ä¸å¯å¸¶èµ°è²æ®¼æˆ–æ²™å­ï¼Œå‡ºå¢ƒæœƒè¢«æµ·é—œæŸ¥æ‰£ã€‚", cat: "culture" },
      { text: "å‰éš†å¡èˆŠè¡—å ´ç™½å’–å•¡æ˜¯ç¶“å…¸ä¼´æ‰‹ç¦®ï¼Œè¶…å¸‚è²·è¼ƒä¾¿å®œã€‚", cat: "money" },
      { text: "é¦¬çˆ¾åœ°å¤«å±…æ°‘å³¶é€±äº”å•†åº—å¯èƒ½é…åˆç¥ˆç¦±æ™‚é–“æš«åœç‡Ÿæ¥­ã€‚", cat: "life" },
      { text: "é¦¬ä¾†è¥¿äºèŒ¶å®¤é»é£²æ–™èªªã€Œé›ªèŒ¶ã€æŒ‡çš„æ˜¯å†°èŒ¶ï¼ˆç„¡ç³–ï¼‰ã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«å¤œé‡£è¡Œç¨‹è‹¥é‡£åˆ°é­šï¼Œé¤å»³é€šå¸¸å¯å¹«å¿™æ–™ç†ã€‚", cat: "culture" },
      { text: "å‰éš†å¡KLCCå…¬åœ’æ™šä¸Šæœ‰éŸ³æ¨‚å™´æ³‰ç§€ï¼Œå…è²»æ¬£è³ã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«æ¸¡å‡æ‘é€šå¸¸æä¾›é£²ç”¨æ°´ï¼Œä¸éœ€å¾æœ¬å³¶æ‰›æ°´ã€‚", cat: "life" },
      { text: "é¦¬ä¾†è¥¿äºå°åº¦ç…é¤…Roti Canaiæ˜¯æ—©é¤ç†±é–€é¸æ“‡ã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«å¤ªé™½è¼»å°„å¼·ï¼Œæµ®æ½›å‹™å¿…ç©¿æ°´æ¯è¡£é˜²æ›¬å‚·ã€‚", cat: "life" },
      { text: "å‰éš†å¡Grabå°–å³°æ™‚æ®µæ˜“å¡è»Šï¼Œè¶•é£›æ©Ÿè«‹é ç•™æ™‚é–“ã€‚", cat: "transport" },
      { text: "é¦¬çˆ¾åœ°å¤«é£¯åº—ä¸æä¾›ç‰™åˆ·ç‰™è†ï¼Œéœ€è‡ªå‚™ç›¥æ´—ç”¨å…·ã€‚", cat: "life" },
      { text: "é¦¬ä¾†è¥¿äºå»æ‰€å¤šæœ‰æ´—å±è‚¡ç®¡ç·šï¼Œåœ°æ¿å¸¸æ˜¯æ¿•çš„ã€‚", cat: "life" },
      { text: "é¦¬çˆ¾åœ°å¤«æ©Ÿå ´å³¶Hulhumaleæœ‰å…¬è»Šé€šå¾€æ©Ÿå ´ï¼Œä¾¿å®œä¾¿åˆ©ã€‚", cat: "transport" },
      { text: "å‰éš†å¡ç¨ç«‹å»£å ´å‘¨é‚Šæœ‰è¨±å¤šæ®–æ°‘é¢¨æ ¼å»ºç¯‰ï¼Œé©åˆæ‹ç…§ã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«é¯¨é¯Šå‡ºæ²’é»å¤šåœ¨å—é˜¿é‡Œç’°ç¤ï¼Œå¯åƒåŠ ä¸€æ—¥éŠã€‚", cat: "culture" },
      { text: "é¦¬ä¾†è¥¿äºæ¦´æ§¤å­£ç¯€ç´„åœ¨6-8æœˆï¼Œè²“å±±ç‹æœ€å—æ­¡è¿ã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«å°è²»ä¸å¯çµ¦ç¡¬å¹£ï¼Œç•¶åœ°äººç„¡æ³•å…Œæ›ã€‚", cat: "money" },
      { text: "å‰éš†å¡NU Sentralç™¾è²¨èˆ‡ä¸­å¤®è»Šç«™å…±æ§‹ï¼Œé€›è¡—æ–¹ä¾¿ã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«ç„¡äººæ©Ÿç©ºæ‹éœ€äº‹å…ˆå‘æ¸¡å‡æ‘ç”³è«‹è¨±å¯ã€‚", cat: "culture" },
      { text: "é¦¬ä¾†è¥¿äºKayaå’–æ¤°é†¬é…åå¸æ˜¯é“åœ°å—æ´‹é¢¨å‘³ã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«å±…æ°‘å³¶é¤å»³ä¸Šèœé€Ÿåº¦æ…¢ï¼Œè¦æœ‰å¿ƒç†æº–å‚™ã€‚", cat: "life" },
      { text: "å‰éš†å¡å¡”KL Toweræ™¯è§€å°è¦–é‡æ¯”é›™å­æ˜Ÿå¡”æ›´é–‹é—Šã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«æ½›æ°´éœ€å‡ºç¤ºè­‰ç…§ï¼Œé«”é©—æ½›æ°´æ·±åº¦æœ‰é™åˆ¶ã€‚", cat: "culture" },
      { text: "é¦¬ä¾†è¥¿äºéƒ¨åˆ†é¤å»³æ”¶10%æœå‹™è²»èˆ‡6%æ”¿åºœç¨…ã€‚", cat: "money" },
      { text: "é¦¬çˆ¾åœ°å¤«æ—ºå­£ç‚º11-4æœˆï¼Œæˆ¿åƒ¹è¼ƒé«˜ä½†å¤©æ°£ç©©å®šã€‚", cat: "prepare" },
      { text: "å‰éš†å¡é¬¼ä»”å··æœ‰å£ç•«èˆ‡ç‰¹è‰²å’–å•¡å»³ï¼Œæ–‡é’å¿…è¨ªã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«å±…æ°‘å³¶æ›åŒ¯åŒ¯ç‡é€šå¸¸æ¯”æ©Ÿå ´å¥½ä¸€é»ã€‚", cat: "money" },
      { text: "é¦¬ä¾†è¥¿äºäººéé¦¬è·¯æœƒèˆ‰æ‰‹ç¤ºæ„ï¼Œè»Šè¼›é€šå¸¸æœƒç¦®è®“ã€‚", cat: "transport" },
      { text: "é¦¬çˆ¾åœ°å¤«éƒ¨åˆ†æ¸¡å‡æ‘æ™‚å€æœƒå¿«é¦¬ç´¯1å°æ™‚ï¼Œäº«æ›´å¤šé™½å…‰ã€‚", cat: "prepare" },
      { text: "å‰éš†å¡Saloma Linkè¡Œäººå¤©æ©‹å¤œé–“é»ç‡ˆå¾ˆç¾ã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«å‡ºæµ·è¡Œç¨‹ç›¡é‡ç©¿é®®è±”æ³³è¡£ï¼Œæ‹ç…§æ›´å‡ºè‰²ã€‚", cat: "life" },
      { text: "é¦¬ä¾†è¥¿äºMamakæª”æ˜¯24å°æ™‚ç‡Ÿæ¥­ï¼ŒåŠå¤œä¸æ€•é¤“ã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«åº¦å‡æ‘æ°´ä¸Šå±‹å»ºè­°ä½å…©æ™šé«”é©—å³å¯ã€‚", cat: "prepare" },
      { text: "å‰éš†å¡Pavilioné–€å£çš„å¤§ç¢—å…¬å™´æ³‰æ˜¯ç†±é–€æœƒé¢é»ã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«éƒ¨åˆ†çŠç‘šç¤æœ‰å¼·æµï¼Œæµ®æ½›å‹™å¿…ç©¿æ•‘ç”Ÿè¡£ã€‚", cat: "life" },
      { text: "é¦¬ä¾†è¥¿äºè‚¯å¾·åŸºKFCæœ‰ç¨ç‰¹å£å‘³ï¼Œåƒ¹æ ¼ä¹Ÿè¦ªæ°‘ã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«å±…æ°‘å³¶é€±äº”æ¸¡è¼ªåœé§›ï¼Œéœ€æ”¹æ­å¿«è‰‡ã€‚", cat: "transport" },
      { text: "å‰éš†å¡ä¸­å¤®è—è¡“åŠCentral Marketå¯è²·æ‰‹å·¥è—å“ã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«å¿…è²·é®ªé­šç½é ­ï¼Œæ˜¯ç•¶åœ°ç‰¹ç”¢ä¸”ä¾¿å®œã€‚", cat: "money" },
      { text: "é¦¬ä¾†è¥¿äºBataé‹å­ä¾¿å®œå¥½ç©¿ï¼Œæ˜¯åœ‹æ°‘å“ç‰Œã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«é€€æˆ¿å¾Œè‹¥æ™šç­æ©Ÿï¼Œå¯å¯„æ”¾è¡Œæé€›é¦¬ç´¯ã€‚", cat: "transport" },
      { text: "å‰éš†å¡Thean Hou Templeå¤©åå®®èåˆå¤šç¨®å»ºç¯‰é¢¨æ ¼ã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«æ¸¡å‡æ‘å…§è‡ªè²»é¤é£²æ˜‚è²´ï¼Œæ°´ä¸€ç“¶ç´„5-10ç¾é‡‘ã€‚", cat: "money" },
      { text: "é¦¬ä¾†è¥¿äºä¾¿åˆ©å•†åº—é™¤äº†7-11é‚„æœ‰KK Martèˆ‡FamilyMartã€‚", cat: "life" },
      { text: "é¦¬çˆ¾åœ°å¤«æœ‰äº›å³¶å¶¼æœ‰ç™¼å…‰æµ®æ¸¸ç”Ÿç‰©ï¼Œä¿—ç¨±è—çœ¼æ·šã€‚", cat: "culture" },
      { text: "å‰éš†å¡åº·æ¨‚å¤œå¸‚é€±ä¸‰é™å®šï¼Œå…¨é•·2å…¬é‡Œè¶…å¥½é€›ã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«å±…æ°‘å³¶è¶…å¸‚å¯è²·é›¶é£Ÿï¼Œåƒ¹æ ¼æ¯”æ¸¡å‡æ‘è¦ªæ°‘ã€‚", cat: "money" },
      { text: "é¦¬ä¾†è¥¿äºTeh Tarikæ‹‰èŒ¶ç”œåº¦é«˜ï¼Œæ€•ç”œå¯å–Šå°‘ç³–ã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«æ­ä¹˜å¿«è‰‡å®¹æ˜“é¡›ç°¸ï¼Œç›¡é‡åèˆ¹å°¾è¼ƒç©©ã€‚", cat: "transport" },
      { text: "å‰éš†å¡åŸä¸­åŸå…¬åœ’KLCC Parkæœ‰å…’ç«¥æˆ²æ°´å€ã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«éƒ¨åˆ†æ¸¡å‡æ‘ç¦æ­¢æ”œå¸¶ç©ºæ‹æ©Ÿï¼Œè«‹å…ˆç¢ºèªã€‚", cat: "culture" },
      { text: "é¦¬ä¾†è¥¿äºè·¯é‚Šæ”¤è¡›ç”Ÿä¸ä¸€ï¼Œè…¸èƒƒæ•æ„Ÿè€…è«‹æ…é¸ã€‚", cat: "life" },
      { text: "é¦¬çˆ¾åœ°å¤«æ·¡å­£5-10æœˆæˆ¿åƒ¹ä¾¿å®œï¼Œä½†é‡åˆ°ä¸‹é›¨æ©Ÿç‡é«˜ã€‚", cat: "prepare" },
      { text: "å‰éš†å¡æŒ‰æ‘©CPå€¼é«˜ï¼Œæ­¦å‰å…ç™»å€æœ‰å¾ˆå¤šé¸æ“‡ã€‚", cat: "life" },
      { text: "é¦¬çˆ¾åœ°å¤«æ²™ç˜å±‹é€šå¸¸é›¢æµ·è¿‘ï¼Œé©åˆæœ‰å°å­©å®¶åº­ã€‚", cat: "prepare" },
      { text: "é¦¬ä¾†è¥¿äºéå¹´æœŸé–“å‰éš†å¡åƒç©ºåŸï¼Œå¾ˆå¤šåº—ä¼‘ã€‚", cat: "life" },
      { text: "é¦¬çˆ¾åœ°å¤«ç•¶åœ°è¶…å¸‚é€±äº”ä¸­åˆ11-14é»é€šå¸¸ä¼‘æ¯ç¥ˆç¦±ã€‚", cat: "life" },
      { text: "å‰éš†å¡åˆ°é¦¬å…­ç”²è»Šç¨‹ç´„2å°æ™‚ï¼Œé©åˆå®‰æ’ä¸€æ—¥éŠã€‚", cat: "transport" },
      { text: "é¦¬çˆ¾åœ°å¤«åº¦å‡æ‘æˆ¿å…§æ’é ­å¤šæ˜¯è¬ç”¨å­”ï¼Œå…è½‰æ¥é ­ã€‚", cat: "life" },
      { text: "é¦¬ä¾†è¥¿äºé›²é ‚é«˜åŸæ˜¯é¿æš‘å‹åœ°ï¼Œæœ‰è³­å ´èˆ‡æ¨‚åœ’ã€‚", cat: "culture" },
      { text: "é¦¬çˆ¾åœ°å¤«è‹¥ä½å±…æ°‘å³¶ï¼Œè¨˜å¾—å°Šé‡ç•¶åœ°ä¼Šæ–¯è˜­ç¿’ä¿—ã€‚", cat: "culture" }
    ];

    function TravelTipsWidget() {
      const [visible, setVisible] = useState(false);
      const [query, setQuery] = useState('');
      const [tipIdx, setTipIdx] = useState(0);
      const [selectedCat, setSelectedCat] = useState(null);

      // Auto rotate tips when minimized
      useEffect(() => {
        if (visible) return;
        const interval = setInterval(() => {
          setTipIdx(prev => (prev + 1) % RAW_TRAVEL_TIPS.length);
        }, 8000);
        return () => clearInterval(interval);
      }, [visible]);

      // Smart Search Logic
      const keywordMap = {
        'éŒ¢': ['åŒ¯ç‡', 'ç¾é‡‘', 'é¦¬å¹£', 'å°è²»', 'åˆ·å¡', 'ç¾é‡‘', 'èŠ±è²»'],
        'äº¤é€š': ['Grab', 'è¨ˆç¨‹è»Š', 'æ·é‹', 'åœ°éµ', 'æ©Ÿå ´', 'é£›æ©Ÿ', 'èˆ¹'],
        'åƒ': ['ç¾é£Ÿ', 'é¤å»³', 'è‚‰éª¨èŒ¶', 'æ¦´æ§¤', 'å£å‘³', 'æ—©é¤'],
        'å¤©æ°£': ['é›¨å­£', 'æ°£æº«', 'ç†±', 'é›·é›¨'],
        'é›»': ['æ’åº§', 'é›»å£“', 'å……é›»'],
        'ç¶²': ['WiFi', 'SIM', 'ç¶²å¡']
      };

      const filteredTips = useMemo(() => {
        let results = RAW_TRAVEL_TIPS;
        
        // 1. Category Filter
        if (selectedCat) {
          results = results.filter(t => t.cat === selectedCat);
        }

        // 2. Keyword Search (Broad Match)
        if (query.trim()) {
          const q = query.trim().toLowerCase();
          
          // Expand search terms
          let searchTerms = [q];
          Object.entries(keywordMap).forEach(([key, values]) => {
            if (q.includes(key)) searchTerms = [...searchTerms, ...values];
          });

          results = results.filter(t => 
             searchTerms.some(term => t.text.toLowerCase().includes(term))
          );
        }

        return results;
      }, [query, selectedCat]);

      return (
        <div className="fixed bottom-28 right-4 z-50 flex flex-col items-end pointer-events-none">
          {/* Main Content Area */}
          <div className={`bg-white/95 backdrop-blur-md border border-[#D8C4B6] p-4 rounded-2xl rounded-br-none shadow-xl mb-3 w-72 pointer-events-auto transition-all duration-300 origin-bottom-right ${visible ? 'scale-100 opacity-100' : 'scale-95 opacity-0 pointer-events-none absolute'}`}>
            
            {/* Header & Search */}
            <div className="space-y-3">
              <div className="flex justify-between items-center pb-2 border-b border-[#F5EBE0]">
                <h3 className="text-xs font-black text-[#A68A71] uppercase tracking-widest">Travel Tips æ—…éŠå°å¹«æ‰‹</h3>
                <button onClick={() => setVisible(false)}><X size={16} className="text-[#A68A71]" /></button>
              </div>
              
              <div className="flex items-center gap-2 bg-[#FDFBF7] rounded-xl px-3 py-2 border border-[#F5EBE0]">
                <Search size={14} className="text-[#A68A71]" />
                <input 
                  type="text" 
                  value={query}
                  onChange={(e) => setQuery(e.target.value)}
                  placeholder="æœå°‹éŒ¢ã€äº¤é€šã€å¤©æ°£..."
                  className="text-xs w-full outline-none bg-transparent text-[#4E342E] placeholder:text-[#D8C4B6]"
                />
                {query && <button onClick={() => setQuery('')}><X size={12} className="text-[#A68A71]" /></button>}
              </div>

              {/* Categories */}
              <div className="flex gap-2 overflow-x-auto no-scrollbar pb-1">
                <button 
                  onClick={() => setSelectedCat(null)}
                  className={`flex-shrink-0 px-3 py-1.5 rounded-full text-[10px] font-bold transition-all ${!selectedCat ? 'bg-[#4E342E] text-white' : 'bg-[#FDFBF7] text-[#A68A71] border border-[#F5EBE0]'}`}
                >
                  å…¨éƒ¨
                </button>
                {TRAVEL_TIPS_CATEGORIES.map(cat => (
                  <button 
                    key={cat.id}
                    onClick={() => setSelectedCat(selectedCat === cat.id ? null : cat.id)}
                    className={`flex-shrink-0 px-3 py-1.5 rounded-full text-[10px] font-bold transition-all flex items-center gap-1 ${selectedCat === cat.id ? 'bg-[#D8C4B6] text-white' : 'bg-[#FDFBF7] text-[#A68A71] border border-[#F5EBE0]'}`}
                  >
                    <cat.icon size={10} /> {cat.name}
                  </button>
                ))}
              </div>

              {/* Results */}
              <div className="min-h-[100px] max-h-60 overflow-y-auto no-scrollbar space-y-2 pr-1">
                {filteredTips.length > 0 ? (
                  filteredTips.map((tip, i) => (
                    <div key={i} className="flex gap-3 py-2 border-b border-[#F5EBE0] last:border-0 group">
                      <div className="mt-0.5 text-[#D8C4B6]"><Tag size={12} /></div>
                      <p className="text-xs text-[#4E342E] leading-relaxed">{tip.text}</p>
                    </div>
                  ))
                ) : (
                  <div className="text-center py-6 text-[#A68A71] text-xs">
                    <p>æ‰¾ä¸åˆ°ç›¸é—œè³‡è¨Š ğŸ¢</p>
                    <p className="text-[9px] mt-1 opacity-60">è©¦è©¦ã€ŒéŒ¢ã€æˆ–ã€Œäº¤é€šã€ç­‰é—œéµå­—</p>
                  </div>
                )}
              </div>
            </div>
          </div>

          {/* Minimized Bubble (Auto Rotate) */}
          {!visible && (
             <div className="bg-white/90 backdrop-blur-md border border-[#D8C4B6] px-4 py-2 rounded-2xl rounded-br-none shadow-md mb-2 max-w-[200px] transition-all duration-500 animate-in fade-in slide-in-from-bottom-2">
                <p className="text-[10px] font-bold text-[#4E342E] line-clamp-2 leading-relaxed">
                  {RAW_TRAVEL_TIPS[tipIdx].text}
                </p>
             </div>
          )}

          {/* Toggle Button */}
          <button 
            onClick={() => setVisible(!visible)}
            className={`w-12 h-12 rounded-full shadow-xl flex items-center justify-center text-white pointer-events-auto hover:scale-110 active:scale-95 transition-all border-4 border-[#FDFBF7] ${visible ? 'bg-[#D8C4B6]' : 'bg-[#4E342E]'}`}
          >
            {visible ? <X size={24} /> : <Lightbulb size={24} />}
          </button>
        </div>
      );
    }

    function PreparationView({ prepList, setPrepList }) {
      const categories = ['é‡è¦æ–‡ä»¶', 'é›»å­é›»å™¨', 'è¡£ç‰©ç©¿æ­', 'å€‹äººç”¨å“', 'å¸¸å‚™è—¥å“'];
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [newItem, setNewItem] = useState({ item: '', category: 'é‡è¦æ–‡ä»¶', note: '' });
      const [editingId, setEditingId] = useState(null);

      const handleSaveItem = () => {
        if (!newItem.item.trim()) return;
        if (editingId) {
          setPrepList(prepList.map(p => p.id === editingId ? { ...p, ...newItem } : p));
        } else {
          setPrepList([...prepList, { ...newItem, id: 'custom-' + Date.now(), checked: false }]);
        }
        setIsModalOpen(false);
        setNewItem({ item: '', category: 'é‡è¦æ–‡ä»¶', note: '' });
        setEditingId(null);
      };

      const handleEdit = (item) => {
        setNewItem({ item: item.item, category: item.category, note: item.note });
        setEditingId(item.id);
        setIsModalOpen(true);
      };

      const handleDelete = (id) => {
        if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤é …ç›®å—ï¼Ÿ')) {
          setPrepList(prepList.filter(p => p.id !== id));
        }
      };

      return (
        <div className="fade-in space-y-6">
          <div className="flex justify-between items-center px-2">
            <h2 className="text-3xl font-bold serif text-[#4E342E]">æº–å‚™æ¸…å–®</h2>
            <button onClick={() => { setEditingId(null); setNewItem({ item: '', category: 'é‡è¦æ–‡ä»¶', note: '' }); setIsModalOpen(true); }} className="w-10 h-10 bg-[#4E342E] text-white rounded-xl flex items-center justify-center shadow-lg active:scale-95 transition-all"><Plus size={20} /></button>
          </div>
          <div className="space-y-8 pb-10">
            {categories.map(cat => (
              <div key={cat} className="space-y-3">
                <h3 className="text-[10px] font-black text-[#A68A71] uppercase tracking-[0.2em] px-2">{cat}</h3>
                <div className="grid gap-2">
                  {prepList.filter(p => p.category === cat).map(p => (
                    <div key={p.id} className="bg-white p-4 rounded-2xl border border-[#F5EBE0] flex items-center gap-4 shadow-sm hover:border-[#D8C4B6] transition-all group">
                      <div className={`checkbox-custom flex-shrink-0 ${p.checked ? 'checked' : ''}`} onClick={() => setPrepList(prepList.map(item => item.id === p.id ? {...item, checked: !item.checked} : item))} />
                      <div className={`flex-1 ${p.checked ? 'opacity-40' : ''}`}>
                        <div className={`font-bold text-sm ${p.checked ? 'line-through' : ''} flex items-center gap-2`}>
                          {p.item}
                          {p.link && (
                            <a href={p.link} target="_blank" rel="noopener noreferrer" className="text-[#A68A71] hover:text-[#4E342E]" onClick={(e) => e.stopPropagation()}>
                              <Paperclip size={14} />
                            </a>
                          )}
                        </div>
                        <div className="text-[10px] text-[#A68A71] italic">{p.note}</div>
                      </div>
                      <div className="flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                        <button onClick={(e) => { e.stopPropagation(); handleEdit(p); }} className="text-[#A68A71] hover:text-[#4E342E]"><Edit2 size={16} /></button>
                        <button onClick={(e) => { e.stopPropagation(); handleDelete(p.id); }} className="text-[#A68A71] hover:text-red-500"><Trash2 size={16} /></button>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            ))}
          </div>
          {isModalOpen && (
            <div className="modal-overlay" onClick={() => setIsModalOpen(false)}>
              <div className="bg-white w-full max-w-sm rounded-[2.5rem] p-8 space-y-4 shadow-2xl" onClick={e => e.stopPropagation()}>
                <h3 className="text-xl font-bold serif text-[#4E342E]">{editingId ? 'ç·¨è¼¯æº–å‚™é …ç›®' : 'æ–°å¢æº–å‚™é …ç›®'}</h3>
                <div className="space-y-3">
                  <div>
                    <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">é …ç›®åç¨±</label>
                    <input type="text" value={newItem.item} onChange={e => setNewItem({...newItem, item: e.target.value})} placeholder="ä¾‹å¦‚ï¼šç›¸æ©Ÿé›»æ± " />
                  </div>
                  <div>
                    <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">åˆ†é¡</label>
                    <select value={newItem.category} onChange={e => setNewItem({...newItem, category: e.target.value})}>{categories.map(c => <option key={c} value={c}>{c}</option>)}</select>
                  </div>
                  <div>
                    <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">å‚™è¨»</label>
                    <input type="text" value={newItem.note} onChange={e => setNewItem({...newItem, note: e.target.value})} placeholder="é¸å¡«å‚™è¨»" />
                  </div>
                </div>
                <div className="flex gap-3 pt-4">
                  <button onClick={() => setIsModalOpen(false)} className="flex-1 py-3 font-bold text-[#A68A71] rounded-2xl border border-[#F5EBE0]">å–æ¶ˆ</button>
                  <button onClick={handleSaveItem} className="flex-1 py-3 font-bold bg-[#D8C4B6] text-white rounded-2xl shadow-md">{editingId ? 'æ›´æ–°é …ç›®' : 'å„²å­˜é …ç›®'}</button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    function ItineraryView({ itinerary, setItinerary }) {
      const [dayIdx, setDayIdx] = useState(0);
      const [searchTerm, setSearchTerm] = useState('');
      const [showSearch, setShowSearch] = useState(false);
      const [isRefreshing, setIsRefreshing] = useState(false);
      const [showOthers, setShowOthers] = useState(false);
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [newAct, setNewAct] = useState({ time: '09:00', title: '', loc: '', note: '' });
      const [editingActId, setEditingActId] = useState(null);
      const day = itinerary[dayIdx];

      const timeOptions = useMemo(() => {
        const options = [];
        for (let h = 0; h < 24; h++) {
          for (let m = 0; m < 60; m += 30) {
            options.push(`${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`);
          }
        }
        return options;
      }, []);

      const handleSaveActivity = () => {
        if (!newAct.title.trim()) return;
        const updatedItinerary = [...itinerary];
        if (editingActId) {
          updatedItinerary[dayIdx].activities = updatedItinerary[dayIdx].activities.map(a => a.id === editingActId ? { ...a, ...newAct } : a);
        } else {
          updatedItinerary[dayIdx].activities.push({ ...newAct, id: 'act-' + Date.now() });
        }
        updatedItinerary[dayIdx].activities.sort((a, b) => a.time.localeCompare(b.time));
        setItinerary(updatedItinerary);
        setIsModalOpen(false);
        setNewAct({ time: '09:00', title: '', loc: '', note: '' });
        setEditingActId(null);
      };

      const handleEditActivity = (act) => {
        setNewAct({ time: act.time, title: act.title, loc: act.loc, note: act.note });
        setEditingActId(act.id);
        setIsModalOpen(true);
      };

      const handleDeleteActivity = (id) => {
        if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤è¡Œç¨‹å—ï¼Ÿ')) {
          const updatedItinerary = [...itinerary];
          updatedItinerary[dayIdx].activities = updatedItinerary[dayIdx].activities.filter(a => a.id !== id);
          setItinerary(updatedItinerary);
        }
      };

      const handleDeleteCurrent = () => {
         if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤è¡Œç¨‹å—ï¼Ÿ')) {
          const updatedItinerary = [...itinerary];
          updatedItinerary[dayIdx].activities = updatedItinerary[dayIdx].activities.filter(a => a.id !== editingActId);
          setItinerary(updatedItinerary);
          setIsModalOpen(false);
          setEditingActId(null);
        }
      };

      const handleRefresh = () => {
        setIsRefreshing(true);
        setShowOthers(true); 
        setTimeout(() => setIsRefreshing(false), 800);
      };

      const displayGroups = useMemo(() => {
        const groupsToProcess = (showOthers || searchTerm) ? RESORT_ACTIVITY_GROUPS : [RESORT_ACTIVITY_GROUPS[0]];
        return groupsToProcess.map(group => {
          let items = group.items;
          if (searchTerm) {
            items = items.filter(item => item.name.toLowerCase().includes(searchTerm.toLowerCase()) || item.detail.toLowerCase().includes(searchTerm.toLowerCase()));
          } else {
            items = items.slice(0, 6);
          }
          return { ...group, items };
        }).filter(group => group.items.length > 0);
      }, [searchTerm, showOthers]);

      return (
        <div className="fade-in space-y-6">
          <div className="flex overflow-x-auto gap-3 pb-2 no-scrollbar snap-x">
            {itinerary.map((d, i) => (
              <button key={i} onClick={() => setDayIdx(i)} className={`flex-shrink-0 w-12 h-16 rounded-2xl flex flex-col items-center justify-center border transition-all ${dayIdx === i ? 'bg-[#4E342E] text-white shadow-lg' : 'bg-white text-[#A68A71] border-[#F5EBE0]'}`}>
                <span className="text-[8px] font-black uppercase opacity-60">{d.date.includes('/') ? 'Jan' : 'Feb'}</span><span className="text-lg font-black mt-1">{d.date.includes('/') ? d.date.split('/')[1] : d.date.split('.')[1]}</span>
              </button>
            ))}
          </div>
          <div className="bg-white p-7 rounded-[2.5rem] border border-[#F5EBE0] shadow-sm mb-6 relative">
            <div className="flex justify-between items-start mb-6">
              <h2 className="text-2xl font-bold text-[#4E342E] serif leading-tight">Day 0{dayIdx+1} {day.title}</h2>
              <button onClick={() => { setEditingActId(null); setNewAct({ time: '09:00', title: '', loc: '', note: '' }); setIsModalOpen(true); }} className="w-9 h-9 bg-[#FDFBF7] border border-[#F5EBE0] text-[#A68A71] rounded-xl flex items-center justify-center active:scale-95 transition-all shadow-sm"><Plus size={18} /></button>
            </div>
            <div className="space-y-8 relative ml-1">
              <div className="absolute left-[17px] top-3 bottom-3 w-[1px] bg-[#F5EBE0]" />
              {day.activities.map(act => (
                <div key={act.id} className="flex gap-5 relative z-10 group">
                  <div className="w-9 h-9 rounded-xl border-2 border-[#F5EBE0] bg-white flex items-center justify-center text-[#4E342E] shrink-0"><Clock size={16} /></div>
                  <div className="flex-1 cursor-pointer" onClick={() => window.open(getGoogleMapsUrl(act.loc || act.title), '_blank')}>
                    <span className="text-[10px] font-black text-[#D8C4B6]">{act.time}</span>
                    <h4 className="font-bold text-base text-[#4E342E]">{act.title}</h4>
                    {act.loc && <div className="text-[10px] text-[#A68A71] flex items-center gap-1 mt-1 font-bold"><MapPin size={10} /> {act.loc}</div>}
                    {act.note && <p className="text-[10px] text-[#A68A71] italic mt-1">{act.note}</p>}
                  </div>
                  <div className="flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition-opacity justify-center">
                    <button onClick={(e) => { e.stopPropagation(); handleEditActivity(act); }} className="text-[#A68A71] hover:text-[#4E342E]"><Edit2 size={16} /></button>
                    <button onClick={(e) => { e.stopPropagation(); handleDeleteActivity(act.id); }} className="text-[#A68A71] hover:text-red-500"><Trash2 size={16} /></button>
                  </div>
                </div>
              ))}
            </div>
          </div>
          {day.isMaldives && (
            <div className="bg-[#4E342E] p-8 rounded-[2.5rem] text-white shadow-xl mb-6 fade-in">
              <div className="flex justify-between items-center mb-6">
                <h3 className="text-xl font-bold serif flex items-center gap-3"><Waves className="text-[#D8C4B6]" /> è‡ªè²»è¡¨ (Activity Pricing)</h3>
                <div className="flex gap-2">
                  <button onClick={() => setShowSearch(!showSearch)} className="w-9 h-9 bg-white/10 rounded-xl flex items-center justify-center text-[#D8C4B6] hover:bg-white/20 transition-all"><Search size={18} /></button>
                  <button onClick={handleRefresh} className={`w-9 h-9 bg-white/10 rounded-xl flex items-center justify-center text-[#D8C4B6] hover:bg-white/20 transition-all ${isRefreshing ? 'animate-spin' : ''}`}><RefreshCw size={18} /></button>
                </div>
              </div>
              {showSearch && <div className="mb-6 fade-in"><input type="text" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} placeholder="æœå°‹æ½›æ°´ã€èª²ç¨‹ã€æ°´ä¸Šæ´»å‹•..." className="w-full bg-white/10 border-white/10 text-white placeholder:text-white/30 focus:border-[#D8C4B6] focus:bg-white/20" autoFocus /></div>}
              <div className="space-y-10">
                {displayGroups.map((group) => (
                  <div key={group.id} className="space-y-4">
                    <h4 className="text-[10px] font-black text-[#D8C4B6] uppercase tracking-[0.2em] opacity-60 px-1">{group.category}</h4>
                    <div className="grid gap-4">
                      {group.items.map((item, i) => (
                        <div key={i} className="bg-white/5 p-4 rounded-2xl flex justify-between items-center border border-white/5 hover:border-white/20 transition-all">
                          <div className="flex-1 pr-4"><h4 className="font-bold text-sm text-[#D8C4B6]">{item.name}</h4><p className="text-[9px] text-white/40 mt-0.5">{item.detail}</p></div>
                          <div className="text-right">{item.price > 0 ? <><div className="text-lg font-black text-white">${item.price}</div><div className="text-[9px] font-black text-[#D8C4B6]">â‰ˆ NT$ {Math.round(item.price * USD_TO_TWD).toLocaleString()}</div></> : <div className="text-lg font-black text-white">FREE</div>}</div>
                        </div>
                      ))}
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}
          {isModalOpen && (
            <div className="modal-overlay" onClick={() => setIsModalOpen(false)}>
              <div className="bg-white w-full max-w-sm rounded-[2.5rem] p-8 space-y-4 shadow-2xl" onClick={e => e.stopPropagation()}>
                <h3 className="text-xl font-bold serif text-[#4E342E]">{editingActId ? 'ç·¨è¼¯ç•¶æ—¥è¡Œç¨‹' : 'æ–°å¢ç•¶æ—¥è¡Œç¨‹'}</h3>
                <div className="space-y-3">
                  <div><label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">æ™‚é–“</label><select value={newAct.time} onChange={e => setNewAct({...newAct, time: e.target.value})}>{timeOptions.map(t => <option key={t} value={t}>{t}</option>)}</select></div>
                  <div><label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">æ¨™é¡Œ</label><input type="text" value={newAct.title} onChange={e => setNewAct({...newAct, title: e.target.value})} placeholder="ä¾‹å¦‚ï¼šæ™¯é»åƒè§€" /></div>
                  <div><label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">åœ°é»</label><input type="text" value={newAct.loc} onChange={e => setNewAct({...newAct, loc: e.target.value})} placeholder="ä¾‹å¦‚ï¼šé›™å­å¡”" /></div>
                  <div><label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">å‚™è¨»</label><input type="text" value={newAct.note} onChange={e => setNewAct({...newAct, note: e.target.value})} placeholder="é¸å¡«å‚™è¨»" /></div>
                </div>
                <div className="space-y-3 pt-2">
                  <div className="flex gap-3">
                    <button onClick={() => setIsModalOpen(false)} className="flex-1 py-3 font-bold text-[#A68A71] rounded-2xl border border-[#F5EBE0]">å–æ¶ˆ</button>
                    <button onClick={handleSaveActivity} className="flex-1 py-3 font-bold bg-[#D8C4B6] text-white rounded-2xl shadow-md">{editingActId ? 'æ›´æ–°è¡Œç¨‹' : 'å„²å­˜è¡Œç¨‹'}</button>
                  </div>
                  {editingActId && (
                    <button 
                      onClick={handleDeleteCurrent}
                      className="w-full py-3 font-bold text-[#ef4444] bg-red-50 rounded-2xl border border-red-100 flex items-center justify-center gap-2 active:scale-95 transition-all"
                    >
                      <Trash2 size={16} />
                      åˆªé™¤æ­¤è¡Œç¨‹
                    </button>
                  )}
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    function TransportView({ transports, setTransports }) {
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [newTransport, setNewTransport] = useState({ id: '', type: 'Plane', date: '01/23', from: '', to: '', depTime: '', arrTime: '' });
      const [editingId, setEditingId] = useState(null);

      const handleSaveTransport = () => {
        if (!newTransport.id.trim() || !newTransport.from.trim() || !newTransport.to.trim()) return;
        
        if (editingId) {
          setTransports(transports.map(t => (t.localId || t.id) === editingId ? { ...newTransport, localId: editingId } : t));
        } else {
          setTransports([...transports, { ...newTransport, localId: 'trans-' + Date.now() }]);
        }
        
        setIsModalOpen(false);
        setNewTransport({ id: '', type: 'Plane', date: '01/23', from: '', to: '', depTime: '', arrTime: '' });
        setEditingId(null);
      };

      const handleEdit = (t) => {
        setNewTransport({ 
          id: t.id, 
          type: t.type, 
          date: t.date, 
          from: t.from, 
          to: t.to, 
          depTime: t.depTime, 
          arrTime: t.arrTime 
        });
        setEditingId(t.localId || t.id);
        setIsModalOpen(true);
      };

      const handleDeleteTransport = (id) => {
        if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤äº¤é€šè¡Œç¨‹å—ï¼Ÿ')) {
          setTransports(transports.filter(t => (t.localId || t.id) !== id));
        }
      };
      
      const handleDeleteCurrent = () => {
         if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤äº¤é€šè¡Œç¨‹å—ï¼Ÿ')) {
          setTransports(transports.filter(t => (t.localId || t.id) !== editingId));
          setIsModalOpen(false);
          setEditingId(null);
        }
      };

      const getIcon = (type) => {
        switch (type) {
          case 'Train': return <Train size={18} />;
          case 'Bus': return <Bus size={18} />;
          default: return <Plane size={18} />;
        }
      };

      return (
        <div className="fade-in space-y-6">
          <div className="flex justify-between items-center px-2">
            <h2 className="text-3xl font-bold serif text-[#4E342E]">äº¤é€šè³‡è¨Š</h2>
            <button onClick={() => { setEditingId(null); setNewTransport({ id: '', type: 'Plane', date: '01/23', from: '', to: '', depTime: '', arrTime: '' }); setIsModalOpen(true); }} className="w-10 h-10 bg-[#4E342E] text-white rounded-xl flex items-center justify-center shadow-lg active:scale-95 transition-all"><Plus size={20} /></button>
          </div>

          {transports.map((t, i) => (
            <div key={t.localId || i} className="bg-white rounded-[2.5rem] border border-[#F5EBE0] p-7 flex flex-col shadow-sm cursor-pointer hover:border-[#D8C4B6] transition-all group relative" onClick={() => window.open(getGoogleMapsUrl(t.to), '_blank')}>
              <div className="absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-all">
                <button 
                  onClick={(e) => { e.stopPropagation(); handleEdit(t); }} 
                  className="p-2 text-[#A68A71] hover:text-[#4E342E] transition-all"
                >
                  <Edit2 size={18} />
                </button>
                <button 
                  onClick={(e) => { e.stopPropagation(); handleDeleteTransport(t.localId || t.id); }} 
                  className="p-2 text-[#A68A71] hover:text-red-500 transition-all"
                >
                  <Trash2 size={18} />
                </button>
              </div>
              <div className="flex justify-between items-center mb-6">
                 <div><div className="font-black text-lg text-[#4E342E]">{t.id}</div><div className="text-[10px] text-[#A68A71] font-bold uppercase tracking-widest">{t.date}</div></div>
                 <div className="w-10 h-10 bg-[#D8C4B6] rounded-xl flex items-center justify-center text-white">{getIcon(t.type)}</div>
              </div>
              <div className="flex items-center justify-between gap-2 px-2">
                <div className="flex flex-col flex-1 items-start">
                  <div className="font-bold text-base text-[#4E342E] truncate w-full">{t.from}</div>
                  <div className="text-3xl font-black text-[#4E342E] tracking-tighter mt-1">{t.depTime}</div>
                </div>
                <div className="opacity-20 shrink-0 pt-6"><ArrowRight size={24} /></div>
                <div className="flex flex-col flex-1 items-end text-right">
                  <div className="font-bold text-base text-[#4E342E] truncate w-full">{t.to}</div>
                  <div className="text-3xl font-black text-[#4E342E] tracking-tighter mt-1">{t.arrTime}</div>
                </div>
              </div>
            </div>
          ))}

          {isModalOpen && (
            <div className="modal-overlay" onClick={() => setIsModalOpen(false)}>
              <div className="bg-white w-full max-w-sm rounded-[2.5rem] p-8 space-y-4 shadow-2xl" onClick={e => e.stopPropagation()}>
                <h3 className="text-xl font-bold serif text-[#4E342E]">{editingId ? 'ç·¨è¼¯äº¤é€šè³‡è¨Š' : 'æ–°å¢äº¤é€šè³‡è¨Š'}</h3>
                <div className="space-y-3">
                  <div className="grid grid-cols-2 gap-3">
                    <div>
                      <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">è»Šæ¬¡ / ç­æ©Ÿ</label>
                      <input type="text" value={newTransport.id} onChange={e => setNewTransport({...newTransport, id: e.target.value})} placeholder="ä¾‹å¦‚ï¼šMH367" />
                    </div>
                    <div>
                      <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">é¡å‹</label>
                      <select value={newTransport.type} onChange={e => setNewTransport({...newTransport, type: e.target.value})}>
                        <option value="Plane">é£›æ©Ÿ</option>
                        <option value="Train">é«˜éµ / ç«è»Š</option>
                        <option value="Bus">å¤§çœ¾é‹è¼¸ / å·´å£«</option>
                      </select>
                    </div>
                  </div>
                  <div>
                    <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">æ—¥æœŸ</label>
                    <input type="text" value={newTransport.date} onChange={e => setNewTransport({...newTransport, date: e.target.value})} placeholder="ä¾‹å¦‚ï¼š01/23" />
                  </div>
                  <div className="grid grid-cols-2 gap-3">
                    <div>
                      <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">å‡ºç™¼æ™‚é–“</label>
                      <input type="text" value={newTransport.depTime} onChange={e => setNewTransport({...newTransport, depTime: e.target.value})} placeholder="15:10" />
                    </div>
                    <div>
                      <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">æŠµé”æ™‚é–“</label>
                      <input type="text" value={newTransport.arrTime} onChange={e => setNewTransport({...newTransport, arrTime: e.target.value})} placeholder="20:05" />
                    </div>
                  </div>
                  <div className="grid grid-cols-2 gap-3">
                    <div>
                      <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">å‡ºç™¼åœ°</label>
                      <input type="text" value={newTransport.from} onChange={e => setNewTransport({...newTransport, from: e.target.value})} placeholder="TPE" />
                    </div>
                    <div>
                      <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">ç›®çš„åœ°</label>
                      <input type="text" value={newTransport.to} onChange={e => setNewTransport({...newTransport, to: e.target.value})} placeholder="KUL" />
                    </div>
                  </div>
                </div>
                <div className="space-y-3 pt-2">
                  <div className="flex gap-3">
                    <button onClick={() => setIsModalOpen(false)} className="flex-1 py-3 font-bold text-[#A68A71] rounded-2xl border border-[#F5EBE0]">å–æ¶ˆ</button>
                    <button onClick={handleSaveTransport} className="flex-1 py-3 font-bold bg-[#D8C4B6] text-white rounded-2xl shadow-md">{editingId ? 'æ›´æ–°äº¤é€š' : 'å„²å­˜äº¤é€š'}</button>
                  </div>
                   {editingId && (
                    <button 
                      onClick={handleDeleteCurrent}
                      className="w-full py-3 font-bold text-[#ef4444] bg-red-50 rounded-2xl border border-red-100 flex items-center justify-center gap-2 active:scale-95 transition-all"
                    >
                      <Trash2 size={16} />
                      åˆªé™¤æ­¤è¡Œç¨‹
                    </button>
                  )}
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    function AccommodationView() {
      const hotels = [
        { nameZh: 'å‰éš†å¡å­Ÿæ²™å‡æ—¥é…’åº—', nameEn: 'Holiday Inn Kuala Lumpur Bangsar', date: '1/23-1/25', image: 'https://images.unsplash.com/photo-1520250497591-112f2f40a3f4?auto=format&fit=crop&q=80&w=800', note: 'æ™‚å°šå­Ÿæ²™å€ï¼Œäº¤é€šéå¸¸ä¾¿åˆ©ã€‚' },
        { nameZh: 'ç¾å±…é¦¬çˆ¾åœ°å¤«åº¦å‡æ‘', nameEn: 'Mercure Maldives Kooddoo Resort', date: '1/25-1/29', image: 'https://images.unsplash.com/photo-1514282401047-d79a71a590e8?auto=format&fit=crop&q=80&w=800', note: 'å…¨åŒ…å¼æ°´ä¸Šåˆ¥å¢…ï¼Œæ½›æ°´è€…å¤©å ‚ã€‚' },
        { nameZh: 'é¦¬çˆ¾åœ°å¤«å±…æ°‘å³¶ h78 é£¯åº—', nameEn: 'h78 Maldives', date: '1/29-1/30', image: 'https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?auto=format&fit=crop&q=80&w=800', note: 'æµ·æ¿±é¦–é¸ï¼ŒéŠœæ¥æ©Ÿå ´æ¥µåº¦ä¾¿åˆ©ã€‚' },
        { nameZh: 'Umi SplashMania æº«é¦¨æ°‘å®¿', nameEn: 'Umi SplashMania homestay', date: '1/30-1/31', image: 'https://images.unsplash.com/photo-1493809842364-78817add7ffb?auto=format&fit=crop&q=80&w=800', note: 'é„°è¿‘ SplashMania æ°´ä¸Šæ¨‚åœ’ï¼Œç’°å¢ƒæº«é¦¨èˆ’é©ï¼Œè¿”å°å‰çš„çµ•ä½³ä¼‘æ†©ç«™ã€‚' }
      ];
      return (
        <div className="fade-in space-y-8">
          <h2 className="text-3xl font-bold serif text-[#4E342E] px-2">ä½å®¿å®‰æ’</h2>
          {hotels.map((h, i) => (
            <div key={i} className="bg-white rounded-[3rem] overflow-hidden shadow-sm border border-[#F5EBE0]">
              <div className="h-48 overflow-hidden"><img src={h.image} className="w-full h-full object-cover" /></div>
              <div className="p-8">
                <div className="flex justify-between items-start mb-1">
                   <div className="flex-1 pr-4"><h3 className="text-xl font-bold text-[#4E342E] serif leading-tight">{h.nameZh}</h3><p className="text-[10px] text-[#A68A71] font-bold uppercase mt-1 opacity-60">{h.nameEn}</p></div>
                   <button onClick={() => window.open(getGoogleMapsUrl(h.nameEn), '_blank')} className="w-10 h-10 bg-[#4E342E] text-white rounded-xl flex items-center justify-center shadow-lg transition-all"><Compass size={20} /></button>
                </div>
                <div className="text-xs text-[#A68A71] flex items-center gap-2 my-4"><Calendar size={14} /> {h.date}</div>
                <p className="bg-[#FDFBF7] p-4 rounded-2xl border border-[#F5EBE0] text-xs italic text-[#4E342E] leading-relaxed">{h.note}</p>
              </div>
            </div>
          ))}
        </div>
      );
    }

    function RecommendationView() {
      const [filter, setFilter] = useState('ALL');
      const [poolIdx, setPoolIdx] = useState(0);
      const [isRefreshing, setIsRefreshing] = useState(false);

      const currentRecs = REC_POOLS[poolIdx];

      const filteredRecs = useMemo(() => {
        if (filter === 'ALL') return currentRecs;
        return currentRecs.filter(cat => cat.location === filter);
      }, [filter, poolIdx]);

      const handleUpdateRecs = () => {
        setIsRefreshing(true);
        setTimeout(() => {
          setPoolIdx((prev) => (prev + 1) % REC_POOLS.length);
          setIsRefreshing(false);
        }, 500);
      };

      return (
        <div className="fade-in space-y-8">
          <div className="space-y-4 px-2">
             <div className="flex justify-between items-center">
                <h2 className="text-3xl font-bold serif text-[#4E342E]">åœ¨åœ°æ¨è–¦</h2>
                <button onClick={handleUpdateRecs} className={`flex items-center gap-2 px-4 py-2 bg-[#D8C4B6] text-white rounded-xl shadow-md active:scale-95 transition-all ${isRefreshing ? 'opacity-80' : ''}`}>
                  <RefreshCw size={16} className={isRefreshing ? 'animate-spin' : ''} />
                  <span className="text-xs font-bold">æ›´æ›è¡Œç¨‹</span>
                </button>
             </div>
             <p className="text-xs text-[#A68A71] font-bold uppercase tracking-widest">æ™¯é»èˆ‡è¡Œç¨‹æ¨è–¦ Attractions & Plans</p>
          </div>

          <div className="bg-white/50 p-1 rounded-xl border border-[#F5EBE0] flex mx-2">
            <button onClick={() => setFilter('KL')} className={`flex-1 py-2 rounded-lg text-[10px] font-black transition-all ${filter === 'KL' ? 'bg-[#4E342E] text-white shadow-md' : 'text-[#A68A71]'}`}>å‰éš†å¡</button>
            <button onClick={() => setFilter('MV')} className={`flex-1 py-2 rounded-lg text-[10px] font-black transition-all ${filter === 'MV' ? 'bg-[#4E342E] text-white shadow-md' : 'text-[#A68A71]'}`}>å±…æ°‘å³¶</button>
            <button onClick={() => setFilter('ALL')} className={`flex-1 py-2 rounded-lg text-[10px] font-black transition-all ${filter === 'ALL' ? 'bg-[#4E342E] text-white shadow-md' : 'text-[#A68A71]'}`}>å…¨éƒ¨</button>
          </div>

          <div className="space-y-10">
            {filteredRecs.map((cat, idx) => (
              <section key={idx} className="space-y-4 fade-in">
                <h3 className="font-bold text-lg text-[#4E342E] serif flex items-center gap-2 px-2"><Utensils size={18} className="text-[#A68A71]" /> {cat.category}</h3>
                <div className="grid gap-4">
                  {cat.items.map((item, i) => (
                    <div key={i} className="bg-white p-6 rounded-[2.5rem] border border-[#F5EBE0] shadow-sm cursor-pointer hover:border-[#D8C4B6] transition-all" onClick={() => window.open(getGoogleMapsUrl(item.name), '_blank')}>
                      <h4 className="font-bold text-[#4E342E] text-base mb-2">{item.name}</h4><p className="text-xs text-[#A68A71] leading-relaxed italic">{item.desc}</p>
                    </div>
                  ))}
                </div>
              </section>
            ))}
          </div>
        </div>
      );
    }

    function ExpenseView({ expenses, setExpenses }) {
      const [convVal, setConvVal] = useState('');
      const [convMode, setConvMode] = useState('USD');
      
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [newExpense, setNewExpense] = useState({ title: '', currency: 'TWD', amount: '', date: new Date().toISOString().split('T')[0] });
      const [editingId, setEditingId] = useState(null);

      const totalTwd = expenses.reduce((sum, e) => sum + (e.twd || 0), 0);
      const rate = convMode === 'USD' ? USD_TO_TWD : MYR_TO_TWD;
      const result = Math.round((parseFloat(convVal) || 0) * rate);

      const handleSaveExpense = () => {
        if (!newExpense.title.trim()) return;
        
        let twdAmount = 0;
        const amount = parseFloat(newExpense.amount);
        if (newExpense.currency === 'USD') twdAmount = amount * USD_TO_TWD;
        else if (newExpense.currency === 'MYR') twdAmount = amount * MYR_TO_TWD;
        else twdAmount = amount; 

        const expenseData = {
            ...newExpense,
            amount: amount,
            twd: Math.round(twdAmount)
        };

        if (editingId) {
            setExpenses(expenses.map(e => e.id === editingId ? { ...expenseData, id: editingId } : e).sort((a, b) => new Date(b.date) - new Date(a.date)));
        } else {
            setExpenses([...expenses, { ...expenseData, id: 'exp-' + Date.now() }].sort((a, b) => new Date(b.date) - new Date(a.date)));
        }
        
        setIsModalOpen(false);
        setNewExpense({ title: '', currency: 'TWD', amount: '', date: new Date().toISOString().split('T')[0] });
        setEditingId(null);
      };

      const handleDeleteExpense = (id) => {
          if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤ç­†æ”¯å‡ºå—ï¼Ÿ')) {
              setExpenses(expenses.filter(e => e.id !== id));
          }
      };

      const handleEdit = (exp) => {
          setNewExpense({ title: exp.title, currency: exp.currency, amount: exp.amount, date: exp.date || new Date().toISOString().split('T')[0] });
          setEditingId(exp.id);
          setIsModalOpen(true);
      };

      return (
        <div className="fade-in space-y-6 pb-20">
          <div className="bg-white p-8 rounded-[2.5rem] border border-[#F5EBE0] shadow-sm space-y-6">
            <h3 className="font-bold text-sm text-[#4E342E] flex items-center gap-2"><DollarSign size={16} className="text-[#D8C4B6]" /> åŒ¯ç‡å¿«é€Ÿæ›ç®—</h3>
            <div className="flex bg-[#FDFBF7] p-1.5 rounded-2xl border border-[#F5EBE0] mb-2">
              <button onClick={() => setConvMode('USD')} className={`flex-1 py-2.5 rounded-xl text-xs font-black transition-all ${convMode === 'USD' ? 'bg-[#4E342E] text-white shadow-md' : 'text-[#A68A71]'}`}>ç¾é‡‘ USD</button>
              <button onClick={() => setConvMode('MYR')} className={`flex-1 py-2.5 rounded-xl text-xs font-black transition-all ${convMode === 'MYR' ? 'bg-[#4E342E] text-white shadow-md' : 'text-[#A68A71]'}`}>ä»¤å‰ MYR</button>
            </div>
            <div className="text-center space-y-3 py-4">
              <div className="text-[10px] font-black text-[#A68A71] uppercase tracking-[0.2em]">1 {convMode} : {rate} TWD</div>
              <input type="number" value={convVal} onChange={e => setConvVal(e.target.value)} placeholder={`è¼¸å…¥ ${convMode} é‡‘é¡`} className="text-center font-black text-3xl py-2 bg-transparent border-b-2 border-[#F5EBE0] focus:border-[#D8C4B6] w-full" />
              <div className="text-xl font-black text-[#4E342E] mt-4">â‰ˆ NT$ {result.toLocaleString()}</div>
            </div>
          </div>
          <div className="bg-[#4E342E] p-8 rounded-[3rem] text-white shadow-2xl flex justify-between items-center">
            <div><p className="text-[10px] font-black opacity-50 uppercase tracking-widest">ç¸½æ”¯å‡ºé ä¼°</p><h2 className="text-3xl font-black mt-1">NT$ {totalTwd.toLocaleString()}</h2></div>
            <Wallet size={40} className="opacity-10" />
          </div>
          <div className="flex justify-between items-center px-2">
            <h2 className="text-xl font-bold serif text-[#4E342E]">æ”¯å‡ºæ˜ç´°</h2>
            <button onClick={() => { setEditingId(null); setNewExpense({ title: '', currency: 'TWD', amount: '', date: new Date().toISOString().split('T')[0] }); setIsModalOpen(true); }} className="w-10 h-10 bg-[#4E342E] text-white rounded-xl flex items-center justify-center shadow-lg transition-all"><Plus size={20} /></button>
          </div>
          <div className="space-y-3">
            {expenses.map(e => (
              <div key={e.id} className="bg-white p-5 rounded-2xl border border-[#F5EBE0] flex justify-between items-center shadow-sm cursor-pointer hover:border-[#D8C4B6] transition-all group relative">
                <div className="absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-all bg-white pl-2">
                    <button onClick={(ev) => { ev.stopPropagation(); handleEdit(e); }} className="p-2 text-[#A68A71] hover:text-[#4E342E] transition-all"><Edit2 size={16} /></button>
                    <button onClick={(ev) => { ev.stopPropagation(); handleDeleteExpense(e.id); }} className="p-2 text-[#A68A71] hover:text-red-500 transition-all"><Trash2 size={16} /></button>
                </div>
                <div><div className="text-[9px] text-[#A68A71] font-bold opacity-60 mb-1">{e.date}</div><div className="font-bold text-[#4E342E] text-sm">{e.title}</div><div className="text-[10px] text-[#A68A71] font-bold uppercase">{e.currency} {e.amount}</div></div>
                <div className="text-right font-black text-[#4E342E]">NT$ {e.twd.toLocaleString()}</div>
              </div>
            ))}
          </div>

          {isModalOpen && (
            <div className="modal-overlay" onClick={() => setIsModalOpen(false)}>
              <div className="bg-white w-full max-w-sm rounded-[2.5rem] p-8 space-y-4 shadow-2xl" onClick={e => e.stopPropagation()}>
                <h3 className="text-xl font-bold serif text-[#4E342E]">{editingId ? 'ç·¨è¼¯æ”¯å‡º' : 'æ–°å¢æ”¯å‡º'}</h3>
                <div className="space-y-3">
                  <div>
                    <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">æ—¥æœŸ</label>
                    <input type="date" value={newExpense.date} onChange={e => setNewExpense({...newExpense, date: e.target.value})} />
                  </div>
                  <div>
                    <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">é …ç›®åç¨±</label>
                    <input type="text" value={newExpense.title} onChange={e => setNewExpense({...newExpense, title: e.target.value})} placeholder="ä¾‹å¦‚ï¼šæ™šé¤" />
                  </div>
                  <div className="grid grid-cols-3 gap-3">
                    <div className="col-span-1">
                      <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">å¹£åˆ¥</label>
                      <select value={newExpense.currency} onChange={e => setNewExpense({...newExpense, currency: e.target.value})}>
                        <option value="TWD">TWD</option>
                        <option value="USD">USD</option>
                        <option value="MYR">MYR</option>
                      </select>
                    </div>
                    <div className="col-span-2">
                        <label className="text-[10px] font-black text-[#A68A71] uppercase ml-2">é‡‘é¡</label>
                        <input type="number" value={newExpense.amount} onChange={e => setNewExpense({...newExpense, amount: e.target.value})} placeholder="è¼¸å…¥é‡‘é¡" />
                    </div>
                  </div>
                </div>
                <div className="flex gap-3 pt-4">
                  <button onClick={() => setIsModalOpen(false)} className="flex-1 py-3 font-bold text-[#A68A71] rounded-2xl border border-[#F5EBE0]">å–æ¶ˆ</button>
                  <button onClick={handleSaveExpense} className="flex-1 py-3 font-bold bg-[#D8C4B6] text-white rounded-2xl shadow-md">{editingId ? 'æ›´æ–°' : 'å„²å­˜'}</button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    function App() {
      const [activeTab, setActiveTab] = useState('ITINERARY');
      const [itinerary, setItinerary] = useState(() => JSON.parse(localStorage.getItem('trip_itinerary_v52')) || INITIAL_ITINERARY);
      const [prepList, setPrepList] = useState(() => JSON.parse(localStorage.getItem('trip_prep_v52')) || INITIAL_PREP);
      const [transports, setTransports] = useState(() => JSON.parse(localStorage.getItem('trip_transport_v52')) || INITIAL_TRANSPORTS);
      const [expenses, setExpenses] = useState(() => JSON.parse(localStorage.getItem('trip_expenses_v52')) || []);

      useEffect(() => localStorage.setItem('trip_itinerary_v52', JSON.stringify(itinerary)), [itinerary]);
      useEffect(() => localStorage.setItem('trip_prep_v52', JSON.stringify(prepList)), [prepList]);
      useEffect(() => localStorage.setItem('trip_transport_v52', JSON.stringify(transports)), [transports]);
      useEffect(() => localStorage.setItem('trip_expenses_v52', JSON.stringify(expenses)), [expenses]);

      const renderContent = () => {
        switch (activeTab) {
          case 'PREPARATION': return <PreparationView prepList={prepList} setPrepList={setPrepList} />;
          case 'ITINERARY': return <ItineraryView itinerary={itinerary} setItinerary={setItinerary} />;
          case 'TRANSPORT': return <TransportView transports={transports} setTransports={setTransports} />;
          case 'ACCOMMODATION': return <AccommodationView />;
          case 'RECOMMENDATION': return <RecommendationView />;
          case 'EXPENSE': return <ExpenseView expenses={expenses} setExpenses={setExpenses} />;
          default: return <ItineraryView itinerary={itinerary} setItinerary={setItinerary} />;
        }
      };

      return (
        <div className="min-h-screen flex flex-col pb-safe">
          <header className="fixed top-0 left-0 right-0 z-40 glass-effect border-b border-[#F5EBE0] py-4 pt-safe">
            <div className="max-w-xl mx-auto px-4 flex justify-between items-center">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 bg-[#D8C4B6] rounded-2xl flex items-center justify-center text-white shadow-md"><Compass size={20} /></div>
                <div>
                  <h1 className="font-bold text-lg serif text-[#4E342E]">å¶¼æµ·ç´€è¡Œ</h1>
                  <p className="text-[9px] font-black text-[#A68A71] uppercase tracking-[0.3em]">Azure Reverie</p>
                </div>
              </div>
            </div>
          </header>
          <main className="flex-grow pt-24 pb-32 max-w-xl mx-auto w-full px-4">{renderContent()}</main>
          
          <TravelTipsWidget />

          <nav className="fixed bottom-6 left-1/2 -translate-x-1/2 w-[94%] max-w-lg z-50">
            <div className="glass-effect rounded-[2.5rem] shadow-2xl border border-[#F5EBE0]/60 p-1.5 flex justify-between items-center">
              {[
                { id: 'PREPARATION', icon: ClipboardCheck, label: 'æº–å‚™' },
                { id: 'ITINERARY', icon: MapIcon, label: 'è¡Œç¨‹' },
                { id: 'TRANSPORT', icon: Plane, label: 'äº¤é€š' },
                { id: 'ACCOMMODATION', icon: Bed, label: 'ä½å®¿' },
                { id: 'RECOMMENDATION', icon: Sparkles, label: 'æ¨è–¦' },
                { id: 'EXPENSE', icon: Wallet, label: 'æ›ç®—' }
              ].map(item => (
                <button key={item.id} onClick={() => setActiveTab(item.id)} className={`flex flex-col items-center justify-center py-3 rounded-[1.8rem] transition-all flex-1 ${activeTab === item.id ? 'tab-active scale-105' : 'text-[#A68A71]'}`}>
                  <item.icon size={20} /><span className={`text-[10px] mt-1 font-bold ${activeTab === item.id ? 'block' : 'hidden'}`}>{item.label}</span>
                </button>
              ))}
            </div>
          </nav>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>