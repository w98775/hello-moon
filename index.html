<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>2026 嶼海紀行 | 旅遊數位手冊</title>
  
  <!-- Libraries -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --milk-tea-primary: #4E342E;
      --milk-tea-secondary: #D8C4B6;
      --milk-tea-accent: #A68A71;
      --milk-tea-bg: #FDFBF7;
    }
    body {
      font-family: 'Noto Sans TC', sans-serif;
      background-color: var(--milk-tea-bg);
      color: var(--milk-tea-primary);
      -webkit-tap-highlight-color: transparent;
      overflow-x: hidden;
    }
    .serif { font-family: 'Noto Serif TC', serif; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    .glass-effect {
      background: rgba(253, 251, 247, 0.85);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    .fade-in { animation: fadeIn 0.4s ease-out forwards; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
    .pt-safe { padding-top: env(safe-area-inset-top); }
    
    .tab-active {
      background-color: var(--milk-tea-secondary);
      color: white;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
    }
    
    input, textarea, select { outline: none; border: 1px solid #F5EBE0; border-radius: 12px; padding: 10px 14px; background: #FDFBF7; width: 100%; font-size: 14px; }
    input:focus, textarea:focus { border-color: var(--milk-tea-secondary); box-shadow: 0 0 0 2px rgba(216, 196, 182, 0.2); }
    
    .strikethrough { text-decoration: line-through; opacity: 0.5; }
  </style>

  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.460.0",
    "react/": "https://esm.sh/react@^19.2.3/",
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0"
  }
}
</script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel" data-type="module">
    import React, { useState, useEffect, useMemo } from 'react';
    import ReactDOM from 'react-dom/client';
    import { 
      ClipboardCheck, Map as MapIcon, Plane, Bed, Sparkles, Plus,
      Compass, Wallet, X, Trash2, Clock, Star, Waves, Edit2,
      Calendar, MapPin, ExternalLink, Train, ArrowRight, ChevronRight,
      Check, Utensils, Camera, ShoppingBag, Info, Luggage, Save, DollarSign, CreditCard
    } from 'lucide-react';

    const USD_TO_TWD = 32.5;
    const MYR_TO_TWD = 7.5;

    // --- 預設行程資料 ---
    const DEFAULT_ITINERARY = [
      { date: '1/23', title: '啟程：吉隆坡孟沙', activities: [{ id: '1', time: '10:25', title: '高鐵左營 -> 桃園', loc: '高鐵左營站', note: '攜帶車票憑證' }, { id: '2', time: '15:10', title: 'MH367 起飛', loc: '桃園機場 T1', note: '預計 20:05 抵達 KUL' }, { id: '3', time: '21:30', title: '飯店 Check-in', loc: 'Holiday Inn Bangsar', note: '吉隆坡第一晚' }], summary: '啟程飛往吉隆坡。' },
      { date: '1/24', title: '吉隆坡全日漫遊', activities: [{ id: '4', time: '09:00', title: '黑風洞探索', loc: 'Batu Caves', note: '272級階梯，穿舒適鞋子' }, { id: '5', time: '12:30', title: '新峰肉骨茶 (推薦)', loc: 'Bukit Bintang', note: '人氣美食' }, { id: '6', time: '19:00', title: '孟沙區晚餐', loc: 'Bangsar Village', note: '待選餐廳' }], summary: '體驗吉隆坡文化與美食。' },
      { date: '1/25', title: '飛向美居渡假村', isMaldives: true, activities: [{ id: '7', time: '09:40', title: 'MH485 飛馬累', loc: 'KLIA T1', note: '提早 3 小時到機場' }, { id: '8', time: '16:00', title: '入住美居渡假村', loc: 'Mercure Maldives Kooddoo', note: '開始全包式假期' }], summary: '前往馬爾地夫，入住水上別墅。' },
      { id: 'd4', date: '1/26', title: '渡假村全日悠閒', isMaldives: true, activities: [{ id: '9', time: '09:00', title: '浮潛探險', loc: 'Villa Reef', note: '別墅下方即可浮潛' }, { id: '10', time: '19:00', title: '主題晚餐', loc: 'Alita Restaurant', note: '包含在全包方案內' }], summary: '享受陽光與玻璃海。' },
      { id: 'd5', date: '1/27', title: '海洋冒險：鯨鯊', isMaldives: true, activities: [{ id: '11', time: '08:30', title: '鯨鯊追蹤遊 (自費)', loc: 'Gaafu Alifu', note: '需提前預約，220 USD' }], summary: '追蹤馬爾地夫海洋巨人。' },
      { id: 'd6', date: '1/28', title: '環礁之美與 SPA', isMaldives: true, activities: [{ id: '12', time: '10:00', title: '高空拖曳傘 (自費)', loc: 'Lagoon', note: '俯瞰珊瑚礁' }, { id: '13', time: '16:00', title: '舒壓 SPA', loc: 'Wellness Center', note: '放鬆身心' }], summary: '享受最後一天的渡假村時光。' },
      { id: 'd7', date: '1/29', title: '移師胡魯馬累居民島', activities: [{ id: '14', time: '11:00', title: '搭船前往居民島', loc: 'Hulhumale', note: '入住 h78' }, { id: '15', time: '17:00', title: '海灘漫步', loc: 'Hulhumale Beach', note: '感受當地氣息' }], summary: '體驗在地生活與島嶼風情。' },
      { id: 'd8', date: '1/30', title: '返程：吉隆坡休整', activities: [{ id: '16', time: '12:00', title: 'MH484 返大馬', loc: 'Velana Airport', note: '預計 19:45 抵達' }, { id: '17', time: '21:30', title: '入住 Umi 民宿', loc: 'Umi SplashMania', note: '機場周邊' }], summary: '飛回吉隆坡，準備明日返台。' },
      { id: 'd9', date: '1/31', title: '平安賦歸', activities: [{ id: '18', time: '09:20', title: 'MH366 返台', loc: 'KLIA T1', note: '預計 14:10 抵台' }, { id: '19', time: '16:34', title: '高鐵 0841 返家', loc: '桃園高鐵站', note: '18:25 抵達左營' }], summary: '搭機回台，結束夢幻之旅。' },
    ];

    // --- 詳細準備清單 (參考 Travel Blue & Stan Travel) ---
    const PREPARATION_LIST = [
      { category: '重要文件', items: ['護照 (效期6個月以上)', '馬爾地夫 IMUGA 申報截圖', '馬來西亞 MDAC 申報截圖', '機票/飯店憑證 (建議存離線)', '旅遊不便險憑證', '備用護照影本與照片'] },
      { category: '馬爾地夫專屬', items: ['海洋友善防曬 (Reef Safe)', '長袖水母衣 (防曬防割)', '個人浮潛裝備 (面鏡、呼吸管)', '潛水襪/防滑鞋', '防水袋 (10-20L)', 'GoPro/防水相機'] },
      { category: '電子與電器', items: ['萬用轉接頭 (英式三孔)', '多孔快充充電頭', '大容量行動電源', '充電線材', 'SIM卡/網卡 (Digi/Ooredoo)'] },
      { category: '生活用品', items: ['薄外套 (飛機/商場冷氣)', '太陽眼鏡/遮陽帽', '泳裝 (至少2套替換)', '涼鞋/拖鞋', '摺疊傘', '美金新鈔 (1元小費用)'] },
      { category: '個人藥品', items: ['暈船藥 (快艇必備)', '止痛/退燒藥', '腸胃藥 (預防水土不服)', '防蚊液', 'OK繃', '個人常備藥'] },
    ];

    const MALDIVES_ACTIVITIES_LIST = [
      { name: '鯨鯊追蹤遊 (必去)', en: 'Whale Shark Safari', price: 220 },
      { name: '魟魚浮潛體驗', en: 'Manta Ray Snorkeling', price: 115 },
      { name: '傳統黃昏海釣', en: 'Sunset Fishing', price: 95 },
      { name: '高空拖曳傘', en: 'Parasailing', price: 160 },
      { name: '體驗深潛', en: 'Discover Scuba Diving', price: 195 },
      { name: '水上 SPA 按摩', en: 'SPA Treatment', price: 150 },
    ];

    const App = () => {
      const [activeTab, setActiveTab] = useState('ITINERARY');
      const [itinerary, setItinerary] = useState(() => {
        const saved = localStorage.getItem('my_trip_2026_itinerary');
        return saved ? JSON.parse(saved) : DEFAULT_ITINERARY;
      });
      const [expenses, setExpenses] = useState(() => {
        const saved = localStorage.getItem('my_trip_2026_expenses');
        return saved ? JSON.parse(saved) : [];
      });

      useEffect(() => { localStorage.setItem('my_trip_2026_itinerary', JSON.stringify(itinerary)); }, [itinerary]);
      useEffect(() => { localStorage.setItem('my_trip_2026_expenses', JSON.stringify(expenses)); }, [expenses]);

      const renderContent = () => {
        switch (activeTab) {
          case 'PREPARATION': return <PreparationView />;
          case 'ITINERARY': return <ItineraryView itinerary={itinerary} setItinerary={setItinerary} />;
          case 'TRANSPORT': return <TransportView />;
          case 'ACCOMMODATION': return <AccommodationView />;
          case 'RECOMMENDATION': return <RecommendationView />;
          case 'EXPENSE': return <ExpenseView expenses={expenses} setExpenses={setExpenses} />;
          default: return <ItineraryView itinerary={itinerary} setItinerary={setItinerary} />;
        }
      };

      return (
        <div className="min-h-screen flex flex-col pb-safe">
          <header className="fixed top-0 left-0 right-0 z-40 glass-effect border-b border-[#F5EBE0] py-4 pt-safe">
            <div className="max-w-xl mx-auto px-4 flex justify-between items-center">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 bg-[#D8C4B6] rounded-2xl flex items-center justify-center text-white shadow-md"><Compass size={20} /></div>
                <div><h1 className="font-bold text-lg serif text-[#4E342E]">2026 嶼海紀行</h1><p className="text-[9px] font-black text-[#A68A71] uppercase tracking-[0.2em]">Travel Planner</p></div>
              </div>
            </div>
          </header>

          <main className="flex-grow pt-24 pb-32 max-w-xl mx-auto w-full px-4">{renderContent()}</main>

          <nav className="fixed bottom-6 left-1/2 -translate-x-1/2 w-[94%] max-w-lg z-50">
            <div className="glass-effect rounded-[2.5rem] shadow-2xl border border-[#F5EBE0]/60 p-2 flex justify-between items-center">
              {[
                { id: 'PREPARATION', icon: ClipboardCheck, label: '準備' },
                { id: 'ITINERARY', icon: MapIcon, label: '行程' },
                { id: 'TRANSPORT', icon: Plane, label: '交通' },
                { id: 'ACCOMMODATION', icon: Bed, label: '住宿' },
                { id: 'RECOMMENDATION', icon: Sparkles, label: '推薦' },
                { id: 'EXPENSE', icon: Wallet, label: '記帳' }
              ].map(item => (
                <button key={item.id} onClick={() => setActiveTab(item.id)} className={`flex flex-col items-center justify-center py-3 rounded-[1.8rem] transition-all flex-1 ${activeTab === item.id ? 'tab-active scale-105' : 'text-[#A68A71]'}`}>
                  <item.icon size={20} /><span className={`text-[10px] mt-1 font-bold ${activeTab === item.id ? 'block' : 'hidden'}`}>{item.label}</span>
                </button>
              ))}
            </div>
          </nav>
        </div>
      );
    };

    // --- 行程頁面：支援增刪改與備註 ---
    const ItineraryView = ({ itinerary, setItinerary }) => {
      const [dayIdx, setDayIdx] = useState(0);
      const [editItem, setEditItem] = useState(null);
      const [showAdd, setShowAdd] = useState(false);
      const [newAct, setNewAct] = useState({ time: '', title: '', loc: '', note: '' });

      const day = itinerary[dayIdx];

      const handleAdd = () => {
        if (!newAct.title) return;
        const updated = [...itinerary];
        updated[dayIdx].activities.push({ ...newAct, id: Date.now().toString() });
        updated[dayIdx].activities.sort((a, b) => a.time.localeCompare(b.time));
        setItinerary(updated);
        setNewAct({ time: '', title: '', loc: '', note: '' });
        setShowAdd(false);
      };

      const handleUpdate = () => {
        const updated = [...itinerary];
        const idx = updated[dayIdx].activities.findIndex(a => a.id === editItem.id);
        updated[dayIdx].activities[idx] = editItem;
        updated[dayIdx].activities.sort((a, b) => a.time.localeCompare(b.time));
        setItinerary(updated);
        setEditItem(null);
      };

      const handleDelete = (id) => {
        if (!confirm('確定要刪除此行程嗎？')) return;
        const updated = [...itinerary];
        updated[dayIdx].activities = updated[dayIdx].activities.filter(a => a.id !== id);
        setItinerary(updated);
      };

      return (
        <div className="fade-in">
          <div className="flex overflow-x-auto gap-3 pb-6 no-scrollbar snap-x">
            {itinerary.map((d, i) => (
              <button key={i} onClick={() => setDayIdx(i)} className={`flex-shrink-0 w-12 h-16 rounded-2xl flex flex-col items-center justify-center transition-all border ${dayIdx === i ? 'bg-[#4E342E] text-white shadow-lg' : 'bg-white text-[#A68A71] border-[#F5EBE0]'}`}>
                <span className="text-[8px] font-black uppercase opacity-60">Jan</span><span className="text-lg font-black mt-1">{d.date.split('/')[1]}</span>
              </button>
            ))}
          </div>

          <div className="bg-white p-7 rounded-[2.5rem] border border-[#F5EBE0] shadow-sm mb-6">
            <div className="flex justify-between items-start mb-6">
              <div><div className="text-[10px] font-black text-[#A68A71] uppercase tracking-[0.2em] mb-1">Day 0{dayIdx + 1} · {day.date}</div><h2 className="text-2xl font-bold text-[#4E342E] serif">{day.title}</h2></div>
              <button onClick={() => setShowAdd(true)} className="w-12 h-12 bg-[#D8C4B6] text-white rounded-2xl flex items-center justify-center shadow-md active:scale-95"><Plus size={24} /></button>
            </div>
            
            <div className="space-y-8 relative ml-1">
              <div className="absolute left-[17px] top-3 bottom-3 w-[1px] bg-[#F5EBE0]" />
              {day.activities.map((act) => (
                <div key={act.id} className="flex gap-5 relative z-10 group">
                  <div className="w-9 h-9 rounded-xl flex items-center justify-center shrink-0 border-2 bg-white text-[#4E342E] border-[#F5EBE0]"><Clock size={16} /></div>
                  <div className="flex-1">
                    <div className="flex justify-between items-start">
                      <span className="text-[11px] font-black text-[#D8C4B6]">{act.time || '未定時'}</span>
                      <div className="flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                        <button onClick={() => setEditItem(act)} className="text-[#A68A71] hover:text-[#4E342E]"><Edit2 size={14} /></button>
                        <button onClick={() => handleDelete(act.id)} className="text-red-300 hover:text-red-500"><Trash2 size={14} /></button>
                      </div>
                    </div>
                    <h4 className="font-bold text-base text-[#4E342E]">{act.title}</h4>
                    {act.loc && <div className="text-[11px] text-[#A68A71] flex items-center gap-1 mt-1 font-bold cursor-pointer hover:underline" onClick={() => window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(act.loc)}`)}><MapPin size={10} /> {act.loc}</div>}
                    {act.note && <p className="mt-2 text-[11px] text-[#A68A71] italic bg-[#FDFBF7] p-2 rounded-lg border border-[#F5EBE0]">註：{act.note}</p>}
                  </div>
                </div>
              ))}
            </div>
          </div>

          {day.isMaldives && (
            <div className="bg-[#4E342E] p-8 rounded-[2.5rem] text-white shadow-xl mb-6">
              <h3 className="text-xl font-bold serif mb-6 flex items-center gap-3"><Waves className="text-[#D8C4B6]" /> 渡假村精選自費活動</h3>
              <div className="grid gap-4">
                {MALDIVES_ACTIVITIES_LIST.map((item, i) => (
                  <div key={i} className="bg-white/5 p-4 rounded-2xl flex justify-between items-center border border-white/5">
                    <div><h4 className="font-bold text-sm text-[#D8C4B6]">{item.name}</h4><p className="text-[9px] opacity-40 uppercase font-black">{item.en}</p></div>
                    <div className="text-right">
                      <div className="text-lg font-black">${item.price}</div>
                      <div className="text-[9px] text-[#D8C4B6] font-bold">≈ NT$ {Math.round(item.price * USD_TO_TWD).toLocaleString()}</div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* 編輯/新增 Modal */}
          {(showAdd || editItem) && (
            <div className="fixed inset-0 z-[60] flex items-center justify-center px-4">
              <div className="absolute inset-0 bg-black/40 backdrop-blur-sm" onClick={() => { setShowAdd(false); setEditItem(null); }} />
              <div className="relative bg-white w-full max-w-sm p-8 rounded-[2.5rem] shadow-2xl space-y-4">
                <h3 className="text-xl font-bold serif text-[#4E342E] text-center mb-4">{showAdd ? '新增活動' : '編輯行程'}</h3>
                <div className="space-y-3">
                  <input type="time" value={showAdd ? newAct.time : editItem.time} onChange={e => showAdd ? setNewAct({...newAct, time: e.target.value}) : setEditItem({...editItem, time: e.target.value})} />
                  <input type="text" value={showAdd ? newAct.title : editItem.title} onChange={e => showAdd ? setNewAct({...newAct, title: e.target.value}) : setEditItem({...editItem, title: e.target.value})} placeholder="活動名稱 (例如：晚餐)" />
                  <input type="text" value={showAdd ? newAct.loc : editItem.loc} onChange={e => showAdd ? setNewAct({...newAct, loc: e.target.value}) : setEditItem({...editItem, loc: e.target.value})} placeholder="地點 (Google Map 搜尋)" />
                  <textarea value={showAdd ? newAct.note : editItem.note} onChange={e => showAdd ? setNewAct({...newAct, note: e.target.value}) : setEditItem({...editItem, note: e.target.value})} placeholder="備註或提醒..." rows="3" />
                </div>
                <div className="flex gap-3 pt-4">
                  <button onClick={() => { setShowAdd(false); setEditItem(null); }} className="flex-1 py-4 rounded-2xl bg-[#FDFBF7] text-[#A68A71] font-bold border border-[#F5EBE0]">取消</button>
                  <button onClick={showAdd ? handleAdd : handleUpdate} className="flex-1 py-4 rounded-2xl bg-[#4E342E] text-white font-bold shadow-lg">儲存</button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    // --- 準備分頁 ---
    const PreparationView = () => (
      <div className="fade-in space-y-8">
        <div className="bg-[#D8C4B6] p-7 rounded-[2.5rem] text-white shadow-xl relative overflow-hidden">
          <Luggage className="absolute top-0 right-0 opacity-10 w-32 h-32" />
          <h2 className="text-2xl font-bold serif mb-2">出發前檢查清單</h2>
          <p className="text-[11px] opacity-90 leading-relaxed">參考 Travel Blue 與 Stan Travel 建議之清單。</p>
        </div>
        <div className="space-y-6">
          {PREPARATION_LIST.map((cat, i) => (
            <div key={i} className="space-y-3">
              <h3 className="font-black text-[10px] text-[#A68A71] uppercase tracking-[0.2em] px-2">{cat.category}</h3>
              <div className="grid gap-2">
                {cat.items.map((item, j) => (
                  <div key={j} className="bg-white p-4 rounded-2xl border border-[#F5EBE0] flex items-center gap-4 shadow-sm group">
                    <div className="w-5 h-5 rounded-md border-2 border-[#F5EBE0] group-hover:bg-[#D8C4B6] group-hover:border-[#D8C4B6] transition-all flex items-center justify-center cursor-pointer"><Check size={12} className="text-white" /></div>
                    <span className="font-bold text-sm text-[#4E342E]">{item}</span>
                  </div>
                ))}
              </div>
            </div>
          ))}
        </div>
      </div>
    );

    // --- 記帳分頁：包含匯率換算 ---
    const ExpenseView = ({ expenses, setExpenses }) => {
      const [showAdd, setShowAdd] = useState(false);
      const [item, setItem] = useState({ title: '', amount: '', currency: 'USD' });
      const [convVal, setConvVal] = useState('');
      const [convMode, setConvMode] = useState('USD');

      const addExpense = () => {
        if (!item.title || !item.amount) return;
        const rate = item.currency === 'USD' ? USD_TO_TWD : MYR_TO_TWD;
        const twd = Math.round(parseFloat(item.amount) * rate);
        setExpenses([{ ...item, id: Date.now(), twd }, ...expenses]);
        setItem({ title: '', amount: '', currency: 'USD' });
        setShowAdd(false);
      };

      const totalTwd = useMemo(() => expenses.reduce((sum, e) => sum + e.twd, 0), [expenses]);

      return (
        <div className="fade-in space-y-6">
          {/* 匯率即時換算 */}
          <div className="bg-white p-6 rounded-[2.5rem] border border-[#F5EBE0] shadow-sm">
            <h3 className="font-bold text-sm text-[#4E342E] mb-4 flex items-center gap-2"><DollarSign size={16} className="text-[#D8C4B6]" /> 匯率即時試算</h3>
            <div className="flex bg-[#FDFBF7] p-1.5 rounded-2xl border border-[#F5EBE0] mb-4">
              <button onClick={() => setConvMode('USD')} className={`flex-1 py-2 rounded-xl text-xs font-black ${convMode === 'USD' ? 'bg-[#4E342E] text-white shadow-md' : 'text-[#A68A71]'}`}>USD 美金</button>
              <button onClick={() => setConvMode('MYR')} className={`flex-1 py-2 rounded-xl text-xs font-black ${convMode === 'MYR' ? 'bg-[#4E342E] text-white shadow-md' : 'text-[#A68A71]'}`}>MYR 令吉</button>
            </div>
            <div className="relative mb-4">
              <input type="number" value={convVal} onChange={e => setConvVal(e.target.value)} placeholder="輸入金額" className="text-center font-black text-lg py-3" />
              <div className="mt-2 text-center text-[10px] text-[#A68A71] font-bold">≈ NT$ {Math.round((parseFloat(convVal) || 0) * (convMode === 'USD' ? USD_TO_TWD : MYR_TO_TWD)).toLocaleString()} TWD</div>
            </div>
          </div>

          {/* 記帳列表 */}
          <div className="bg-[#4E342E] p-8 rounded-[3rem] text-white shadow-xl flex justify-between items-center">
            <div><p className="text-[10px] opacity-60 font-black mb-1">TOTAL EXPENSES</p><h2 className="text-4xl font-black">NT$ {totalTwd.toLocaleString()}</h2></div>
            <button onClick={() => setShowAdd(true)} className="w-14 h-14 bg-[#D8C4B6] rounded-2xl flex items-center justify-center shadow-lg active:scale-95"><Plus size={28} /></button>
          </div>

          <div className="space-y-4">
            {expenses.map(e => (
              <div key={e.id} className="bg-white p-6 rounded-[2rem] border border-[#F5EBE0] shadow-sm flex justify-between items-center group">
                <div><h4 className="font-bold text-[#4E342E]">{e.title}</h4><p className="text-[10px] text-[#A68A71] font-bold">{e.currency} {e.amount} <span className="mx-1">/</span> ≈ NT$ {e.twd.toLocaleString()}</p></div>
                <button onClick={() => setExpenses(expenses.filter(ex => ex.id !== e.id))} className="text-red-200 hover:text-red-500 transition-colors"><Trash2 size={16} /></button>
              </div>
            ))}
            {expenses.length === 0 && <p className="text-center text-[#A68A71] py-20 text-xs">目前尚無開銷紀錄。</p>}
          </div>

          {showAdd && (
            <div className="fixed inset-0 z-[60] flex items-center justify-center px-4">
              <div className="absolute inset-0 bg-black/40 backdrop-blur-sm" onClick={() => setShowAdd(false)} />
              <div className="relative bg-white w-full max-w-sm p-8 rounded-[2.5rem] shadow-2xl space-y-4">
                <h3 className="text-xl font-bold serif text-[#4E342E] text-center">新增消費</h3>
                <input type="text" value={item.title} onChange={e => setItem({...item, title: e.target.value})} placeholder="項目 (例如：午餐)" />
                <div className="flex gap-2">
                  <input type="number" value={item.amount} onChange={e => setItem({...item, amount: e.target.value})} placeholder="金額" className="flex-1" />
                  <select value={item.currency} onChange={e => setItem({...item, currency: e.target.value})} className="w-24">
                    <option value="USD">USD</option><option value="MYR">MYR</option>
                  </select>
                </div>
                <div className="flex gap-3 pt-4">
                  <button onClick={() => setShowAdd(false)} className="flex-1 py-4 rounded-2xl bg-[#FDFBF7] text-[#A68A71] font-bold border border-[#F5EBE0]">取消</button>
                  <button onClick={addExpense} className="flex-1 py-4 rounded-2xl bg-[#4E342E] text-white font-bold">儲存</button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    // --- 其他固定分頁 ---
    const TransportView = () => (
      <div className="fade-in space-y-6">
        <h2 className="text-3xl font-bold serif text-[#4E342E] px-2">交通安排</h2>
        {[
          { date: '01/23', id: '高鐵 0818', from: '左營', to: '桃園', time: '10:25-12:18' },
          { date: '01/23', id: 'MH 367', from: 'TPE', to: 'KUL', time: '15:10-20:05' },
          { date: '01/25', id: 'MH 485', from: 'KUL', to: 'MLE', time: '09:40-11:00' },
          { date: '01/30', id: 'MH 484', from: 'MLE', to: 'KUL', time: '12:00-19:45' },
          { date: '01/31', id: 'MH 366', from: 'KUL', to: 'TPE', time: '09:20-14:10' },
          { date: '01/31', id: '高鐵 0841', from: '桃園', to: '左營', time: '16:34-18:25' },
        ].map((t, i) => (
          <div key={i} className="bg-white rounded-[2.5rem] border border-[#F5EBE0] p-7 flex justify-between items-center shadow-sm">
            <div><div className="font-black text-lg text-[#4E342E]">{t.id}</div><div className="text-[10px] text-[#A68A71] font-bold uppercase">{t.date} · {t.from} ➔ {t.to}</div></div>
            <div className="text-right font-black text-[#4E342E]">{t.time}</div>
          </div>
        ))}
      </div>
    );

    const AccommodationView = () => (
      <div className="fade-in space-y-8">
        <h2 className="text-3xl font-bold serif text-[#4E342E] px-2">旅宿清單</h2>
        {[
          { name: 'Holiday Inn Bangsar', date: '1/23-1/25', img: 'https://images.unsplash.com/photo-1551882547-ff43c63e17e5?auto=format&fit=crop&q=80&w=800' },
          { name: 'Mercure Maldives Resort', date: '1/25-1/29', img: 'https://images.unsplash.com/photo-1514282401047-d79a71a590e8?auto=format&fit=crop&q=80&w=800' },
          { name: 'h78 Maldives', date: '1/29-1/30', img: 'https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?auto=format&fit=crop&q=80&w=800' },
          { name: 'Umi Homestay', date: '1/30-1/31', img: 'https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?auto=format&fit=crop&q=80&w=800' },
        ].map((h, i) => (
          <div key={i} className="bg-white rounded-[3rem] overflow-hidden shadow-sm border border-[#F5EBE0]">
            <img src={h.img} className="h-48 w-full object-cover" />
            <div className="p-8">
              <h3 className="text-xl font-bold serif text-[#4E342E]">{h.name}</h3>
              <p className="text-xs text-[#A68A71] mt-2 flex items-center gap-2"><Calendar size={14} /> {h.date}</p>
            </div>
          </div>
        ))}
      </div>
    );

    const RecommendationView = () => (
      <div className="fade-in space-y-8">
        <h2 className="text-3xl font-bold serif text-[#4E342E] px-2">在地推薦</h2>
        {[
          { title: '在地美食', icon: Utensils, items: ['Nasi Lemak Wanjo (KL)', '新峰肉骨茶 (KL)', 'Ithaa 水下餐廳 (MV)'] },
          { title: '必訪景點', icon: Camera, items: ['黑風洞 Batu Caves (KL)', '迪格拉島 Dhigurah (MV)', '雙子星塔 (KL)'] },
        ].map((cat, i) => (
          <div key={i} className="bg-white p-7 rounded-[2.5rem] border border-[#F5EBE0] shadow-sm">
            <h3 className="font-bold text-lg text-[#4E342E] flex items-center gap-3 mb-4"><cat.icon size={20} className="text-[#D8C4B6]" /> {cat.title}</h3>
            <div className="grid gap-3">
              {cat.items.map((item, j) => (
                <div key={j} className="text-sm text-[#A68A71] flex items-center gap-3 cursor-pointer hover:underline" onClick={() => window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item)}`)}>
                  <div className="w-1.5 h-1.5 rounded-full bg-[#D8C4B6]" /> {item}
                </div>
              ))}
            </div>
          </div>
        ))}
      </div>
    );

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>